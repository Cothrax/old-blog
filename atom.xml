<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cothrax</title>
  <subtitle>I don&#39;t need a subtitle.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://cothrax.github.io/"/>
  <updated>2016-08-21T02:41:41.666Z</updated>
  <id>https://cothrax.github.io/</id>
  
  <author>
    <name>Cothrax</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>[JSOI2016] 提高1班 Day5</title>
    <link href="https://cothrax.github.io/2016/08/21/JSOI2016-%E6%8F%90%E9%AB%981%E7%8F%AD-Day5/"/>
    <id>https://cothrax.github.io/2016/08/21/JSOI2016-提高1班-Day5/</id>
    <published>2016-08-21T02:01:49.000Z</published>
    <updated>2016-08-21T02:41:41.666Z</updated>
    
    <content type="html"><![CDATA[<p>第1题一如既往地水，第3题的数据BT，但用dfs栈并没有爆。</p>
<h1 id="P1-Video"><a href="#P1-Video" class="headerlink" title="P1 Video"></a>P1 Video</h1><p>pluto 喜欢看片，现在他的硬盘里有n 部片，但是由于他还要把妹，所以看片时间有限，他只能挑出其中的k 部片来看，他想知道有多少种不同的选片方案。方案数可能很大，答案mod 1000000007 输出。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>一行两个整数，n和m</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>一行一个整数，即所求答案<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>6 2</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>15</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><ul>
<li>对于30% 的数据，n &lt; 10</li>
<li>对于60% 的数据，n &lt; 3000</li>
<li>对于100% 的数据，n &lt; 2x10e5</li>
</ul>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>难得碰到这么水的题，暴力算一下阶乘，拿扩展欧几里得求一下逆元就好了。</p>
<dir style="text-align:right"><a href="/2016/08/21/JSOI2016-提高1班-Day5/video.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>video.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> z=<span class="number">1000000007</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,a,rev,tmp,ans:int64;</div><div class="line">    i:longint;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">extgcd</span><span class="params">(a,b:int64;<span class="keyword">var</span> x,y:int64)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> b=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        x:=<span class="number">1</span>;y:=<span class="number">0</span>;<span class="keyword">exit</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    extgcd(b,a <span class="keyword">mod</span> b,y,x);</div><div class="line">    dec(y,(a <span class="keyword">div</span> b)*x);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'video.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'video.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    a:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> a:=a*i <span class="keyword">mod</span> z;</div><div class="line">    extgcd(a,z,rev,tmp);</div><div class="line">    rev:=(rev+z) <span class="keyword">mod</span> z;</div><div class="line">    ans:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=n-m+<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> ans:=ans*i <span class="keyword">mod</span> z;</div><div class="line">    <span class="keyword">write</span>(ans*rev <span class="keyword">mod</span> z);</div><div class="line">    </div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-Chance"><a href="#P2-Chance" class="headerlink" title="P2 Chance"></a>P2 Chance</h1><p>pluto 去找妹子xxx 约会，然而xxx 要求和pluto 玩一个游戏，pluto 赢了才能获得和xxx约会的机会。游戏内容为：现在有N 个袋子(你可以认为它是哆啦A 梦的口袋，每个袋子里放着一些球)，所以容量十分大，第i 个袋子里放着编号为Li 到Ri 的球(除编号外完全相同)，pluto 需要从每个袋子里摸出一个球，第i 个袋子里任何一个球被摸到的概率是1/(Ri - Li + 1)，如果pluto 摸出的球中有K% 或以上的球的编号的第一位是1(比如11,121,199 的第一位是1, 而21,233 第一位就不是1)，那么pluto 就将赢得与xxx 约会的机会。现在pluto 想知道他能人生中第一次与妹子约会的概率有多大。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个整数N,K<br>接下来N 行，每行两个整数，Li 和Ri</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>一行一个实数（保留7位小数）表示答案<br>绝对误差不超过10e-6 即视为正确<br><!--more--></p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>2 50<br>1 2<br>9 11</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>0.833333333333333</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><ul>
<li>对于100% 的数据，0 &lt; k &lt; 100，0 &lt; Li &lt; Ri</li>
<li>对于30% 的数据，n &lt; 10，Li &lt; Ri &lt; 100</li>
<li>对于60% 的数据，n &lt; 500，Li &lt; Ri &lt; 2000</li>
<li>对于100% 的数据，n &lt; 2000，Li &lt; Ri &lt; 1018</li>
</ul>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>先乱搞就能够求出第i个袋子中摸出第一位是1的球的概率p[i]（然而因为乱搞WA N次）<br>然后DP，f[i,j]在前i个袋子中摸出j个符合要求的球的概率<br><span>$f[i,j]=f[i-1,j-1]*p[i]+f[i-1,j]*(1-p[i])$</span><!-- Has MathJax --><br>注意：</p>
<ol>
<li>乱搞需谨慎</li>
<li>f[0,i]也要算</li>
<li>答案是<span>$\sum\{ f[n,j]\ |\ j\geq \left\lceil n*k\% \right\rceil\}$</span><!-- Has MathJax --></li>
</ol>
<dir style="text-align:right"><a href="/2016/08/21/JSOI2016-提高1班-Day5/chance.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>chance.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,k,i,j:longint;l,r:int64;</div><div class="line">    p:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2010</span>] <span class="keyword">of</span> double;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2010</span>,-<span class="number">1</span>..<span class="number">2010</span>] <span class="keyword">of</span> double;</div><div class="line">    ans:double;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span><span class="params">()</span>:</span>double;</div><div class="line"><span class="keyword">var</span> x,y,tot:int64;i:longint;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(l,r);</div><div class="line">    x:=<span class="number">1</span>;tot:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> <span class="number">18</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> x&gt;r <span class="keyword">then</span> break;</div><div class="line">        y:=<span class="number">2</span>*x-<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> y&gt;=l <span class="keyword">then</span></div><div class="line">            inc(tot,min(y,r)-max(l,x)+<span class="number">1</span>);</div><div class="line">        x:=x*<span class="number">10</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    cal:=tot/(r-l+<span class="number">1</span>);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'chance.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'chance.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,k);</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> p[i]:=cal();</div><div class="line">    f[<span class="number">0</span>,<span class="number">0</span>]:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">            f[i,j]:=f[i-<span class="number">1</span>,j-<span class="number">1</span>]*p[i]+f[i-<span class="number">1</span>,j]*(<span class="number">1</span>-p[i]); </div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=ceil(n*k/<span class="number">100</span>) <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        ans:=ans+f[n,i];</div><div class="line">    <span class="keyword">write</span>(ans:<span class="number">0</span>:<span class="number">7</span>);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-Plutotree"><a href="#P3-Plutotree" class="headerlink" title="P3 Plutotree"></a>P3 Plutotree</h1><p>有一棵n 个节点的树，节点编号为1 到n，i 号节点的权值为Wi。这棵树有些奇怪，它的每一个叶子节点都是根节点的父亲(表示每个叶子节点与根节点之间有一条边权为0 的边)。我们称这样的树为pluto 树，根节点编号为1。我们需要最小化从u 到v 的路径(每条边只能经过一次) 上的节点权值之和，并且在最小化节点权值之和的同时求这个路径上可能的最大权值。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个整数n 和q，n 表示节点个数，q 表示询问个数。<br>第二行n 􀀀 1 个整数Ai，表示i + 1 号节点的父亲为Ai<br>第三行n 个整数Wi 表示i 号节点的权值为Wi<br>接下来q 行，每行两个整数u，v，表示一组询问</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每组询问输出两个整数x; y<br>x 表示u 到v 的权值和最小的路径的权值和，y 表示这条路径上点权最大值。如果有多个相同权值和的路径，输出那个点权最大值最大的。<br><!--more--></p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5 1<br>1 2 3 4<br>413 127 263 869 960<br>1 5</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>1373 960</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>• 对于30% 的数据，n ≤ 300，q ≤ 1000<br>• 对于50% 的数据，n ≤ 2000，q ≤ 10000<br>• 对于100% 的数据，n ≤ 100000，q ≤ 100000</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p><strong>倍增LCA+树形DP</strong><br>对于查询(u,v)，分类讨论</p>
<ol>
<li>直接走树上的简单路径，这种情况倍增一下就可以了</li>
<li>一个点通过叶子走回根，再从根走到另一个点</li>
<li>两个点都通过叶子，在根相遇</li>
</ol>
<p>后两种情况，要处理出离每个点最近的叶子节点，对于点i，有两种情况：</p>
<ol>
<li>走到i的子树上叶子，这个dfs顺手就算出来了</li>
<li>先向上（父节点）走，然后向下到达一个叶子，这个在情况1算出来后再dp一下。</li>
</ol>
<p>注意点：</p>
<ol>
<li>算最近的叶子不要忘了情况2（数据比较BT，忘了就爆0了）</li>
<li>倍增数组要开大，我开到15然后爆了。</li>
<li>还有就是关于每条边只能经过一次的问题，但由于是<strong>最小化权值和</strong>，重复经过的情况不可能是最优解，所以没有必要多做考虑。</li>
<li>分类2有两种走法都要考虑</li>
<li>由于是点权，和边权类似，但注意边界问题</li>
</ol>
<dir style="text-align:right"><a href="/2016/08/21/JSOI2016-提高1班-Day5/plutotree0.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>plutotree0.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span></div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span></div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head,dep,w,dist:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    d:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    par,mxw:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>,<span class="number">0</span>..<span class="number">25</span>] <span class="keyword">of</span> int;</div><div class="line">    n,logn,q,i,j:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"><span class="comment">//为了省事，更新答案用</span></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">update</span><span class="params">(<span class="keyword">var</span> x,y:int;nx,ny:int)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> (nx&lt;x) <span class="keyword">or</span> ((nx=x) <span class="keyword">and</span> (ny&gt;y)) <span class="keyword">then</span></div><div class="line">        <span class="keyword">begin</span> x:=nx;y:=ny <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    dep[v]:=dep[p]+<span class="number">1</span>; <span class="comment">//深度</span></div><div class="line">    dist[v]:=dist[p]+w[v]; <span class="comment">//到根的路径上的点权和</span></div><div class="line">    par[v,<span class="number">0</span>]:=p; <span class="comment">//父节点</span></div><div class="line">    mxw[v,<span class="number">0</span>]:=max(w[p],w[v]); <span class="comment">//倍增路径上的最大点权</span></div><div class="line">    i:=head[v];</div><div class="line">    <span class="comment">//d是dp数组，d[v,0]是离最近叶子的路径上的点权和，d[v,1]是这个路径上的最大点权</span></div><div class="line">    <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> d[v,<span class="number">0</span>]:=w[v] <span class="keyword">else</span> d[v,<span class="number">0</span>]:=inf;</div><div class="line">    d[v,<span class="number">1</span>]:=w[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        dfs(u,v);</div><div class="line">        update(d[v,<span class="number">0</span>],d[v,<span class="number">1</span>],d[u,<span class="number">0</span>]+w[v],max(d[u,<span class="number">1</span>],w[v]));</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    update(d[v,<span class="number">0</span>],d[v,<span class="number">1</span>],d[p,<span class="number">0</span>]+w[v],max(d[p,<span class="number">1</span>],w[v]));</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        dp(g[i].t,v);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tmp:int;</div><div class="line"><span class="keyword">begin</span> tmp:=a;a:=b;b:=tmp <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">lca</span><span class="params">(u,v:int;<span class="keyword">var</span> c,mx:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> dep[u]&lt;dep[v] <span class="keyword">then</span> swap(u,v);</div><div class="line">    mx:=max(w[u],w[v]);</div><div class="line">    <span class="keyword">for</span> i:=logn <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> dep[par[u,i]]&gt;=dep[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            mx:=max(mx,mxw[u,i]);</div><div class="line">            u:=par[u,i];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> u=v <span class="keyword">then</span> <span class="keyword">begin</span> c:=u;<span class="keyword">exit</span> <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=logn <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> par[u,i]&lt;&gt;par[v,i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            mx:=max(mx,max(mxw[u,i],mxw[v,i]));</div><div class="line">            u:=par[u,i];v:=par[v,i];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    mx:=max(mx,max(mxw[u,<span class="number">0</span>],mxw[v,<span class="number">0</span>]));</div><div class="line">    c:=par[u,<span class="number">0</span>];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">()</span>;</span></div><div class="line"><span class="keyword">var</span> t1,t2,c,mx,mx1,md,md1:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(t1,t2);</div><div class="line">    <span class="keyword">if</span> t1=t2 <span class="keyword">then</span> <span class="keyword">begin</span> writeln(w[t1],<span class="string">' '</span>,w[t1]);<span class="keyword">exit</span> <span class="keyword">end</span>;</div><div class="line">    <span class="comment">//Case 1</span></div><div class="line">    lca(t1,t2,c,mx);</div><div class="line">    md:=dist[t1]+dist[t2]-<span class="number">2</span>*dist[c]+w[c];</div><div class="line">    <span class="comment">//Case 2.1</span></div><div class="line">    mx1:=max(mxw[t1,logn],d[t2,<span class="number">1</span>]);</div><div class="line">    md1:=dist[t1]+d[t2,<span class="number">0</span>];</div><div class="line">    update(md,mx,md1,mx1);</div><div class="line">    <span class="comment">//Case 2.2</span></div><div class="line">    mx1:=max(mxw[t2,logn],d[t1,<span class="number">1</span>]);</div><div class="line">    md1:=dist[t2]+d[t1,<span class="number">0</span>];</div><div class="line">    update(md,mx,md1,mx1);</div><div class="line">    <span class="comment">//Case 3</span></div><div class="line">    mx1:=max(w[<span class="number">1</span>],max(d[t1,<span class="number">1</span>],d[t2,<span class="number">1</span>]));</div><div class="line">    md1:=d[t1,<span class="number">0</span>]+d[t2,<span class="number">0</span>]+w[<span class="number">1</span>];</div><div class="line">    update(md,mx,md1,mx1);</div><div class="line"></div><div class="line">    writeln(md,<span class="string">' '</span>,mx);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'plutotree.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'plutotree.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,q);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j);add(j,i);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(w[i]);</div><div class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">    dp(<span class="number">1</span>,<span class="number">1</span>);</div><div class="line">    <span class="comment">//倍增数组</span></div><div class="line">    logn:=floor(ln(n)/ln(<span class="number">2</span>));</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> logn <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            par[j,i]:=par[par[j,i-<span class="number">1</span>],i-<span class="number">1</span>];</div><div class="line">            mxw[j,i]:=max(mxw[j,i-<span class="number">1</span>],mxw[par[j,i-<span class="number">1</span>],i-<span class="number">1</span>]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> q <span class="keyword">do</span> solve();</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第1题一如既往地水，第3题的数据BT，但用dfs栈并没有爆。&lt;/p&gt;
&lt;h1 id=&quot;P1-Video&quot;&gt;&lt;a href=&quot;#P1-Video&quot; class=&quot;headerlink&quot; title=&quot;P1 Video&quot;&gt;&lt;/a&gt;P1 Video&lt;/h1&gt;&lt;p&gt;pluto 喜欢看片，现在他的硬盘里有n 部片，但是由于他还要把妹，所以看片时间有限，他只能挑出其中的k 部片来看，他想知道有多少种不同的选片方案。方案数可能很大，答案mod 1000000007 输出。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;一行两个整数，n和m&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;一行一个整数，即所求答案&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="数论" scheme="https://cothrax.github.io/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="树形DP" scheme="https://cothrax.github.io/tags/%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="LCA" scheme="https://cothrax.github.io/tags/LCA/"/>
    
      <category term="倍增" scheme="https://cothrax.github.io/tags/%E5%80%8D%E5%A2%9E/"/>
    
      <category term="乘法逆元" scheme="https://cothrax.github.io/tags/%E4%B9%98%E6%B3%95%E9%80%86%E5%85%83/"/>
    
      <category term="排列组合" scheme="https://cothrax.github.io/tags/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/"/>
    
      <category term="概率期望" scheme="https://cothrax.github.io/tags/%E6%A6%82%E7%8E%87%E6%9C%9F%E6%9C%9B/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高2班 单调队列及动规优化</title>
    <link href="https://cothrax.github.io/2016/08/20/JSOI2016-%E6%8F%90%E9%AB%982%E7%8F%AD-%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97%E5%8F%8A%E5%8A%A8%E8%A7%84%E4%BC%98%E5%8C%96/"/>
    <id>https://cothrax.github.io/2016/08/20/JSOI2016-提高2班-单调队列及动规优化/</id>
    <published>2016-08-20T10:34:23.000Z</published>
    <updated>2016-08-20T10:52:41.533Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-轰炸机"><a href="#P1-轰炸机" class="headerlink" title="P1 轰炸机"></a>P1 轰炸机</h1><p>大山两侧的X国与Y国爆发了一场战争，由于山势险峻，只有一条山路可以通行，所以双方的军营都设置在这一条路上（直线）。X国科学家正在研制一种高威力轰炸机，其炮弹可以大规模精准摧毁目标。由于在前线连连失利，X国高层决定提前将其投入使用。但由于研发尚未完成，仅有一枚导弹可供使用。这枚导弹至多可以摧毁M个目标（包括敌方军营和己方军营），但这些目标必须是连续的。<br>在一个月黑风高的夜晚，X国高层决定用这架轰炸机发起突袭。他们预先侦查到了山路上双方军营共有N个军营，并探清了每个军营的情况，他们请你帮他们设计出这次突袭战果最大的方案。<br>X国战国的计算公式为：战果=敌方损失的战斗力-己方损失的战斗力。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个整数 N,M;<br>第2~N+1行，每行一个整数Ai，表示第i个军营的属性值。<br>abs(Ai)表示第i个军营的战斗力。<br>Ai>0，表明该军营是Y国的军营；<br>Ai&lt;0，表明该军营是X国的军营；<br>Ai=0，表明该军营是空的。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>仅一行，输出使突袭战果最大的方案（按照输入顺序输出所有轰炸目标的属性值），每两个属性值之间用一个空格隔开。</p>
<a id="more"></a>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4 2<br>-1<br>3<br>–10<br>20</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>20</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>30%的数据：N&lt;=3000,M&lt;=100<br>100%的数据N,M&lt;=1000000 -maxlongint&lt;=Ai&lt;=maxlongint</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>最大子段和的升级版，要求长度不超过m。<br>先求前缀和sum[i]<br>然后，记f[i]是以i结尾的最大子段和，<span>$f[i]=sum[i]-min\{sum[j]\ |\ i-j&lt;=m\}$</span><!-- Has MathJax --><br>然后可以用一个严格递增的单调队列维护sum[j]</p>
<dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-单调队列及动规优化/sum.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>sum.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,k,d,h,t,ans:int;</div><div class="line">    c,w,a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">110</span>] <span class="keyword">of</span> int; <span class="comment">//费用,价值,数量</span></div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> int;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(c[i],w[i],a[i]);</div><div class="line">    d:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        d:=min(m,d+c[i]*a[i]);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> c[i]-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            h:=<span class="number">1</span>;t:=<span class="number">0</span>;k:=<span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span> j+c[i]*k&lt;=d <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                <span class="keyword">while</span> (h&lt;=t) <span class="keyword">and</span> (q[t,<span class="number">0</span>]&lt;=f[j+c[i]*k]-w[i]*k) <span class="keyword">do</span> dec(t);</div><div class="line">                inc(t);q[t,<span class="number">1</span>]:=k;q[t,<span class="number">0</span>]:=f[j+c[i]*k]-w[i]*k;</div><div class="line">                <span class="keyword">while</span> (h&lt;=t) <span class="keyword">and</span> (k-q[h,<span class="number">1</span>]&gt;a[i]) <span class="keyword">do</span> inc(h);</div><div class="line">                f[j+c[i]*k]:=max(f[j+c[i]*k],q[h,<span class="number">0</span>]+k*w[i]);</div><div class="line">                inc(k);</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> ans:=max(ans,f[i]);</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-武器调度"><a href="#P2-武器调度" class="headerlink" title="P2 武器调度"></a>P2 武器调度</h1><p>为了取得胜利，X国高层决定调动武器库中的装备支援前线，以增强前线的战斗力。X国武器库中共有N种武器，每种武器都有固定的质量，且数量有限，能给前线增加的战斗力也是已知的。拟定将用飞机运送，为了使飞机具有能摆脱Y国防空导弹的速度，其最大装载质量不得超过M。现在他们需要你求出这一次装备运输最多能给前线增加多少战斗力。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个整数 N，M；<br>第2~N+1行，每行三个整数Pi、Wi、Ci，<br>Pi表示每件第i种武器的质量；<br>Wi表示每件第i种武器能给前线增加的战斗力；<br>Ci表示第i种武器的数量。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>仅一行，输出这一次装备运输能给前线增加的最大战斗力。</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5 20<br>3 8 5<br>12 16 2<br>1 4 1<br>5 9 2<br>4 11 1</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>55</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p>30%的数据中，n&lt;=10<br>50%的数据中，n&lt;=50,m&lt;=5000<br>100%的数据中，n&lt;=100,m&lt;=10000,ci&lt;=100<br>保证输出结果在maxlongint范围内。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>单调队列优化多重背包，代码优美到不可思议。<br>详解见此：<a href="http://www.cppblog.com/flyinghearts/archive/2010/09/01/125555.html" target="_blank" rel="external">http://www.cppblog.com/flyinghearts/archive/2010/09/01/125555.html</a></p>
<dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-单调队列及动规优化/war.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>war.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,k,d,h,t,ans:int;</div><div class="line">    c,w,a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">110</span>] <span class="keyword">of</span> int; <span class="comment">//费用,价值,数量</span></div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> int;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'war.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'war.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(c[i],w[i],a[i]);</div><div class="line">    d:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        d:=min(m,d+c[i]*a[i]);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> c[i]-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            h:=<span class="number">1</span>;t:=<span class="number">0</span>;k:=<span class="number">0</span>;</div><div class="line">            <span class="keyword">while</span> j+c[i]*k&lt;=d <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                <span class="keyword">while</span> (h&lt;=t) <span class="keyword">and</span> (q[t,<span class="number">0</span>]&lt;=f[j+c[i]*k]-w[i]*k) <span class="keyword">do</span> dec(t);</div><div class="line">                inc(t);q[t,<span class="number">1</span>]:=k;q[t,<span class="number">0</span>]:=f[j+c[i]*k]-w[i]*k;</div><div class="line">                <span class="keyword">while</span> (h&lt;=t) <span class="keyword">and</span> (k-q[h,<span class="number">1</span>]&gt;a[i]) <span class="keyword">do</span> inc(h);</div><div class="line">                f[j+c[i]*k]:=max(f[j+c[i]*k],q[h,<span class="number">0</span>]+k*w[i]);</div><div class="line">                inc(k);</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> ans:=max(ans,f[i]);</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-轰炸机&quot;&gt;&lt;a href=&quot;#P1-轰炸机&quot; class=&quot;headerlink&quot; title=&quot;P1 轰炸机&quot;&gt;&lt;/a&gt;P1 轰炸机&lt;/h1&gt;&lt;p&gt;大山两侧的X国与Y国爆发了一场战争，由于山势险峻，只有一条山路可以通行，所以双方的军营都设置在这一条路上（直线）。X国科学家正在研制一种高威力轰炸机，其炮弹可以大规模精准摧毁目标。由于在前线连连失利，X国高层决定提前将其投入使用。但由于研发尚未完成，仅有一枚导弹可供使用。这枚导弹至多可以摧毁M个目标（包括敌方军营和己方军营），但这些目标必须是连续的。&lt;br&gt;在一个月黑风高的夜晚，X国高层决定用这架轰炸机发起突袭。他们预先侦查到了山路上双方军营共有N个军营，并探清了每个军营的情况，他们请你帮他们设计出这次突袭战果最大的方案。&lt;br&gt;X国战国的计算公式为：战果=敌方损失的战斗力-己方损失的战斗力。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行两个整数 N,M;&lt;br&gt;第2~N+1行，每行一个整数Ai，表示第i个军营的属性值。&lt;br&gt;abs(Ai)表示第i个军营的战斗力。&lt;br&gt;Ai&gt;0，表明该军营是Y国的军营；&lt;br&gt;Ai&amp;lt;0，表明该军营是X国的军营；&lt;br&gt;Ai=0，表明该军营是空的。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;仅一行，输出使突袭战果最大的方案（按照输入顺序输出所有轰炸目标的属性值），每两个属性值之间用一个空格隔开。&lt;/p&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="单调队列" scheme="https://cothrax.github.io/tags/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/"/>
    
      <category term="数据结构" scheme="https://cothrax.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高2班 二分答案</title>
    <link href="https://cothrax.github.io/2016/08/20/JSOI2016-%E6%8F%90%E9%AB%982%E7%8F%AD-%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    <id>https://cothrax.github.io/2016/08/20/JSOI2016-提高2班-二分答案/</id>
    <published>2016-08-20T03:12:13.000Z</published>
    <updated>2016-08-20T03:59:49.801Z</updated>
    
    <content type="html"><![CDATA[<p>二分的坑点在于解的检验。</p>
<table>
<thead>
<tr>
<th>题号</th>
<th>检验方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>P1 P2</td>
<td>贪心</td>
</tr>
<tr>
<td>P3 P5</td>
<td>DP</td>
</tr>
<tr>
<td>P4</td>
<td>DFS</td>
</tr>
</tbody>
</table>
<h1 id="P1-晒衣服"><a href="#P1-晒衣服" class="headerlink" title="P1 晒衣服"></a>P1 晒衣服</h1><p>洗完衣服后，你要弄干衣服。衣服在自然条件下用1个单位时间可以晒干A点湿度，现在买了1台烘衣机，使用烘衣机可以让你用1个单位的时间使1件衣服除开自然晒干的A点湿度外，还可烘干B点湿度，但在1个单位的时间内只能对1件衣服使用。<br>N件衣服因为种种原因而不一样湿，现在告诉你每件衣服的湿度，要你求出弄干所有衣服的最少时间（湿度为0为干）。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入文件第一行N，A，B;<br>接下来1^行，每行一个数，表示衣服的湿度$a_i$（<span>$1\leq a_i\leq500000，1\leq N\leq 500000$</span><!-- Has MathJax -->）。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一行一个整数，表示最少时间。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>3 2 1 1 2<br>3</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>1</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>样例解析：<br>第1个单位时间内，用机器处理第3件衣服，此外，所有衣服自然晒干2。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-二分答案/dry.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>dry.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,a,b,l,r,mid,ans,i:int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">500010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,cnt:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    cnt:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> x*a&lt;f[i] <span class="keyword">then</span> </div><div class="line">            inc(cnt,ceil((f[i]-x*a)/b));</div><div class="line">    check:=cnt&lt;=x;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'dry.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'dry.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,a,b);</div><div class="line">    l:=<span class="number">0</span>;r:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f[i]);</div><div class="line">        r:=max(f[i],r);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-收入计划"><a href="#P2-收入计划" class="headerlink" title="P2 收入计划"></a>P2 收入计划</h1><p>高考结束后，同学们大都找到了一份临时工作，渴望挣得一些零用钱。从今天起，Matrix67将 连续工作N天(1≤N≤00000)。每一天末他可以领取当天及前面若干天里没有领取的工资，但他总共 只有M(l^M^N)次领取工资的机会。Matrix67已经知道了在接下来的这N天里每一天他可以赚多少钱。为了避免自己滥用零花钱，他希望知道如何安排领取工资的时间才能使得领到工资最多的那一 次工资数额最小。<br>注意:Matrix67必须恰好领工资M次，且需要将所有的工资全部领走（即最后一天末需要领一次 工资）。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入文件第一行包括2个正整数N和M。<br>以下N行，每行一个不超过10000正整数，依次表示每一天的薪水。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出文件仅一行一个整数，表示领取到的工资的最大值最小是多少。<br><!--more--></p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>75<br>100<br>400<br>300<br>100<br>500<br>101<br>400</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>500</p>
</blockquote>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-二分答案/income.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>income.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,l,r,mid,ans:int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,sum,cnt:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    sum:=<span class="number">0</span>;cnt:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> a[i]&gt;x <span class="keyword">then</span> <span class="keyword">exit</span>(false) <span class="comment">//不要忘了这个</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> sum+a[i]&gt;x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt);sum:=a[i]</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span></div><div class="line">            inc(sum,a[i]);</div><div class="line">    check:=(cnt+<span class="number">1</span>)&lt;=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'income.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'income.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    l:=<span class="number">0</span>;r:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(a[i]);</div><div class="line">        inc(r,a[i]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-软件开发"><a href="#P3-软件开发" class="headerlink" title="P3 软件开发"></a>P3 软件开发</h1><p>一个软件开发公司同时要开发两个软件，并且要同时交付给用户，现在公司为了尽快完成这一 任务，将每个软件划分成m个模块，由公司里的技术人员分工完成，每个技术人员完成同一软件的 不同模块的所用的天数是相同的，并且是已知的，但完成不同软件的一个模块的时间是不同的，每 个技术人员在同一时刻只能做一个模块，一个模块只能由一个人独立完成而不能由多人协同完成。 一个技术人员在整个开发期内完成一个模块以后可以接着做任一软件的任一模块。写一个程序，求 出公司最早能在什么时候交付软件。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入数据共若干行。第一行包含两个由空格隔开的整数n和m，其中1≤n,m≤100。接下 来的n行每行包含两个用空格隔开的整数d1和d2, d1表示该技术人员完成第一个软件中的一个模块所需的天数，d2表示该技术人员完成第二个软件中的一个模块所需的天数，其中1≤d1,d2≤100 输出格式：<br>输出数据仅有一行包含一个整数d，表示公司最早能于d天后交付软件。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出文件仅一行一个整数，表示领取到的工资的最大值最小是多少。<br><!--more--></p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>3 20<br>1 1<br>2 4<br>1 6</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>18</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p>最快的方案是第一个技术人员完成第二个软件的18个模块，用时18天，第三个技术人员完成 第一个软件的18个模块，用时18天，其余的模块由第二个技术人员完成，用时12天，做完所有模 块需要18天。如果第一个技术人员完成第二个软件的17个模块，第三个技术人员完成第一个软件 的17个模块，其余的模块由第二个技术人员完成，需要用时18天，做完所有模块仍然需要18天， 所以少于18天不可能做完所有模块。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>给定时间x，记f[i,j]为前i个人完成了软件1的j个模块后，能完成软件2的模块的最大数量，然后DP。</p>
<dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-二分答案/software.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>software.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">100000000</span>;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,l,r,mid,ans:int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">101</span>] <span class="keyword">of</span> int;</div><div class="line">    d:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">101</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,j,k,maxs:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,-inf);</div><div class="line">    f[<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        maxs:=x <span class="keyword">div</span> d[i,<span class="number">0</span>];</div><div class="line">        <span class="keyword">for</span> j:=m <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span> </div><div class="line">            <span class="keyword">for</span> k:=<span class="number">0</span> <span class="keyword">to</span> min(maxs,j) <span class="keyword">do</span></div><div class="line">                f[j]:=max(f[j],f[j-k]+(x-k*d[i,<span class="number">0</span>]) <span class="keyword">div</span> d[i,<span class="number">1</span>]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    check:=f[m]&gt;=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'software.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'software.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(d[i,<span class="number">0</span>],d[i,<span class="number">1</span>]);</div><div class="line">    l:=<span class="number">1</span>;r:=inf;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P4-架设电话线"><a href="#P4-架设电话线" class="headerlink" title="P4 架设电话线"></a>P4 架设电话线</h1><p>FJ打算将电话线引到自己的农场，但电信公司并不打算为他提供免费服务。于是，H必须为此 向电信公司支付一定的费用。<br>FJ的农场周围分布着N(1≤N≤1000)根按1..N顺次编号的废弃的电话线杆，任意两根电话线杆间 都没有电话线相连。一共P(1≤P≤1OOOO)对电话线杆间可以拉电话线，其余的那些由于隔得太远而无 法被连接。第i对电话线杆的两个端点分别为Ai、Bi，它们间的距离为Li(1≤Li≤1,000,000)。数据中 保证每对(Ai，Bi)最多只出现1次。编号为1的电话线杆已经接入了全国的电话网络，整个农场的 电话线全都连到了编号为N的电话线杆上。也就是说，FJ的任务仅仅是找一条将1号和N号电话线 杆连起来的路径，其余的电话线杆并不一定要连入电话网络。<br>经过谈判，电信公司最终同意免费为FJ连结K((0≤K\&lt;N)对由H指定的电话线杆。对于此外的那 些电话线，n需要为它们付的费用，等于其中最长的电话线的长度（每根电话线仅连结一对电话线 杆）。如果需要连结的电话线杆不超过K对，那么FJ的总支出为0。<br>请你计算一下，FJ最少需要在电话线上花多少钱。</p>
<h2 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入文件第1行:3个用空格隔开的整数：N, P，以及K。<br>第2..P+1行：第i+1行为3个用空格隔开的整数：Ai，Bi，Li。</p>
<h2 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出文件一行一个整数，为FJ这项工程上的最小支出。如果任务不可能完成，输出-1。<br><!--more--></p>
<h2 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-3"><a href="#样例输入-3" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5 7 1<br>1 2 5<br>3 1 4<br>2 4 8<br>3 2 3<br>5 2 9<br>3 4 7<br>4 5 6</p>
</blockquote>
<h3 id="样例输出-3"><a href="#样例输出-3" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>4</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>一共有5根废弃的电话线杆。电话线杆1不能直接与电话线杆4、5相连。电话线杆5不能直接 与电话线杆1、3相连。其余所有电话线杆间均可拉电话线。电信公司可以免费为FJ连结一对电话 线杆。<br>FJ选择如下的连结方案：1-&gt;3; 3-&gt;2; 2-&gt;5,这3对电话线杆间需要的电话线的长度分别为4、 3、9。FJ让电信公司提供那条长度为9的电话线，于是，他所需要购买的电话线的最大长度为4。</p>
<h2 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h2><p>最小化最大值，二分答案，不能再裸了。<br>给定费用x，从1开始dfs，距离小于x的边直接走过去，大于的话递归统计数量j，当j&gt;k时exit。<br>注意判重数组为used[n,k]而不是used[n]<br>可以用flag记录一下有没有走到n，如果有直接exit就好。</p>
<dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-二分答案/phoneline.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>phoneline.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span></div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next,w:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">20010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> int;</div><div class="line">    used:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>,<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> boolean;</div><div class="line">    n,p,k,i,l,r,mid,ans,f0,t0,w0:int;</div><div class="line">    flag:boolean;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(v,j:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> j&gt;k <span class="keyword">then</span> <span class="keyword">exit</span>;</div><div class="line">    <span class="keyword">if</span> v=n <span class="keyword">then</span> <span class="keyword">begin</span> flag:=true;<span class="keyword">exit</span> <span class="keyword">end</span>;</div><div class="line">    used[v,j]:=true;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> (g[i].w&lt;=mid) <span class="keyword">and</span> <span class="keyword">not</span> used[u,j] <span class="keyword">then</span> dfs(u,j);</div><div class="line">        <span class="keyword">if</span> (g[i].w&gt;mid) <span class="keyword">and</span> <span class="keyword">not</span> used[u,j+<span class="number">1</span>] <span class="keyword">then</span> dfs(u,j+<span class="number">1</span>);</div><div class="line">        <span class="keyword">if</span> flag <span class="keyword">then</span> <span class="keyword">exit</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">()</span>:</span>boolean;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fillchar(used,sizeof(used),false);</div><div class="line">    flag:=false;</div><div class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">    check:=flag;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'phoneline.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'phoneline.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,p,k);</div><div class="line">    l:=<span class="number">0</span>;r:=<span class="number">0</span>;</div><div class="line">    fillchar(head,sizeof(head),<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> p <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f0,t0,w0);</div><div class="line">        add(f0,t0,w0);add(t0,f0,w0);</div><div class="line">        r:=max(r,w0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check() <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P5-圣诞节的花环"><a href="#P5-圣诞节的花环" class="headerlink" title="P5 圣诞节的花环"></a>P5 圣诞节的花环</h1><p>圣诞节就要到了。现在有个困难的任务摆在你眼前——装饰房间。你手头上有n朵大小相同的 花，第i朵花的重量为Wi。现在打算用一根绳将这n朵花按顺序穿起来，挂在天花板上。绳子被m 个点固定，也就是绳子的一头被固定在1号点，另外一头固定在m号点，中间部分需要固定在剩余 的点。当然，装饰还有一些规则要注意：<br>1、每一段需要包含非0的偶数个花朵。正因如此，我们可以将每一段划分为两个半段。<br>2、为了减小你的客人撞到花环的可能，花环不能挂的太低：也就是说，每个半段不能超过d朵花。<br>3、最后，你需要让所有半段的重量的最大值最小。<br>下图是一个不错的安排方案，圈中的数字代表花朵的重量。<br><img src="/2016/08/20/JSOI2016-提高2班-二分答案/t.jpg" alt="t.jpg" title=""></p>
<h2 id="格式-4"><a href="#格式-4" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-4"><a href="#输入格式-4" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入文件第一行包含三个正整数n, m和d( 1≤1≤15000,2≤m≤10000,1≤d≤2000,且n*d≤5000000)。<br>接下来一行包含n个正整数w1，w2, …，wn (l≤w≤1OOOO)，代表对应花的重量。</p>
<h2 id="输出格式-4"><a href="#输出格式-4" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一行一个整数，代表最小的所有半段重量的最大值。如果没有方案满足条件，那么你只要 输出“BAD”（不包括引号）。</p>
<h2 id="样例-4"><a href="#样例-4" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-4"><a href="#样例输入-4" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4 3 10 10 10<br>20 20</p>
<p>6 4 10<br>1 1 100 100 1 1</p>
<p>6 3 10<br>1 1 100 100 1 1</p>
<p>1 2 2<br>333</p>
</blockquote>
<h3 id="样例输出-4"><a href="#样例输出-4" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>20</p>
<p>100</p>
<p>200</p>
<p>BAD</p>
</blockquote>
<h2 id="题解-4"><a href="#题解-4" class="headerlink" title="题解"></a>题解</h2><p>又见最小化最大值。<br>首先，n为奇数显然是无解的。因为题中要求固定点<strong>恰好</strong>m个，且环不能为0，那么如果<span>$n&lt;2*(m-1)$</span><!-- Has MathJax -->，也是无解的。<br>然后二分最大重量。<br>可以DP做，f[i]表示前i<strong>对</strong>花最少需要分成几段，于是<span>$f[i]=max\{f[j]+1\}$</span><!-- Has MathJax -->。然后<span>$f[n]&lt;m$</span><!-- Has MathJax -->的话就返回true<br>但这样写样例3是过不了的，因为将整段划分成1个区间符合答案102，但1个区间是不能被截成m-1=2个区间的。<br>实际上，如果k个区间可行，那么k+2个区间是可行的。<br>所以分奇偶讨论，f[n,0..1]，0为偶数段，1为奇数段<br><span>$f[i,0]=max\{f[j,1]+1\}$</span><!-- Has MathJax --><br><span>$f[i,1]=max\{f[j,0]+1\}$</span><!-- Has MathJax --></p>
<dir style="text-align:right"><a href="/2016/08/20/JSOI2016-提高2班-二分答案/flow.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>flow.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,d,i,l,r,mid,ans:int;</div><div class="line">    w,s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">15010</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">15010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    f[<span class="number">0</span>,<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">div</span> <span class="number">2</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=i-<span class="number">1</span> <span class="keyword">downto</span> max(i-d,<span class="number">0</span>) <span class="keyword">do</span></div><div class="line">            <span class="keyword">if</span> max(s[<span class="number">2</span>*j+i-j]-s[<span class="number">2</span>*j],s[<span class="number">2</span>*i]-s[<span class="number">2</span>*j+i-j])&lt;=x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                f[i,<span class="number">0</span>]:=min(f[i,<span class="number">0</span>],f[j,<span class="number">1</span>]+<span class="number">1</span>);</div><div class="line">                f[i,<span class="number">1</span>]:=min(f[i,<span class="number">1</span>],f[j,<span class="number">0</span>]+<span class="number">1</span>);</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">    check:=f[n <span class="keyword">div</span> <span class="number">2</span>,(m-<span class="number">1</span>) <span class="keyword">and</span> <span class="number">1</span>]&lt;m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'flow.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'flow.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(n,m,d);</div><div class="line">    <span class="keyword">if</span> odd(n) <span class="keyword">or</span> (n&lt;<span class="number">2</span>*m-<span class="number">2</span>) <span class="keyword">then</span> <span class="keyword">begin</span> <span class="keyword">write</span>(<span class="string">'BAD'</span>);halt <span class="keyword">end</span>;</div><div class="line">    l:=<span class="number">0</span>;r:=<span class="number">0</span>;s[<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(w[i]);</div><div class="line">        inc(r,w[i]);</div><div class="line">        s[i]:=s[i-<span class="number">1</span>]+w[i];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    ans:=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> ans=-<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">write</span>(<span class="string">'BAD'</span>) <span class="keyword">else</span> <span class="keyword">write</span>(ans);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;二分的坑点在于解的检验。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;题号&lt;/th&gt;
&lt;th&gt;检验方法&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;P1 P2&lt;/td&gt;
&lt;td&gt;贪心&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P3 P5&lt;/td&gt;
&lt;td&gt;DP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P4&lt;/td&gt;
&lt;td&gt;DFS&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&quot;P1-晒衣服&quot;&gt;&lt;a href=&quot;#P1-晒衣服&quot; class=&quot;headerlink&quot; title=&quot;P1 晒衣服&quot;&gt;&lt;/a&gt;P1 晒衣服&lt;/h1&gt;&lt;p&gt;洗完衣服后，你要弄干衣服。衣服在自然条件下用1个单位时间可以晒干A点湿度，现在买了1台烘衣机，使用烘衣机可以让你用1个单位的时间使1件衣服除开自然晒干的A点湿度外，还可烘干B点湿度，但在1个单位的时间内只能对1件衣服使用。&lt;br&gt;N件衣服因为种种原因而不一样湿，现在告诉你每件衣服的湿度，要你求出弄干所有衣服的最少时间（湿度为0为干）。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;输入文件第一行N，A，B;&lt;br&gt;接下来1^行，每行一个数，表示衣服的湿度$a_i$（&lt;span&gt;$1\leq a_i\leq500000，1\leq N\leq 500000$&lt;/span&gt;&lt;!-- Has MathJax --&gt;）。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出一行一个整数，表示最少时间。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="二分答案" scheme="https://cothrax.github.io/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="线性DP" scheme="https://cothrax.github.io/tags/%E7%BA%BF%E6%80%A7DP/"/>
    
      <category term="DFS" scheme="https://cothrax.github.io/tags/DFS/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高2班 树形DP（二）</title>
    <link href="https://cothrax.github.io/2016/08/19/JSOI2016-%E6%8F%90%E9%AB%982%E7%8F%AD-%E6%A0%91%E5%BD%A2DP%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://cothrax.github.io/2016/08/19/JSOI2016-提高2班-树形DP（二）/</id>
    <published>2016-08-19T03:58:32.000Z</published>
    <updated>2016-08-19T13:14:58.449Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P5-The-more-The-better"><a href="#P5-The-more-The-better" class="headerlink" title="P5 The more, The better"></a>P5 The more, The better</h1><p>ACboy很喜欢玩一种战略游戏，在一个地图上，有N座城堡，每座城堡都有一定的宝物，在每次游戏中ACboy允许攻克M个城堡并获得里面的宝物。但由于地理位置原因，有些城堡不能直接攻克，要攻克这些城堡必须先攻克其他某一个特定的城堡。你能帮ACboy算出要获得尽量多的宝物应该攻克哪M个城堡吗？</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>每个测试实例首先包括2个整数，N,M.(1 &lt;= M &lt;= N &lt;= 200);在接下来的N行里，每行包括2个整数，a,b. 在第 i 行，a 代表要攻克第 i 个城堡必须先攻克第 a 个城堡，如果 a = 0 则代表可以直接攻克第 i 个城堡。b 代表第 i 个城堡的宝物数量, b &gt;= 0。当N = 0, M = 0输入结束。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每个测试实例，输出一个整数，代表ACboy攻克M个城堡所获得的最多宝物的数量。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>3 2<br>0 1<br>0 2<br>0 3<br>7 4<br>2 2<br>0 1<br>0 4<br>2 1<br>7 1<br>7 6<br>2 2<br>0 0</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>5<br>13</p>
</blockquote>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>裸的树形背包，多叉转二叉后做就可以了。<br>杭电OJ不知怎么爆掉了，以下代码没测，仅供参考思路。交上去应该会ce，因为uses math</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高2班-树形DP（二）/test.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>test.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    br,ch,w:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">210</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">210</span>,<span class="number">0</span>..<span class="number">210</span>] <span class="keyword">of</span> int;</div><div class="line">    n,m,i,a:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(p,c:int)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    br[c]:=ch[p];</div><div class="line">    ch[p]:=c;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dp</span><span class="params">(v,j:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> (v=<span class="number">0</span>) <span class="keyword">or</span> (v=<span class="number">0</span>) <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> f[v,j]&lt;&gt;-<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">exit</span>(f[v,j]);</div><div class="line">    f[v,j]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> j-<span class="number">1</span> <span class="keyword">do</span></div><div class="line">        f[v,j]:=max(f[v,j],dp(ch[v],i)+w[v]+dp(br[v],j-i-<span class="number">1</span>));</div><div class="line">    f[v,j]:=max(f[v,j],dp(br[v],j));</div><div class="line">    dp:=f[v,j];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">while</span> (n&lt;&gt;<span class="number">0</span>) <span class="keyword">and</span> (m&lt;&gt;<span class="number">0</span>) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        fillchar(br,sizeof(br),<span class="number">0</span>);</div><div class="line">        fillchar(ch,sizeof(ch),<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(a,w[i]);</div><div class="line">            add(a,i);        </div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,-<span class="number">1</span>);</div><div class="line">        writeln(dp(ch[<span class="number">0</span>],m));</div><div class="line">        <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P6-作业大会"><a href="#P6-作业大会" class="headerlink" title="P6 作业大会"></a>P6 作业大会</h1><p>可爱的凯文在高一时就统计了所有人的联系方式，完成了教一的通讯录。每年的寒暑假开作业大会的时候这张通讯录就充分发挥了作用。同志们根据这张通讯录制定了通讯网络，可以抽象成一棵树。<br>每个节点（除叶子节点）首先接受他的所有孩子节点完成的卷子。接着他选择可以完成任意一张未完成的卷子，也可以选择不做。最后所有完成的卷子被汇总到树根节点。<br>很显然做卷子是要消耗时间的，卷子从孩子传到父亲也是要耗时间的。你的任务就是安排一个计划使得消耗最少时间完成所有卷子并汇总到树根。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个整数n，m。表示人数和卷子总数。<br>接下来n-1行每行三个整数x，y，c。表示x和y连通，在x和y之间传递时间为c。<br>最后n行，每行m个整数。第i行第j列的整数是编号i的节点完成第j张卷子消耗的时间。<br>n&lt;=55，m&lt;=11，保证n&gt;=m。根节点的编号为1。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>一个整数t。表示消耗的最小总时间。保证答案在longint范围内。</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>6 3<br>1 2 1<br>1 3 1<br>2 4 1<br>2 5 1<br>3 6 1<br>3 4 3<br>3 2 5<br>6 1 2<br>1 8 9<br>8 8 1<br>4 7 6</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>7</p>
</blockquote>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p><strong>树形DP+状压</strong>，又是一个下午==<br>我的想法是多叉转二叉后做。<br>f[v,s]表示v的子树，完成状态s的卷子所需的时间，对应的记忆化函数为dp(v,s)<br>a[v,i]指v做卷子i的时间，w[v]指v向父节点传输的时间</p>
<ol>
<li>枚举v做的卷子i，在剩余的卷子$s1=s-1\ shl\ (i-1)$中，枚举子节点做的卷子状态s2，于是答案<span>$=w[v]+a[v,i]+dp(ch[v],s2)+dp(br[v],s1\ xor\ s2)$</span><!-- Has MathJax --></li>
<li>v不做卷子，直接枚举子节点做的卷子状态s1，答案<span>$=w[v]+dp(ch[v],s1)+dp(br[v],s1\ xor\ s)$</span><!-- Has MathJax -->，注意$s1\not=0$</li>
<li>卷子全部给兄弟节点做，答案$=dp(br[v],s)$</li>
</ol>
<p>但转二叉后的问题在于冗余的情况非常的多，然后就TLE了，于是考虑优化：<br>cnt[x]记录x的二进制中1的个数<br>siz[v]以v为根的子树节点个数<br>当cnt[s]&gt;siz[v]时，直接返回inf。这个剪枝是非常厉害的。</p>
<p>标程是直接的多叉上做的，启发式合并什么的然而我并不会。</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高2班-树形DP（二）/network.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>network.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,w,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">120</span>] <span class="keyword">of</span> edge; <span class="comment">//存多叉</span></div><div class="line">    head,br,ch,w,siz:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">60</span>] <span class="keyword">of</span> int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">60</span>,<span class="number">0</span>..<span class="number">15</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">60</span>,<span class="number">0</span>..<span class="number">1</span> <span class="keyword">shl</span> <span class="number">11</span>-<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    cnt:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span> <span class="keyword">shl</span> <span class="number">11</span>-<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    n,m,k,i,j,f0,t0,w0:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"><span class="comment">//多叉转二叉</span></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(v,p,w0:int)</span>;</span><span class="keyword">inline</span>;</div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    br[v]:=ch[p];ch[p]:=v;w[v]:=w0;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> u&lt;&gt;p <span class="keyword">then</span> dfs(u,v,g[i].w);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"><span class="comment">//计算x的二进制表示中1的个数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">(x:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    count:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> x&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(count);</div><div class="line">        dec(x,x <span class="keyword">and</span> (-x));</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"><span class="comment">//计算以v为根的子树的节点数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span><span class="params">(v:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> v=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</div><div class="line">    siz[v]:=cal(ch[v])+cal(br[v])+<span class="number">1</span>;</div><div class="line">    cal:=siz[v];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dp</span><span class="params">(v,s:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> x,i,j,s1,s2,tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> cnt[s]&gt;siz[v] <span class="keyword">then</span> <span class="keyword">exit</span>(inf); <span class="comment">//剪枝</span></div><div class="line">    <span class="keyword">if</span> f[v,s]&lt;&gt;-<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">exit</span>(f[v,s]);</div><div class="line">    <span class="keyword">if</span> s=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> v=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(inf);</div><div class="line"></div><div class="line">    x:=s;</div><div class="line">    f[v,s]:=inf;</div><div class="line">    <span class="keyword">while</span> x&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span> <span class="comment">//枚举v做的卷子</span></div><div class="line">        i:=x <span class="keyword">and</span> (-x);</div><div class="line">        j:=round(ln(i)/ln(<span class="number">2</span>))+<span class="number">1</span>;</div><div class="line">        s1:=s <span class="keyword">and</span> <span class="keyword">not</span> i;</div><div class="line">        f[v,s]:=min(f[v,s],w[v]+a[v,j]+min(dp(br[v],s1),dp(ch[v],s1)));</div><div class="line">        </div><div class="line">        s2:=s1;</div><div class="line">        <span class="keyword">while</span> s2&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span> <span class="comment">//枚举子节点做的卷子</span></div><div class="line">            tmp:=w[v]+a[v,j]+dp(ch[v],s2)+dp(br[v],s1 xor s2);</div><div class="line">            f[v,s]:=min(f[v,s],tmp);</div><div class="line">            s2:=(s2-<span class="number">1</span>) <span class="keyword">and</span> s1;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        x:=x <span class="keyword">and</span> <span class="keyword">not</span> i;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    s1:=s; <span class="comment">//v不做卷子</span></div><div class="line">    <span class="keyword">while</span> s1&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span> <span class="comment">//枚举子节点做的卷子</span></div><div class="line">        f[v,s]:=min(f[v,s],w[v]+dp(ch[v],s1)+dp(br[v],s xor s1));</div><div class="line">        s1:=(s1-<span class="number">1</span>) <span class="keyword">and</span> s;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    f[v,s]:=min(f[v,s],dp(br[v],s)); <span class="comment">//全给兄弟做</span></div><div class="line">    dp:=f[v,s];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'network.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'network.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    k:=<span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> k <span class="keyword">do</span> cnt[i]:=count(i);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f0,t0,w0);</div><div class="line">        add(f0,t0,w0);add(t0,f0,w0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);cal(<span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">read</span>(a[i,j]);</div><div class="line">    </div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,-<span class="number">1</span>);</div><div class="line">    <span class="keyword">write</span>(dp(<span class="number">1</span>,k));</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="标程"><a href="#标程" class="headerlink" title="标程"></a>标程</h2><p>也可以欣赏一下标程。</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高2班-树形DP（二）/network2.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>network2.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> f:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">55</span>,<span class="number">0</span>..<span class="number">2047</span>] <span class="keyword">of</span> longint;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2047</span>] <span class="keyword">of</span> longint;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">55</span>] <span class="keyword">of</span> boolean;</div><div class="line">    e:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">110</span>] <span class="keyword">of</span> <span class="keyword">record</span> go,len,next:longint <span class="keyword">end</span>;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">55</span>] <span class="keyword">of</span> longint;</div><div class="line">    cost:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">55</span>,<span class="number">1</span>..<span class="number">11</span>] <span class="keyword">of</span> longint;</div><div class="line">    n,m,i,j,k,l,ef:longint;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">addedge</span><span class="params">(x,y,l:longint)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  ef:=ef+<span class="number">1</span>; e[ef].go:=y; e[ef].len:=l;</div><div class="line">  e[ef].next:=a[x]; a[x]:=ef;</div><div class="line">  ef:=ef+<span class="number">1</span>; e[ef].go:=x; e[ef].len:=l;</div><div class="line">  e[ef].next:=a[y]; a[y]:=ef;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(u:longint)</span>;</span></div><div class="line"><span class="keyword">var</span> i,j,k:longint; flag:boolean;</div><div class="line"><span class="keyword">begin</span></div><div class="line">  q[u]:=true; f[u,<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">  k:=a[u]; flag:=false;</div><div class="line">  <span class="keyword">while</span> k&gt;<span class="number">0</span> <span class="keyword">do</span></div><div class="line">  <span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> q[e[k].go] <span class="keyword">then</span></div><div class="line">    <span class="keyword">begin</span></div><div class="line">      solve(e[k].go);</div><div class="line">      <span class="keyword">if</span> <span class="keyword">not</span> flag <span class="keyword">then</span></div><div class="line">      <span class="keyword">begin</span></div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">1</span> <span class="keyword">do</span></div><div class="line">          <span class="keyword">if</span> f[e[k].go,i]+e[k].len&lt;f[u,i] <span class="keyword">then</span></div><div class="line">            f[u,i]:=f[e[k].go,i]+e[k].len;</div><div class="line">      <span class="keyword">end</span></div><div class="line">      <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">        g:=f[u];</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">1</span> <span class="keyword">do</span></div><div class="line">          <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">1</span> <span class="keyword">do</span></div><div class="line">            <span class="keyword">if</span> i <span class="keyword">and</span> j=<span class="number">0</span> <span class="keyword">then</span></div><div class="line">              <span class="keyword">if</span> f[u,i]+f[e[k].go,j]+e[k].len&lt;g[i <span class="keyword">or</span> j] <span class="keyword">then</span></div><div class="line">                g[i <span class="keyword">or</span> j]:=f[u,i]+f[e[k].go,j]+e[k].len;</div><div class="line">        f[u]:=g;</div><div class="line">      <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    k:=e[k].next;</div><div class="line">    flag:=true;</div><div class="line">  <span class="keyword">end</span>;</div><div class="line">  g:=f[u];</div><div class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">2</span> <span class="keyword">do</span></div><div class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">      <span class="keyword">if</span> i <span class="keyword">and</span> (<span class="number">1</span> <span class="keyword">shl</span> (j-<span class="number">1</span>))=<span class="number">0</span> <span class="keyword">then</span></div><div class="line">        <span class="keyword">if</span> f[u,i]+cost[u,j]&lt;g[i <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> (j-<span class="number">1</span>))] <span class="keyword">then</span></div><div class="line">          g[i <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> (j-<span class="number">1</span>))]:=f[u,i]+cost[u,j];</div><div class="line">  f[u]:=g;</div><div class="line"><span class="keyword">end</span>;</div><div class="line">    </div><div class="line"><span class="keyword">begin</span></div><div class="line">  assign(input,<span class="string">'network.in'</span>);reset(input);</div><div class="line">  assign(output,<span class="string">'network.out'</span>);rewrite(output);</div><div class="line"> </div><div class="line">  readln(n,m);</div><div class="line">  ef:=<span class="number">0</span>;</div><div class="line">  fillchar(e,sizeof(e),<span class="number">0</span>);</div><div class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span></div><div class="line">  <span class="keyword">begin</span></div><div class="line">    readln(j,k,l);</div><div class="line">    addedge(j,k,l);</div><div class="line">  <span class="keyword">end</span>;</div><div class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">      <span class="keyword">read</span>(cost[i,j]);</div><div class="line"></div><div class="line">  fillchar(q,sizeof(q),false);</div><div class="line">  filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,maxlongint <span class="keyword">shr</span> <span class="number">4</span>);</div><div class="line">  solve(<span class="number">1</span>);</div><div class="line">  writeln(f[<span class="number">1</span>,<span class="number">1</span> <span class="keyword">shl</span> m-<span class="number">1</span>]);</div><div class="line"></div><div class="line"> close(input);</div><div class="line"> close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P7-消防站"><a href="#P7-消防站" class="headerlink" title="P7 消防站"></a>P7 消防站</h1><p>Z国有N个城市，编号为1~N。城市之间用高速公路连接，任意两个城市之间有且仅有一条路径。<br>最近，Z国火灾频发，于是政府决定在一些城市建立一些消防站，在城市K建立消防站需要花费W（K），每个城市的W可能不同。如果不在城市K建立消防站，那么需要保证离K最近的消防站与K的距离不超过D（K）。每个城市的D可能不同。<br>为了节省开支，政府希望你计算满足要求的最小花费。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行一个整数T，表示测试数据组数。<br>接下来一共T部分，每部分格式如下：<br>第一行包含一个整数N(1≤n≤1000)。<br>第二行包含N个整数，第i个整数表示W（i）(0 &lt; W(i) &lt;= 10000)。<br>第三行包含N个整数，第i个整数表示D（i）（0 &lt;= D(i) &lt;= 10000）。<br>接下来n-1行，每行三个数u，v，L(1 &lt;= u, v &lt;= N，0 &lt; L &lt;= 1000)，表示城市u和城市v之间有一条长度为l的高速公路。</p>
<h3 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h3><p>每组测试数据输出一个整数，表示最小费用。</p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h3><blockquote>
<p>1<br>5<br>1 1 1 1 1<br>2 1 1 1 2<br>1 2 1<br>2 3 1<br>3 4 1<br>4 5 1</p>
</blockquote>
<h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h3><blockquote>
<p>1</p>
</blockquote>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>好像很厉害的树形DP，完整分析可以看<a href="/2016/08/19/JSOI2016-提高2班-树形DP（二）/消防站解题报告.doc" title="陈启峰的解题报告">陈启峰的解题报告</a>。<br>这里简单说一下思路：<br>ans[i]记录以i为根的子树全部被覆盖的最优值<br>f[i,j]记录以i为根的子树，在i依赖j的情况下的最优值<br>树形DP的方程都不好表示，直接看代码好了。<br>可以用dfs预处理两点距离，当然也可以倍增做。</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高2班-树形DP（二）/fire.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>fire.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,w,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,t,i,f0,t0,w0:int;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2010</span>] <span class="keyword">of</span> edge;</div><div class="line">    dist,f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>,<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> int;</div><div class="line">    w,lim,ans,head:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">cal</span><span class="params">(v,p,d:int)</span>;</span></div><div class="line"><span class="keyword">var</span> j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    dist[i,v]:=d;</div><div class="line">    j:=head[v];</div><div class="line">    <span class="keyword">while</span> j&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> g[j].t&lt;&gt;p <span class="keyword">then</span> cal(g[j].t,v,d+g[j].w);</div><div class="line">        j:=g[j].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> g[i].t&lt;&gt;p <span class="keyword">then</span> dp(g[i].t,v);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> dist[v,i]&lt;=lim[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            f[v,i]:=w[i];</div><div class="line">            j:=head[v];</div><div class="line">            <span class="keyword">while</span> j&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                <span class="keyword">if</span> g[j].t&lt;&gt;p <span class="keyword">then</span> </div><div class="line">                    inc(f[v,i],min(ans[g[j].t],f[g[j].t,i]-w[i]));</div><div class="line">                j:=g[j].next;</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">            ans[v]:=min(ans[v],f[v,i]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'fire.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'fire.out'</span>);rewrite(output);</div><div class="line">    <span class="keyword">read</span>(t);</div><div class="line">    <span class="keyword">while</span> t&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        fillchar(head,sizeof(head),<span class="number">0</span>);</div><div class="line">        filldword(ans,sizeof(ans) <span class="keyword">shr</span> <span class="number">2</span>,inf);</div><div class="line">        filldword(f,sizeof(f) <span class="keyword">shr</span> <span class="number">2</span>,inf);</div><div class="line">        filldword(dist,sizeof(dist) <span class="keyword">shr</span> <span class="number">2</span>,inf);</div><div class="line">        </div><div class="line">        <span class="keyword">read</span>(n);</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(w[i]);</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(lim[i]);</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(f0,t0,w0);</div><div class="line">            add(f0,t0,w0);add(t0,f0,w0);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> cal(i,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">        </div><div class="line">        dp(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">        writeln(ans[<span class="number">1</span>]);</div><div class="line">        dec(t);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P5-The-more-The-better&quot;&gt;&lt;a href=&quot;#P5-The-more-The-better&quot; class=&quot;headerlink&quot; title=&quot;P5 The more, The better&quot;&gt;&lt;/a&gt;P5 The more, The better&lt;/h1&gt;&lt;p&gt;ACboy很喜欢玩一种战略游戏，在一个地图上，有N座城堡，每座城堡都有一定的宝物，在每次游戏中ACboy允许攻克M个城堡并获得里面的宝物。但由于地理位置原因，有些城堡不能直接攻克，要攻克这些城堡必须先攻克其他某一个特定的城堡。你能帮ACboy算出要获得尽量多的宝物应该攻克哪M个城堡吗？&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;每个测试实例首先包括2个整数，N,M.(1 &amp;lt;= M &amp;lt;= N &amp;lt;= 200);在接下来的N行里，每行包括2个整数，a,b. 在第 i 行，a 代表要攻克第 i 个城堡必须先攻克第 a 个城堡，如果 a = 0 则代表可以直接攻克第 i 个城堡。b 代表第 i 个城堡的宝物数量, b &amp;gt;= 0。当N = 0, M = 0输入结束。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;对于每个测试实例，输出一个整数，代表ACboy攻克M个城堡所获得的最多宝物的数量。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="位运算" scheme="https://cothrax.github.io/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    
      <category term="状压DP" scheme="https://cothrax.github.io/tags/%E7%8A%B6%E5%8E%8BDP/"/>
    
      <category term="树形DP" scheme="https://cothrax.github.io/tags/%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="树形背包" scheme="https://cothrax.github.io/tags/%E6%A0%91%E5%BD%A2%E8%83%8C%E5%8C%85/"/>
    
      <category term="树结构" scheme="https://cothrax.github.io/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高1班 Day4</title>
    <link href="https://cothrax.github.io/2016/08/19/JSOI2016-%E6%8F%90%E9%AB%981%E7%8F%AD-Day4/"/>
    <id>https://cothrax.github.io/2016/08/19/JSOI2016-提高1班-Day4/</id>
    <published>2016-08-19T01:03:58.000Z</published>
    <updated>2016-08-19T01:19:30.334Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-公约数"><a href="#P1-公约数" class="headerlink" title="P1 公约数"></a>P1 公约数</h1><p>小w 最近仔细研究了公约数，他想到了以下问题：<br>现有n 个正整数，从中选k（2&lt;=k&lt;=n）个，设这k 个数的最大公约数为g，则这k 个数<br>的价值为k*g。求这个价值的最大值。<br>小w 当然知道答案了。现在他想考考你，你能很快回答出来吗？</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行，一个整数n。<br>第二行，n 个正整数。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>一行一个正整数，表示答案。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>4 6 3 8 9</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>9</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>对于30%数据，N&lt;=100<br>对于100%数据，N&lt;=200000，输入第二行每个数字不超过2000000</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>开始莫名其妙想到了背包，结果是枚举。<br>枚举公约数就好了。</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高1班-Day4/gcd.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>gcd.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,cur:int;ans:int64;</div><div class="line">    cnt:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2000010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'gcd.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'gcd.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);m:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j);</div><div class="line">        inc(cnt[j]);</div><div class="line">        m:=max(m,j);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        j:=i;cur:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> j&lt;=m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            inc(cur,cnt[j]);</div><div class="line">            inc(j,i);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">if</span> cur&lt;<span class="number">2</span> <span class="keyword">then</span> continue;</div><div class="line">        ans:=max(ans,cur*i);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-友好城市"><a href="#P2-友好城市" class="headerlink" title="P2 友好城市"></a>P2 友好城市</h1><p>小w 生活在美丽的Z 国。Z 国是一个有n 个城市的大国，城市之间有m 条单向公路（连<br>接城市i、j 的公路只能从i 连到j）。城市i、j 是友好城市当且仅当从城市i 能到达城市j 并<br>且从城市j 能到达城市i。如果k 个城市两两互为友好城市，那么我们称这k 个城市是友好<br>城市群，k 为友好城市群的大小。现在小w 想知道友好城市群的大小最大为多少，你能告诉<br>他吗？</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含两个整数n 和m。<br>接下来m 行，每行两个整数i 和j，表示有从城市i 到城市j 的一条单向公路。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>共一行一个整数表示答案。<br><!--more--></p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>10 12<br>3 7<br>1 2<br>4 5<br>7 10<br>10 8<br>6 8<br>2 1<br>3 8<br>10 3<br>6 8<br>7 3<br>4 1</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p>对于30%的数据，n,m&lt;=100<br>对于80%的数据，n&lt;=1000,m&lt;=100000<br>对于100%的数据，n,m&lt;=100000</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>咦这不是裸的强连通分量吗，上tarjan吧。<br>最后一个点好像由于分量大小BT，然后递归栈爆了。。。</p>
<dir style="text-align:right"><a href="/2016/08/19/JSOI2016-提高1班-Day4/friend.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>friend.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head,dfn,low,s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    ins:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> boolean;</div><div class="line">    n,m,i,j,t,tim,ans:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">tarjan</span><span class="params">(v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u,cnt:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(tim);dfn[v]:=tim;low[v]:=tim;</div><div class="line">    inc(t);s[t]:=v;ins[v]:=true;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> dfn[u]=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            tarjan(u);</div><div class="line">            low[v]:=min(low[v],low[u]);</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ins[u] <span class="keyword">then</span></div><div class="line">            low[v]:=min(low[v],dfn[u]);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> low[v]=dfn[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        cnt:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> s[t+<span class="number">1</span>]&lt;&gt;v <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt);</div><div class="line">            ins[s[t]]:=false;</div><div class="line">            dec(t);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        ans:=max(ans,cnt);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'friend.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'friend.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    fillchar(head,sizeof(head),<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j,t);add(j,t);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    t:=<span class="number">0</span>;tim:=<span class="number">0</span>;ans:=<span class="number">0</span>;</div><div class="line">    fillchar(dfn,sizeof(dfn),<span class="number">0</span>);</div><div class="line">    fillchar(ins,sizeof(ins),false);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> dfn[i]=<span class="number">0</span> <span class="keyword">then</span> tarjan(i);</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-运货"><a href="#P3-运货" class="headerlink" title="P3 运货"></a>P3 运货</h1><p>小w 开了一家快递公司，在n 个城市之间进行货物运输工作，一共雇了m 个快递员。<br>每个快递员性格很奇特，第i 号快递员只愿意将货物从城市si 运送到ti（甚至不愿意将货物从ti 运送到si），并且如果他运送的货物量x&lt;=di，那么他要求获得的报酬为x<em>ai，否则为di</em>ai+(x-di)*bi。<br>现在小w 接到一个大订单，需要将f 单位货物从s 运送到t，请求出小w 的最小开支。<br>你可以假定每个快递员的运货量没有限制。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行五个整数n，m，s，t，f<br>接下来m 行每行五个数si,ti,ai,bi,di，描述一个快递员的信息。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>如有解请输出最小小开支，否则请输出“Impossible”。（不含引号）<br><!--more--></p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4 4 0 3 5<br>0 1 3 0 3<br>1 3 3 0 3<br>0 2 2 1 6<br>2 3 2 1 6</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>18</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>$n&lt;=100,m&lt;=1000,si,ti,s,t&lt;=n-1,f,di&lt;=200,ai,bi&lt;=1000$<br>保证至多只有一名邮递员<span>$ai&lt;bi$</span><!-- Has MathJax -->,其余均是<span>$ai&gt;bi$</span><!-- Has MathJax --><br>共50 组数据，保证数据有梯度。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>想到网络流，但模型不一样</p>
<ol>
<li>没有流量限制</li>
<li>有两种费用</li>
</ol>
<p>考虑到只有一名邮递员$ai&lt;bi$，于是可以贪心。</p>
<blockquote>
<p>留个坑有时间再做。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-公约数&quot;&gt;&lt;a href=&quot;#P1-公约数&quot; class=&quot;headerlink&quot; title=&quot;P1 公约数&quot;&gt;&lt;/a&gt;P1 公约数&lt;/h1&gt;&lt;p&gt;小w 最近仔细研究了公约数，他想到了以下问题：&lt;br&gt;现有n 个正整数，从中选k（2&amp;lt;=k&amp;lt;=n）个，设这k 个数的最大公约数为g，则这k 个数&lt;br&gt;的价值为k*g。求这个价值的最大值。&lt;br&gt;小w 当然知道答案了。现在他想考考你，你能很快回答出来吗？&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行，一个整数n。&lt;br&gt;第二行，n 个正整数。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;一行一个正整数，表示答案。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="贪心" scheme="https://cothrax.github.io/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="数论" scheme="https://cothrax.github.io/tags/%E6%95%B0%E8%AE%BA/"/>
    
      <category term="强连通分量" scheme="https://cothrax.github.io/tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高2班 树形DP（一）</title>
    <link href="https://cothrax.github.io/2016/08/18/JSOI2016-%E6%8F%90%E9%AB%982%E7%8F%AD-%E6%A0%91%E5%BD%A2DP/"/>
    <id>https://cothrax.github.io/2016/08/18/JSOI2016-提高2班-树形DP/</id>
    <published>2016-08-18T14:30:18.000Z</published>
    <updated>2016-08-18T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-学校网络"><a href="#P1-学校网络" class="headerlink" title="P1 学校网络"></a>P1 学校网络</h1><p>一所学校在几年前购进了第一台电脑（这台电脑的编号为1）。最近几年，学校又购买了N-1台电脑，每台新电脑和之前的某一台电脑连接。学校的管理员想知道对于每一台电脑i，到与它距离最远的电脑的距离Si。你需要提供这个信息。<br><img src="/2016/08/18/JSOI2016-提高2班-树形DP/T.jpg" alt="T.jpg" title=""><br>Hint: 样例输入如上图所示，从图中你可以知道，4号电脑到1号电脑的距离最远，所以S1=3。4号电脑和5号电脑到2号电脑的距离最远，所以S2=2。5号电脑到3号电脑距离最远，所以S3=3。由此类推S4=4，S5=4。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入文件包含多组测试数据，对于每组测试数据：<br>第一行包含一个整数N (N&lt;=10000) ；<br>接下来N-1行描述每一台电脑。第i行包含两个用空格隔开的整数y、l，表示i号电脑与之前的y号电脑连接，距离为l。<br>所有l之和不超过10^9。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每组测试数据输出N行，第i行表示离i号电脑的最远距离Si。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>1 1<br>2 1<br>3 1<br>1 1</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3 2 3 4 4</p>
</blockquote>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><dir style="text-align:right"><a href="/2016/08/18/JSOI2016-提高2班-树形DP/computer.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>computer.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">100000000</span>;</div><div class="line"><span class="keyword">type</span></div><div class="line">    int=longint; </div><div class="line">    edge=<span class="keyword">record</span> f,t,w,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span></div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head,par:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> int;</div><div class="line">    f,p:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>,<span class="number">0</span>..<span class="number">2</span>] <span class="keyword">of</span> int;</div><div class="line">    n,i,j,k:int;</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].f:=f;g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u,tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fillchar(f[v],sizeof(f[v]),<span class="number">0</span>);</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;dp(u);</div><div class="line">        tmp:=f[u,<span class="number">0</span>]+g[i].w;</div><div class="line">        <span class="keyword">if</span> tmp&gt;f[v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            f[v,<span class="number">1</span>]:=f[v,<span class="number">0</span>];</div><div class="line">            f[v,<span class="number">0</span>]:=tmp;</div><div class="line">            f[v,<span class="number">2</span>]:=u;</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;f[v,<span class="number">1</span>] <span class="keyword">then</span></div><div class="line">            f[v,<span class="number">1</span>]:=tmp;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(v,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    p[v]:=f[v];</div><div class="line">    <span class="keyword">if</span> p[par[v],<span class="number">2</span>]&lt;&gt;v <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        tmp:=p[par[v],<span class="number">0</span>]+w;</div><div class="line">        <span class="keyword">if</span> tmp&gt;p[v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            p[v,<span class="number">1</span>]:=p[v,<span class="number">0</span>];</div><div class="line">            p[v,<span class="number">0</span>]:=tmp;</div><div class="line">            p[v,<span class="number">2</span>]:=par[v];</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;p[v,<span class="number">1</span>] <span class="keyword">then</span></div><div class="line">            p[v,<span class="number">1</span>]:=tmp;</div><div class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">        tmp:=p[par[v],<span class="number">1</span>]+w;</div><div class="line">        <span class="keyword">if</span> tmp&gt;p[v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            p[v,<span class="number">1</span>]:=p[v,<span class="number">0</span>];</div><div class="line">            p[v,<span class="number">0</span>]:=tmp;</div><div class="line">            p[v,<span class="number">2</span>]:=par[v];</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;p[v,<span class="number">1</span>] <span class="keyword">then</span></div><div class="line">            p[v,<span class="number">1</span>]:=tmp;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        dfs(g[i].t,g[i].w);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'computer.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'computer.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j,k);</div><div class="line">        add(j,i,k);par[i]:=j;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    dp(<span class="number">1</span>);</div><div class="line">    dfs(<span class="number">1</span>,-inf);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> writeln(p[i,<span class="number">0</span>]);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-黑手党"><a href="#P2-黑手党" class="headerlink" title="P2 黑手党"></a>P2 黑手党</h1><p>去年的芝加哥充满了黑帮争斗和奇怪的谋杀。警察局长真的厌倦了所有这些罪行，决定逮捕黑手党领袖。<br>不幸的是，芝加哥黑手党相当复杂的结构。没有人知道黑手党的信息。警方已经追踪他们一段时间的活动，并且知道他们中的一些人互相通信。根据收集到的资料，警察局长表明黑手党的层次结构可以表示为一棵树。黑手党首脑是树的根，每个节点表示一个人，一个节点的孩子即为这个节点表示的人的直接下属。<br>更不幸的是，虽然警方知道了匪徒的通讯，他们不知道谁是黑手党首脑。因此他们只有通信关系的无向树。<br>基于这样的思想，警察局长猜测可能表示黑手党首脑的节点必须满足：在删除它后，包含最多节点的剩余连通块的节点数最小。帮助警察找到所有可能成为黑手党首脑的节点。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含一个整数n(2≤n≤50000)，表示有n个人，编号为1~n。<br>接下来n-1行，每行两个数x，y，表示编号为x的人和编号为y的人之间有通信。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出所有可能成为黑手党首脑的人的编号，按升序排列，两个编号之间用空格隔开。<br><!--more--></p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>6<br>1 2<br>2 3<br>2 5<br>3 4<br>3 6</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>2 3</p>
</blockquote>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><dir style="text-align:right"><a href="/2016/08/18/JSOI2016-提高2班-树形DP/godfather.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>godfather.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,i,j,k,mins:int;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head,siz,f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">50010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    i:=head[v];</div><div class="line">    siz[v]:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> u&lt;&gt;p <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dp(u,v);</div><div class="line">            inc(siz[v],siz[u]);</div><div class="line">            f[v]:=max(f[v],siz[u]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;    </div><div class="line">    f[v]:=max(f[v],n-siz[v]);</div><div class="line">    mins:=min(mins,f[v]);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'godfather.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'godfather.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j,k);</div><div class="line">        add(j,k);add(k,j);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    mins:=maxlongint;</div><div class="line">    dp(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> f[i]=mins <span class="keyword">then</span> <span class="keyword">write</span>(i,<span class="string">' '</span>);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-树的合并"><a href="#P3-树的合并" class="headerlink" title="P3 树的合并"></a>P3 树的合并</h1><p>话说moreD经过不懈努力，终于背完了循环整数，也终于完成了他的蛋糕大餐。 但是不幸的是， moreD得到了诅咒，受到诅咒的原因至今无人知晓。<br>moreD在发觉自己得到诅咒之后，决定去寻找闻名遐迩的术士CD帮忙。 话说CD最近在搞OI，遇到了一道有趣的题目： 给定两棵树， 则总共有N*M种方案把这两棵树通过加一条边连成一棵树， 那这N*M棵 树的直径之和是多少呢？<br>CD为了考验moreD是否值得自己费心力为他除去诅咒，于是要他编程回答这个问题， 但是这moreD早就被诅咒搞晕了头脑，就只好请你帮助他了。 </p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个正整数N,M，分别表示两棵树的大小。 接下来N-1行，每行两个正整数ai,bi,表示第一棵树上的边。 接下来M-1行，每行两个正整数ci,di,表示第二棵树上的边。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>一个整数，答案<br><!--more--></p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4 3<br>1 2<br>2 3<br>2 4<br>1 3<br>2 3</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>53</p>
</blockquote>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>首先，类似于P1，求两棵树上，每一个点的最长路g[i]。$O(N+M)$<br>然后，如果枚举的话$O(NM)$肯定会TLE的，于是<strong>乱搞</strong>：<br>cnt[l]统计g[i]小于l的节点个数，做前缀和即可，$O(N+M)$<br>顺便可以算出两棵树原来的直径d[0]和d[1]，我们记dl=max(d[0],d[1])</p>
<p>先想第一棵树：从节点i连一条边到另一棵树的节点x上，当$g[i]+g[x]+1&gt;=dl$时，g[i]会被统计进答案，将式子变形一下$g[x]&gt;=dl-g[i]-1$，也就是说g[i]被统计进答案的次数=另一棵树上最长路$&gt;=dl-g[i]-1$的节点个数，这个值我们用cnt算过了。<br>同理考虑第二棵树就可以了。</p>
<p>为了防止 新连的边1 和 不能形成新的直径（新直径小于dl）的树 被重复计算，我们统计n*m棵树中，能连成新直径的树的个数是$k$，答案加上$k+(n*m-k)*dl$就可以了。</p>
<p>这样总的复杂度是$O(N+M)$<br>但是有三个点数据量太大导致递归过深，然后202了。。。这不怪我，因为我试了一下标程也202了233。</p>
<dir style="text-align:right"><a href="/2016/08/18/JSOI2016-提高2班-树形DP/connect.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>connect.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line">    tree=<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200010</span>] <span class="keyword">of</span> edge;</div><div class="line">    arr=<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    t:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> tree;</div><div class="line">    h:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> arr;</div><div class="line">    f,g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">100010</span>,<span class="number">0</span>..<span class="number">2</span>] <span class="keyword">of</span> int;</div><div class="line">    cnt:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    d,n:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    i,j,f0,t0,dl,k,tmp:int;ans:int64;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(<span class="keyword">var</span> g:tree;<span class="keyword">var</span> head:arr;f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(x,v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u,tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fillchar(f[x,v],sizeof(f[x,v]),<span class="number">0</span>);</div><div class="line">    i:=h[x][v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=t[x][i].t;</div><div class="line">        <span class="keyword">if</span> u&lt;&gt;p <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dp(x,u,v);</div><div class="line">            tmp:=f[x,u,<span class="number">0</span>]+<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span> tmp&gt;f[x,v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                f[x,v,<span class="number">1</span>]:=f[x,v,<span class="number">0</span>];</div><div class="line">                f[x,v,<span class="number">0</span>]:=tmp;</div><div class="line">                f[x,v,<span class="number">2</span>]:=u;</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;f[x,v,<span class="number">1</span>] <span class="keyword">then</span> </div><div class="line">                f[x,v,<span class="number">1</span>]:=tmp;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=t[x][i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(x,v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    g[x,v]:=f[x,v];</div><div class="line">    <span class="keyword">if</span> p&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> </div><div class="line">        <span class="keyword">if</span> g[x,p,<span class="number">2</span>]&lt;&gt;v <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            tmp:=g[x,p,<span class="number">0</span>]+<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span> tmp&gt;g[x,v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                g[x,v,<span class="number">1</span>]:=g[x,v,<span class="number">0</span>];</div><div class="line">                g[x,v,<span class="number">0</span>]:=tmp;</div><div class="line">                g[x,v,<span class="number">2</span>]:=p;</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;g[x,v,<span class="number">1</span>] <span class="keyword">then</span></div><div class="line">                g[x,v,<span class="number">1</span>]:=tmp;</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">            tmp:=g[x,p,<span class="number">1</span>]+<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span> tmp&gt;g[x,v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                g[x,v,<span class="number">1</span>]:=g[x,v,<span class="number">0</span>];</div><div class="line">                g[x,v,<span class="number">0</span>]:=tmp;</div><div class="line">                g[x,v,<span class="number">2</span>]:=p;</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> tmp&gt;g[x,v,<span class="number">1</span>] <span class="keyword">then</span></div><div class="line">                g[x,v,<span class="number">1</span>]:=tmp;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    i:=h[x][v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> t[x][i].t&lt;&gt;p <span class="keyword">then</span> dfs(x,t[x][i].t,v);</div><div class="line">        i:=t[x][i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'connect.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'connect.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n[<span class="number">0</span>],n[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n[i]-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(f0,t0);</div><div class="line">            add(t[i],h[i],f0,t0);add(t[i],h[i],t0,f0);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span> </div><div class="line">        dp(i,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">        dfs(i,<span class="number">1</span>,<span class="number">0</span>) </div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        d[i]:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n[i] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt[i,g[i,j,<span class="number">0</span>]]);</div><div class="line">            d[i]:=max(d[i],g[i,j,<span class="number">0</span>]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> d[i] <span class="keyword">do</span></div><div class="line">            inc(cnt[i,j],cnt[i,j-<span class="number">1</span>]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    dl:=max(d[<span class="number">0</span>],d[<span class="number">1</span>]);</div><div class="line">    ans:=<span class="number">0</span>;k:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n[i] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            tmp:=n[<span class="number">1</span>-i]-cnt[<span class="number">1</span>-i,dl-g[i,j,<span class="number">0</span>]-<span class="number">1</span>];</div><div class="line">            inc(ans,tmp*g[i,j,<span class="number">0</span>]);</div><div class="line">            <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> inc(k,tmp);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    inc(ans,k+(n[<span class="number">0</span>]*n[<span class="number">1</span>]-k)*dl);</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P4-Contestants-Division"><a href="#P4-Contestants-Division" class="headerlink" title="P4 Contestants Division"></a>P4 Contestants Division</h1><p>有一棵N个点N-1条边的树，每个点有一个权值。需要删去一条边使这棵树分成的两部分权值差最小，求出最小的权值。</p>
<h2 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>含有多组测试数据，最后以0 0 结尾。<br>第一行：N和M，表示点数和边数（M=N-1）。<br>第二行：N个整数，表示N个点的权值。<br>接下来M行：每行两个数a，b，表示a和b有连边。</p>
<h2 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h2><p>最小的权值差。格式见样例<br><!--more--></p>
<h2 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-3"><a href="#样例输入-3" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>7 6<br>1 1 1 1 1 1 1<br>1 2<br>2 7<br>3 7<br>4 6<br>6 2<br>5 7<br>0 0</p>
</blockquote>
<h3 id="样例输出-3"><a href="#样例输出-3" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>Case 1: 1</p>
</blockquote>
<h2 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h2><p>这是<a href="http://poj.org/problem?id=3140" target="_blank" rel="external">POJ 3140</a>，题目被老师简化了于是直接做就好了，数据范围到POJ看吧。<br>ACM OJ对pascal总是异常的不友好，math库不能用，abs(int64)都没有重载。<br>关于这一题，统计子树权值和就可以了。</p>
<p><dir style="text-align:right"><a href="/2016/08/18/JSOI2016-提高2班-树形DP/3140.pas" title="复制代码">复制代码</a></dir><br><figure class="highlight delphi"><figcaption><span>3140.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,f0,t0,cnt:int;sum,ans:int64;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2000010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    w,f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int64;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">min</span><span class="params">(a,b:int64)</span>:</span>int64;</div><div class="line"><span class="keyword">begin</span> <span class="keyword">if</span> a&gt;b <span class="keyword">then</span> min:=b <span class="keyword">else</span> min:=a <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">qabs</span><span class="params">(a:int64)</span>:</span>int64;</div><div class="line"><span class="keyword">begin</span> <span class="keyword">if</span> a&lt;<span class="number">0</span> <span class="keyword">then</span> qabs:=-a <span class="keyword">else</span> qabs:=a <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dp</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    f[v]:=w[v];</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> p&lt;&gt;u <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dp(u,v);</div><div class="line">            inc(f[v],f[u]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=min(ans,qabs(sum-f[v]*<span class="number">2</span>));</div><div class="line"><span class="keyword">end</span>;</div><div class="line">    </div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n,m);cnt:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (n&lt;&gt;<span class="number">0</span>) <span class="keyword">and</span> (m&lt;&gt;<span class="number">0</span>) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        fillchar(head,sizeof(head),<span class="number">0</span>);</div><div class="line">        sum:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(w[i]);</div><div class="line">            inc(sum,w[i]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(f0,t0);</div><div class="line">            add(f0,t0);add(t0,f0);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        ans:=sum;</div><div class="line">        dp(<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">        inc(cnt);</div><div class="line">        writeln(<span class="string">'Case '</span>,cnt,<span class="string">': '</span>,ans);</div><div class="line">        <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-学校网络&quot;&gt;&lt;a href=&quot;#P1-学校网络&quot; class=&quot;headerlink&quot; title=&quot;P1 学校网络&quot;&gt;&lt;/a&gt;P1 学校网络&lt;/h1&gt;&lt;p&gt;一所学校在几年前购进了第一台电脑（这台电脑的编号为1）。最近几年，学校又购买了N-1台电脑，每台新电脑和之前的某一台电脑连接。学校的管理员想知道对于每一台电脑i，到与它距离最远的电脑的距离Si。你需要提供这个信息。&lt;br&gt;&lt;img src=&quot;/2016/08/18/JSOI2016-提高2班-树形DP/T.jpg&quot; alt=&quot;T.jpg&quot; title=&quot;&quot;&gt;&lt;br&gt;Hint: 样例输入如上图所示，从图中你可以知道，4号电脑到1号电脑的距离最远，所以S1=3。4号电脑和5号电脑到2号电脑的距离最远，所以S2=2。5号电脑到3号电脑距离最远，所以S3=3。由此类推S4=4，S5=4。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;输入文件包含多组测试数据，对于每组测试数据：&lt;br&gt;第一行包含一个整数N (N&amp;lt;=10000) ；&lt;br&gt;接下来N-1行描述每一台电脑。第i行包含两个用空格隔开的整数y、l，表示i号电脑与之前的y号电脑连接，距离为l。&lt;br&gt;所有l之和不超过10^9。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;对于每组测试数据输出N行，第i行表示离i号电脑的最远距离Si。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="树形DP" scheme="https://cothrax.github.io/tags/%E6%A0%91%E5%BD%A2DP/"/>
    
      <category term="树形背包" scheme="https://cothrax.github.io/tags/%E6%A0%91%E5%BD%A2%E8%83%8C%E5%8C%85/"/>
    
      <category term="树结构" scheme="https://cothrax.github.io/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高1班 Day2</title>
    <link href="https://cothrax.github.io/2016/08/17/JSOI2016-%E6%8F%90%E9%AB%981%E7%8F%AD-Day2/"/>
    <id>https://cothrax.github.io/2016/08/17/JSOI2016-提高1班-Day2/</id>
    <published>2016-08-17T14:33:59.000Z</published>
    <updated>2016-08-18T03:39:33.118Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-超市"><a href="#P1-超市" class="headerlink" title="P1 超市"></a>P1 超市</h1><p>超市正在举行一个活动，该活动的规则如下：<br>想要参与的顾客会将他购物的账单放入纸箱中，账单上写有顾客的联系方式和购物的金额。每天超市关门前纸箱中金额最大、最小的两张帐单被取出，付款金额最大的顾客将获得一笔奖金，价值为取出的两张帐单的金额之差；为了不重复计算，取出的两张帐单不再放回箱子，而剩下的帐单仍保留在箱中，进行第二天的活动。<br>顾客很多，因此可假定：每天活动结束时，箱中至少有两张帐单以供取出。<br>小h也参加了这次活动，他想知道整个活动期间超市付出的奖金总额是多少？</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行是一个整数n，表示活动历时的天数。<br>以下的n行，每行包含若干由空格分隔的非负整数。第i+1行的数表示在第i天投入箱子的账单金额。每行的第一个数是一个整数k，表示当日账单的数目。后面的k个正整数代表这k笔账单的金额。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一个数，表示活动期间超市付出的奖金总额。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>3 1 2 3<br>2 1 1<br>4 10 5 5 1<br>0<br>1 2</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>19</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>设s为整个活动中涉及到的账单笔数。<br>30%的数据满足n≤100,s≤10000。<br>70%的数据满足s≤10^5。<br>100%的数据满足1≤n≤5000,0≤k≤10^5,s≤10^6,每笔账单的金额不超过10^6。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>用一个大根堆和一个小根堆，维护值对{金额,编号}，用del[i]记录编号i的账单是否已经被取出，然后模拟即可。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高1班-Day2/market.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>market.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> big=<span class="number">1</span>;small=-<span class="number">1</span>;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    heap=<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1000010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tmp:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    tmp:=a;a:=b;b:=tmp;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">com</span><span class="params">(p,c,s:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> s=big <span class="keyword">then</span> com:=p&gt;c <span class="keyword">else</span> com:=p&lt;c;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">heapify</span><span class="params">(<span class="keyword">var</span> h:heap;x:int)</span>;</span></div><div class="line"><span class="keyword">var</span> l,r,s:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    l:=<span class="number">2</span>*x;r:=<span class="number">2</span>*x+<span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (l&lt;=h[<span class="number">0</span>,<span class="number">0</span>]) <span class="keyword">and</span> com(h[l,<span class="number">0</span>],h[x,<span class="number">0</span>],h[<span class="number">0</span>,<span class="number">1</span>]) <span class="keyword">then</span> s:=l <span class="keyword">else</span> s:=x;</div><div class="line">    <span class="keyword">if</span> (r&lt;=h[<span class="number">0</span>,<span class="number">0</span>]) <span class="keyword">and</span> com(h[r,<span class="number">0</span>],h[s,<span class="number">0</span>],h[<span class="number">0</span>,<span class="number">1</span>]) <span class="keyword">then</span> s:=r;</div><div class="line">    <span class="keyword">if</span> s&lt;&gt;x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        swap(h[s,<span class="number">0</span>],h[x,<span class="number">0</span>]);</div><div class="line">        swap(h[s,<span class="number">1</span>],h[x,<span class="number">1</span>]);</div><div class="line">        heapify(h,s);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">extract</span><span class="params">(<span class="keyword">var</span> h:heap)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    h[<span class="number">1</span>]:=h[h[<span class="number">0</span>,<span class="number">0</span>]];</div><div class="line">    dec(h[<span class="number">0</span>,<span class="number">0</span>]);</div><div class="line">    heapify(h,<span class="number">1</span>);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">insert</span><span class="params">(<span class="keyword">var</span> h:heap;k,v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(h[<span class="number">0</span>,<span class="number">0</span>]);i:=h[<span class="number">0</span>,<span class="number">0</span>];</div><div class="line">    h[i,<span class="number">0</span>]:=v;h[i,<span class="number">1</span>]:=k;</div><div class="line">    <span class="keyword">while</span> (i&gt;<span class="number">1</span>) <span class="keyword">and</span> com(h[i,<span class="number">0</span>],h[i <span class="keyword">div</span> <span class="number">2</span>,<span class="number">0</span>],h[<span class="number">0</span>,<span class="number">1</span>]) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        swap(h[i,<span class="number">0</span>],h[i <span class="keyword">div</span> <span class="number">2</span>,<span class="number">0</span>]);</div><div class="line">        swap(h[i,<span class="number">1</span>],h[i <span class="keyword">div</span> <span class="number">2</span>,<span class="number">1</span>]);</div><div class="line">        i:=i <span class="keyword">div</span> <span class="number">2</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> </div><div class="line">    hb,hs:heap;</div><div class="line">    i,j,n,m,cnt,each,b,s:int;</div><div class="line">    ans:int64;</div><div class="line">    del:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1000010</span>] <span class="keyword">of</span> boolean;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'market.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'market.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    fillchar(del,sizeof(del),false);</div><div class="line">    hb[<span class="number">0</span>,<span class="number">0</span>]:=<span class="number">0</span>;hb[<span class="number">0</span>,<span class="number">1</span>]:=big;</div><div class="line">    hs[<span class="number">0</span>,<span class="number">0</span>]:=<span class="number">0</span>;hs[<span class="number">0</span>,<span class="number">1</span>]:=small;</div><div class="line">    cnt:=<span class="number">0</span>;ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(m);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt);</div><div class="line">            <span class="keyword">read</span>(each);</div><div class="line">            insert(hs,cnt,each);</div><div class="line">            insert(hb,cnt,each);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="comment">//writeln(hb[0,0],' ',hs[0,0],' ',ans);</span></div><div class="line">        <span class="keyword">while</span> del[hb[<span class="number">1</span>,<span class="number">1</span>]] <span class="keyword">do</span> extract(hb);</div><div class="line">        b:=hb[<span class="number">1</span>,<span class="number">0</span>];del[hb[<span class="number">1</span>,<span class="number">1</span>]]:=true;extract(hb);</div><div class="line">        <span class="keyword">while</span> del[hs[<span class="number">1</span>,<span class="number">1</span>]] <span class="keyword">do</span> extract(hs);</div><div class="line">        s:=hs[<span class="number">1</span>,<span class="number">0</span>];del[hs[<span class="number">1</span>,<span class="number">1</span>]]:=true;extract(hs);</div><div class="line">        inc(ans,b-s);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-醉酒"><a href="#P2-醉酒" class="headerlink" title="P2 醉酒"></a>P2 醉酒</h1><p>小X 家住在一条东西向的大街上。在他们家的东面，自东向西依次分布着n 幢相似的房<br>屋，编号为1 到n,可以用一个长度为n 的字符串表示这n 幢房屋的颜色。<br>小X 的父亲经常喝醉酒，每次醉酒后他都会稀里糊涂地走到第Ai 幢房屋前，然后坚信<br>他现在第Bi 幢房屋前。虽然他喝醉了，但是他依然能分清每幢房屋的颜色，并且掏出地图<br>进行比较，只有房屋颜色和地图上一致时，他才会继续向西走。当他发现自己的错误或者不<br>能前进时，就会停下来。现在，小X 记录下了每次的数据Ai 和Bi，他希望知道父亲最多走<br>过多少幢相同颜色的房屋。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行两个数n 和m，表示n 幢房屋和m 次询问。<br>第二行一个长度为n 的字符串，仅包含大写字母。<br>接下来m 行，每行两个数Ai 和Bi。</p>
<h3 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h3><p>m 行，每个一个数，表示小X 的父亲父亲最多走过多少幢相同颜色的房屋。</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h3><blockquote>
<p>10 6<br>AABBCCAABB<br>1 7<br>7 1<br>3 4<br>4 9<br>2 5<br>5 5</p>
</blockquote>
<h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h3><blockquote>
<p>4<br>4<br>1<br>1<br>0<br>6</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>对于60%的数据，n,m≤100。<br>对于80%的数据，n≤1000。<br>对于100%的数据，n,m≤100000,Ai,Bi≤n。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>双字符串Hash+二分答案<br>预处理前缀Hash：$O(N)$<br>对于每个查询二分：$O(MlogN)$<br>hash函数要写好，注意端点。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高1班-Day2/drunk.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>drunk.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"></div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">const</span> </div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int=(<span class="number">1000019</span>,<span class="number">100000007</span>);</div><div class="line">    p:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int=(<span class="number">1009</span>,<span class="number">133</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span></div><div class="line">    n,m,i,j,k:int;</div><div class="line">    s:ansistring;</div><div class="line">    pn,f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int64;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(l,r,j:int)</span>:</span>int64;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    hash:=(f[j,r]-f[j,l-<span class="number">1</span>]*pn[j,r-l+<span class="number">1</span>] <span class="keyword">mod</span> q[j]+q[j]) <span class="keyword">mod</span> q[j];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(i,j:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> l,r,mid:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> i&gt;j <span class="keyword">then</span> <span class="keyword">begin</span> l:=i;i:=j;j:=l <span class="keyword">end</span>;</div><div class="line">    l:=<span class="number">1</span>;r:=n-j+<span class="number">1</span>;query:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (hash(i,i+mid-<span class="number">1</span>,<span class="number">0</span>)=hash(j,j+mid-<span class="number">1</span>,<span class="number">0</span>)) <span class="keyword">and</span></div><div class="line">           (hash(i,i+mid-<span class="number">1</span>,<span class="number">1</span>)=hash(j,j+mid-<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            query:=mid;l:=mid+<span class="number">1</span>;</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> r:=mid-<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'drunk.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'drunk.out'</span>);rewrite(output);</div><div class="line">    </div><div class="line">    readln(n,m);readln(s);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span> f[i,<span class="number">0</span>]:=<span class="number">0</span>;pn[i,<span class="number">0</span>]:=<span class="number">1</span> <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> </div><div class="line">        <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            pn[j,i]:=pn[j,i-<span class="number">1</span>]*p[j] <span class="keyword">mod</span> q[j];</div><div class="line">            f[j,i]:=(f[j,i-<span class="number">1</span>]*p[j]+ord(s[i])) <span class="keyword">mod</span> q[j];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j,k);</div><div class="line">        writeln(query(j,k));</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-方块游戏"><a href="#P3-方块游戏" class="headerlink" title="P3 方块游戏"></a>P3 方块游戏</h1><p>小A 和小B 在玩一个方块游戏。编号为1 到n(1&lt;=n&lt;=30000)的n 个方块正放在地上。<br>每个构成一个立方柱。<br>游戏开始后，小A 会给小B 发出p(1&lt;=p&lt;=100000)个指令。</p>
<ol>
<li>移动(M)：将包含X 的立方柱移动到包含Y 的立方柱上。</li>
<li>统计(C)：统计含X 的立方柱中，在X 下方的方块数目。</li>
</ol>
<p>写个程序帮小B 完成游戏。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第1 行输入P，之后P 行每行输入一条指令。形式为“M X Y”或者“C X”。<br>输入保证不会有将立方柱放在自己头上的指令。</p>
<h3 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h3><p>每一行，对于每个统计指令，输出其结果。</p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="输入样例-1"><a href="#输入样例-1" class="headerlink" title="输入样例"></a>输入样例</h3><blockquote>
<p>6<br>M 1 6<br>C 1<br>M 2 4<br>M 2 6<br>C 3<br>C 4</p>
</blockquote>
<h3 id="输出样例-1"><a href="#输出样例-1" class="headerlink" title="输出样例"></a>输出样例</h3><blockquote>
<p>1<br>0<br>2</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p>对于40%的数据，n,P≤200。<br>对于60%的数据，n,P≤2000。<br>对于100%的数据，n,P≤100000。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>并查集。</p>
<ol>
<li>记dist[i]是i到par[i]的距离，即i与par[i]之间 包含par[i] 不包含i 的方块格数</li>
<li>记len[i]是根i所在立方体的方块个数，当i不是根时=0</li>
</ol>
<p>然后在查询和合并时维护即可。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高1班-Day2/cubes.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>drunk.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">const</span> n=<span class="number">100000</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    par,dist,len:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    p,i,x,y:int;c:char;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span><span class="params">(x:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> par[x]=x <span class="keyword">then</span> find:=x</div><div class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">        find:=find(par[x]);</div><div class="line">        inc(dist[x],dist[par[x]]);</div><div class="line">        par[x]:=find;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">union</span><span class="params">(x,y:int)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    x:=find(x);y:=find(y);</div><div class="line">    par[x]:=y;</div><div class="line">    dist[x]:=len[y];</div><div class="line">    inc(len[y],len[x]);</div><div class="line">    len[x]:=<span class="number">0</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(x:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> par[x]=x <span class="keyword">then</span> query:=<span class="number">1</span></div><div class="line">    <span class="keyword">else</span> query:=dist[x]+query(par[x]);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'cubes.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'cubes.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        par[i]:=i;</div><div class="line">        dist[i]:=<span class="number">0</span>;</div><div class="line">        len[i]:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    readln(p);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> p <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(c);</div><div class="line">        <span class="keyword">if</span> c=<span class="string">'M'</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            readln(x,y);</div><div class="line">            union(x,y);</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">            readln(x);</div><div class="line">            writeln(query(x)-<span class="number">1</span>);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P4-道路网"><a href="#P4-道路网" class="headerlink" title="P4 道路网"></a>P4 道路网</h1><p>C国的道路网络由若干条双向线路组成。每条线路途经一些城市(可能会经过多次同一<br>城市)，位于线路上的两个城市a，b通过i号线路互相抵达的费用为 w[i][a] + w[i][b]。现在有若干个询问，询问两城市互相到达的最小费用。</p>
<h2 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行为城市数n与线路数m。<br>以下m行每行描述一条线路：<br>第一个正整数l[i]为i号线路途经的城市数，接下来2*l[i]个正整数，每两个数描述一个城市，依次表示途经的城市j，费用w[i][j]；接下来若干行每行两个正整数a，b表示询问a，b之间的最小费用，最后以0 0结束。</p>
<h3 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h3><p>每一行，对于每个统计指令，输出其结果。</p>
<h2 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h2><h3 id="输入样例-2"><a href="#输入样例-2" class="headerlink" title="输入样例"></a>输入样例</h3><blockquote>
<p>4 2<br>3 1 1 2 1 3 3<br>3 1 2 2 1 4 2<br>1 2<br>3 4<br>2 4<br>0 0</p>
</blockquote>
<h3 id="输出样例-2"><a href="#输出样例-2" class="headerlink" title="输出样例"></a>输出样例</h3><blockquote>
<p>2<br>7<br>3</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>令T为询问数<br>10%的数据满足n≤10,m≤3,T≤3。<br>30%的数据满足n,T≤100,m,l[i]≤15。<br>50%的数据满足n≤1000,T≤100,m,l[i]≤50。<br>100%的数据满足n≤100000,m≤300,T,l[i],w[i][j]≤2000。</p>
<h2 id="水解"><a href="#水解" class="headerlink" title="水解"></a>水解</h2><p>$w[i][a] + w[i][b]$，把线路当成点，然后n+m个点跑Floyd，<br>30分到手。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高1班-Day2/map.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>map.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">100000000</span>;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1110</span>,<span class="number">0</span>..<span class="number">1110</span>] <span class="keyword">of</span> int;</div><div class="line">    n,m,l,k,i,j,tmp:int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'map.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'map.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(l);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> l <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(k);<span class="keyword">read</span>(tmp);</div><div class="line">            f[k,i+n]:=min(f[k,i+n],tmp);</div><div class="line">            f[i+n,k]:=f[k,i+n];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m+n <span class="keyword">do</span> f[i,i]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> k:=<span class="number">1</span> <span class="keyword">to</span> m+n <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m+n <span class="keyword">do</span></div><div class="line">            <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m+n <span class="keyword">do</span></div><div class="line">                f[i,j]:=min(f[i,j],f[i,k]+f[k,j]);</div><div class="line">    <span class="keyword">read</span>(i,j);</div><div class="line">    <span class="keyword">while</span> (i&lt;&gt;<span class="number">0</span>) <span class="keyword">and</span> (j&lt;&gt;<span class="number">0</span>) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> f[i,j]=inf <span class="keyword">then</span> writeln(-<span class="number">1</span>) <span class="keyword">else</span> writeln(f[i,j]);</div><div class="line">        <span class="keyword">read</span>(i,j);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h2><p>线路数非常小，我们从线路入手，依然把线路看成点，每两个城市的路径必然要经过代表线路的点，先考虑线路间的切换。<br>贪心地考虑两条线路i和j：记它们的公用城市为a，i和j的连边为<span>$min\{w[i,a]+w[j,a]\}$</span><!-- Has MathJax -->，<br>然后在线路设点组成的图上跑Floyd。<br>对于每个查询，枚举经过两点的线路算最小值就可以了。</p>
<p>处理线路间的连边可以用类似 前向星计数排序 的思想，在$O(l[i]*m)$的时间内将w[i,j]压缩进一个数组，也可以用规模为n的指针数组实现。<br>手残敲错了一次floyd。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高1班-Day2/0map.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>0map.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">100000000</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,k,i,j,t1,t2,ans,last:int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">310</span>,<span class="number">0</span>..<span class="number">310</span>] <span class="keyword">of</span> int; <span class="comment">//floyd</span></div><div class="line">    e:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">310</span>,<span class="number">0</span>..<span class="number">2010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int; <span class="comment">//原始数据</span></div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">600010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int; <span class="comment">//压缩后数据</span></div><div class="line">    cnt,l,r,p:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int; <span class="comment">//计数,左端点,右端点,当前指针</span></div><div class="line">    s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">310</span>] <span class="keyword">of</span> int; <span class="comment">//题中的l</span></div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'map.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'map.out'</span>);rewrite(output);</div><div class="line">    <span class="comment">//input</span></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    fillchar(cnt,sizeof(cnt),<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(s[i]);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> s[i] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(e[i,j,<span class="number">0</span>],e[i,j,<span class="number">1</span>]);</div><div class="line">            inc(cnt[e[i,j,<span class="number">0</span>]]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="comment">//指针</span></div><div class="line">    last:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        l[i]:=last+<span class="number">1</span>;</div><div class="line">        r[i]:=last+cnt[i];</div><div class="line">        p[i]:=l[i];</div><div class="line">        last:=r[i];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="comment">//e压进g（类似计数排序）</span></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span>    </div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> s[i] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            g[p[e[i,j,<span class="number">0</span>]],<span class="number">0</span>]:=i;</div><div class="line">            g[p[e[i,j,<span class="number">0</span>]],<span class="number">1</span>]:=e[i,j,<span class="number">1</span>];</div><div class="line">            inc(p[e[i,j,<span class="number">0</span>]]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="comment">//init f</span></div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=l[i] <span class="keyword">to</span> r[i] <span class="keyword">do</span></div><div class="line">            <span class="keyword">for</span> k:=l[i] <span class="keyword">to</span> r[i] <span class="keyword">do</span></div><div class="line">                f[g[j,<span class="number">0</span>],g[k,<span class="number">0</span>]]:=min(f[g[j,<span class="number">0</span>],g[k,<span class="number">0</span>]],g[j,<span class="number">1</span>]+g[k,<span class="number">1</span>]);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> f[i,i]:=<span class="number">0</span>;</div><div class="line">    <span class="comment">//floyd</span></div><div class="line">    <span class="keyword">for</span> k:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span>    </div><div class="line">            <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">                f[i,j]:=min(f[i,j],f[i,k]+f[k,j]);</div><div class="line">    <span class="comment">//query</span></div><div class="line">    <span class="keyword">read</span>(t1,t2);</div><div class="line">    <span class="keyword">while</span> (t1&lt;&gt;<span class="number">0</span>) <span class="keyword">and</span> (t2&lt;&gt;<span class="number">0</span>) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        ans:=inf;</div><div class="line">        <span class="keyword">for</span> i:=l[t1] <span class="keyword">to</span> r[t1] <span class="keyword">do</span></div><div class="line">            <span class="keyword">for</span> j:=l[t2] <span class="keyword">to</span> r[t2] <span class="keyword">do</span></div><div class="line">                ans:=min(ans,g[i,<span class="number">1</span>]+f[g[i,<span class="number">0</span>],g[j,<span class="number">0</span>]]+g[j,<span class="number">1</span>]);</div><div class="line">        <span class="keyword">if</span> ans=inf <span class="keyword">then</span> writeln(-<span class="number">1</span>) <span class="keyword">else</span> writeln(ans);</div><div class="line">        <span class="keyword">read</span>(t1,t2);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-超市&quot;&gt;&lt;a href=&quot;#P1-超市&quot; class=&quot;headerlink&quot; title=&quot;P1 超市&quot;&gt;&lt;/a&gt;P1 超市&lt;/h1&gt;&lt;p&gt;超市正在举行一个活动，该活动的规则如下：&lt;br&gt;想要参与的顾客会将他购物的账单放入纸箱中，账单上写有顾客的联系方式和购物的金额。每天超市关门前纸箱中金额最大、最小的两张帐单被取出，付款金额最大的顾客将获得一笔奖金，价值为取出的两张帐单的金额之差；为了不重复计算，取出的两张帐单不再放回箱子，而剩下的帐单仍保留在箱中，进行第二天的活动。&lt;br&gt;顾客很多，因此可假定：每天活动结束时，箱中至少有两张帐单以供取出。&lt;br&gt;小h也参加了这次活动，他想知道整个活动期间超市付出的奖金总额是多少？&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行是一个整数n，表示活动历时的天数。&lt;br&gt;以下的n行，每行包含若干由空格分隔的非负整数。第i+1行的数表示在第i天投入箱子的账单金额。每行的第一个数是一个整数k，表示当日账单的数目。后面的k个正整数代表这k笔账单的金额。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出一个数，表示活动期间超市付出的奖金总额。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="数据结构" scheme="https://cothrax.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="堆" scheme="https://cothrax.github.io/tags/%E5%A0%86/"/>
    
      <category term="并查集" scheme="https://cothrax.github.io/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/"/>
    
      <category term="最短路" scheme="https://cothrax.github.io/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高2班 位运算</title>
    <link href="https://cothrax.github.io/2016/08/17/JSOI2016-%E6%8F%90%E9%AB%982%E7%8F%AD-%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    <id>https://cothrax.github.io/2016/08/17/JSOI2016-提高2班-位运算/</id>
    <published>2016-08-17T10:18:57.000Z</published>
    <updated>2016-08-18T03:34:11.718Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-拔河比赛"><a href="#P1-拔河比赛" class="headerlink" title="P1 拔河比赛"></a>P1 拔河比赛</h1><p>一个学校举行拔河比赛，所有的人被分成了两组，每个人必须（且只能够）在其中的一组，且两个组内的所有人体重加起来尽可能地接近。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>数据的第1行是一个n，表示参加拔河比赛的总人数，接下来的n行表示第1到第n个人的体重，每个人的体重weight都是整数。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>包含两个整数：分别是两个组的所有人的体重和，用一个空格隔开。注意如果这两个数不相等，则请把小的放在前面输出。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>3<br>100<br>90<br>200</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>190 200</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>60%的数据保证 n&lt;=100，1&lt;=weight&lt;=500。<br>100%的数据保证 n&lt;=500，1&lt;=weight&lt;=1000。</p>
<h2 id="水解"><a href="#水解" class="headerlink" title="水解"></a>水解</h2><p>变形背包，很显然。<br>记f[i,j]前i个人差值为j的情况是否可能，a[i]放到第一组认为是-a[i]，放到第二组认为是+a[i]，那么：$f[i,j]=f[i,j-a[i]]\ or\ f[i,j+a[i]]$<br>但复杂度是$O(N^2W)$，60分。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高2班-位运算/competition.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>competition.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,i0,i1:int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">501</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,-<span class="number">501000</span>..<span class="number">501000</span>] <span class="keyword">of</span> boolean;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'competition.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'competition.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    m:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(a[i]);</div><div class="line">        inc(m,a[i]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    fillchar(f,sizeof(f),false);</div><div class="line">    f[<span class="number">0</span>,<span class="number">0</span>]:=true;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        i0:=i <span class="keyword">mod</span> <span class="number">2</span>;i1:=<span class="number">1</span>-i0;</div><div class="line">        <span class="keyword">for</span> j:=-m <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">            f[i0,j]:=f[i1,j-a[i]] <span class="keyword">or</span> f[i1,j+a[i]];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    i0:=n <span class="keyword">mod</span> <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> f[i0,j] <span class="keyword">or</span> f[i0,-j] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">write</span>((m-j) <span class="keyword">div</span> <span class="number">2</span>,<span class="string">' '</span>,(m+j) <span class="keyword">div</span> <span class="number">2</span>);</div><div class="line">            halt</div><div class="line">        <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h2><p>C++有一个stl叫bitset，然而p没有。<br>思路是H[w]表示组合出体重w是否可行，那么每次读入x，w=可行解+x 都是可行的，于是<code>H|=H&lt;&lt;x</code><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">bitset</span>&lt;501000&gt; H;</div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">    H[<span class="number">0</span>]=<span class="literal">true</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">	     <span class="built_in">cin</span>&gt;&gt;x;s+=x;H=H|(H&lt;&lt;x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=s;i++)<span class="keyword">if</span>(H[i]&amp;&amp;i&lt;=s-i)x=i;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">" "</span>&lt;&lt;s-x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="P2-起床困难综合症"><a href="#P2-起床困难综合症" class="headerlink" title="P2 起床困难综合症"></a>P2 起床困难综合症</h1><p>21世纪，许多人得了一种奇怪的病：起床困难综合症，其临床表现为：起床难，起床后精神不佳。作为一名青春阳光好少年，atm一直坚持与起床困难综合症作斗争。通过研究相关文献，他找到了该病的发病原因：在深邃的太平洋海底中，出现了一条名为drd的巨龙，它掌握着睡眠之精髓，能随意延长大家的睡眠时间。正是由于drd的活动，起床困难综合症愈演愈烈，以惊人的速度在世界上传播。为了彻底消灭这种病，atm决定前往海底，消灭这条恶龙。<br>历经千辛万苦，atm终于来到了drd所在的地方，准备与其展开艰苦卓绝的战斗。drd有着十分特殊的技能，他的防御战线能够使用一定的运算来改变他受到的伤害。具体说来，drd的防御战线由n扇防御门组成。每扇防御门包括一个运算op和一个参数t，其中运算一定是OR,XOR,AND中的一种，参数则一定为非负整数。如果还未通过防御门时攻击力为x，则其通过这扇防御门后攻击力将变为xopt。最终drd受到的伤害为对方初始攻击力x依次经过所有n扇防御门后转变得到的攻击力。<br>由于atm水平有限，他的初始攻击力只能为0到m之间的一个整数（即他的初始攻击力只能在0,1,…,m中任选，但在通过防御门之后的攻击力不受m的限制）。为了节省体力，他希望通过选择合适的初始攻击力使得他的攻击能让drd受到最大的伤害，请你帮他计算一下，他的一次攻击最多能使drd受到多少伤害。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第1行包含2个整数，依次为n,m，表示drd有n扇防御门，atm的初始攻击力为0到m之间的整数。接下来n行，依次表示每一扇防御门。每行包括一个字符串op和一个非负整数t，两者由一个空格隔开，且op在前，t在后，op表示该防御门所对应的操作， t表示对应的参数。</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>一行一个整数，表示atm的一次攻击最多使 drd 受到多少伤害。</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>3 10<br>AND 5<br>OR 6<br>XOR 7</p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p><strong>补充说明</strong><br>atm可以选择的初始攻击力为0,1,…,10。<br>假设初始攻击力为4，最终攻击力经过了如下计算<br>4 AND 5 = 4<br>4 OR  6 = 6<br>6 XOR 7 = 1<br>类似的，我们可以计算出初始攻击力为1,3,5,7,9时最终攻击力为0，初始攻击力为0,2,4,6,8,10时最终攻击力为1，因此atm的一次攻击最多使 drd 受到的伤害值为1。<br><strong>数据范围</strong><br>0&lt;=m&lt;=10^9<br>0&lt;=t&lt;=10^9<br>运算一定为OR,XOR,AND 中的一种</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>位运算每一位都是独立的，于是从高到低枚举选择数字的每一位，分几种情况讨论：</p>
<ol>
<li>该位取0时经过n次操作结果取1，该位选择0一定最优。</li>
<li>若情况1不满足，该位取1时经过n次操作结果取1 且取1后值不超过m 这样我们也选择1。</li>
<li>上两种情况不满足，则该位取0一定比取1小且更不容易超过m。<br>可以直接用<span>$(0...0)_2$</span><!-- Has MathJax -->和<span>$(1...1)_2$</span><!-- Has MathJax -->，这样优化为$O(N)$。<br>代码丑的可以。</li>
</ol>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高2班-位运算/sleep.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>sleep.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span></div><div class="line">    a1,a0,ans,orig,p,t,c,i,n,m:int; </div><div class="line">    s,op:<span class="keyword">string</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'sleep.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'sleep.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    readln(n,m);</div><div class="line">    a0:=<span class="number">0</span>;a1:=<span class="keyword">not</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        readln(s);</div><div class="line">        p:=pos(<span class="string">' '</span>,s);</div><div class="line">        op:=copy(s,<span class="number">1</span>,p-<span class="number">1</span>);</div><div class="line">        val(copy(s,p+<span class="number">1</span>,length(s)-p),t,c);</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> op=<span class="string">'XOR'</span> <span class="keyword">then</span> <span class="keyword">begin</span> a0:=a0 xor t;a1:=a1 xor t <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> op=<span class="string">'OR'</span> <span class="keyword">then</span> <span class="keyword">begin</span> a0:=a0 <span class="keyword">or</span> t;a1:=a1 <span class="keyword">or</span> t <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">begin</span> a0:=a0 <span class="keyword">and</span> t;a1:=a1 <span class="keyword">and</span> t <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    ans:=<span class="number">0</span>; <span class="comment">//最终伤害</span></div><div class="line">    orig:=<span class="number">0</span>; <span class="comment">//原始伤害</span></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">30</span> <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span> </div><div class="line">        <span class="keyword">if</span> ((a0 <span class="keyword">shr</span> i) <span class="keyword">and</span> <span class="number">1</span>)=<span class="number">1</span> <span class="keyword">then</span></div><div class="line">            ans:=ans <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> i)</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (((a1 <span class="keyword">shr</span> i) <span class="keyword">and</span> <span class="number">1</span>)=<span class="number">1</span>) <span class="keyword">and</span> </div><div class="line">                ((orig <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> i))&lt;=m) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            ans:=ans <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> i);</div><div class="line">            orig:=orig <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> i);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-乒乓游戏"><a href="#P3-乒乓游戏" class="headerlink" title="P3 乒乓游戏"></a>P3 乒乓游戏</h1><p>一条大街上住着n个乒乓球爱好者，经常组织比赛切磋技术。每个人都有一个不同的技能值ai。每场比赛需要3个人：两名选手，一名裁判。他们有一个奇怪的规定，即裁判必须住在两名选手的中间，并且技能值也在两名选手之间。问一共能组织多少种比赛。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行是整数n，然后是n个不同的整数，即a1,a2,…,an，按照住处从左到右的顺序给每个乒乓球爱好者的技能值。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出比赛总数的值。<br><!--more--></p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>6 1 8 10 1</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>30%的数据 n&lt;=3000。<br>100%的数据 n&lt;=100000,ai&lt;=100000。 </p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>对于裁判i，记1..i-1中技能值小于a[i]的人数为ls，i+1..n中小于a[i]的人数rs，那么这个裁判能组织的比赛数$=sl*(n-i-sr)+(i-1-sl)*sr$<br>扫一遍i，可以用两个树状数组维护。</p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高2班-位运算/pingpong.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>pingpong.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> maxn=<span class="number">100000</span>;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    arr=<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    l,r,a:arr;</div><div class="line">    n,i,sl,sr:int;ans:int64;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">lowbit</span><span class="params">(x:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span> lowbit:=x <span class="keyword">and</span> (-x) <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(<span class="keyword">var</span> a:arr;x,k:int)</span>;</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> x=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</div><div class="line">    <span class="keyword">while</span> x&lt;=maxn <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(a[x],k);</div><div class="line">        inc(x,lowbit(x));</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(<span class="keyword">var</span> a:arr;x:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    sum:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> x&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(sum,a[x]);</div><div class="line">        dec(x,lowbit(x));</div><div class="line">    <span class="keyword">end</span>;    </div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'pingpong.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'pingpong.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(a[i]);</div><div class="line">        <span class="keyword">if</span> i&lt;&gt;<span class="number">1</span> <span class="keyword">then</span> add(r,a[i],<span class="number">1</span>);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        sl:=sum(l,a[i]);sr:=sum(r,a[i]);</div><div class="line">        inc(ans,sl*(n-i-sr)+(i-<span class="number">1</span>-sl)*sr);</div><div class="line">        add(r,a[i+<span class="number">1</span>],-<span class="number">1</span>);add(l,a[i],<span class="number">1</span>);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P4-黑客的攻击"><a href="#P4-黑客的攻击" class="headerlink" title="P4 黑客的攻击"></a>P4 黑客的攻击</h1><p>假设你是一个黑客，入侵了一个有着n台计算机(编号为0,1,…,n-1)的网络。一共有n种服务，每台计算机都运行着所有的服务。对于每台计算机，你都可以选择一项服务，终止这台计算机和所有和它相邻计算机的该项服务（如果其中的一些服务已经停止，则这些服务继续处于停止状态）。你的目标是让尽量多的服务完全瘫痪（即：没有任何计算机运行该项服务)</p>
<h2 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行为整数n；以下n行每行描述一台计算机的相邻计算机，其中第一个数m为相邻的计算机个数，接下来m个数为这些计算机的编号。</p>
<h2 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出完全瘫痪的服务器的最大数量<br><!--more--></p>
<h2 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-3"><a href="#样例输入-3" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4<br>1 1<br>1 0<br>1 3<br>1 2</p>
</blockquote>
<h3 id="样例输出-3"><a href="#样例输出-3" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>2</p>
</blockquote>
<h2 id="提示-3"><a href="#提示-3" class="headerlink" title="提示"></a>提示</h2><p>n≤16。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>看数据范围，状压DP，用二进制表示集合<br>a[i]预处理出点i相邻的节点，二进制表示<br>p[S]预处理出集合S所能够覆盖的点的集合<br>然后dp，<span>$f[S]=max\{f[S\ xor\ j]+1\ |\ j\in S\ and\ p[j]=(1\ shl\ n)-1\}$</span><!-- Has MathJax --></p>
<dir style="text-align:right"><a href="/2016/08/17/JSOI2016-提高2班-位运算/hacker.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>hacker.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,k,i,j,t,lowbit:int;</div><div class="line">    f,p:<span class="keyword">array</span>[<span class="number">0</span>..(<span class="number">1</span> <span class="keyword">shl</span> <span class="number">16</span>)-<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">17</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'hacker.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'hacker.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    k:=(<span class="number">1</span> <span class="keyword">shl</span> n)-<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(m);</div><div class="line">        a[i]:=<span class="number">1</span> <span class="keyword">shl</span> i;</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(t);</div><div class="line">            a[i]:=a[i] <span class="keyword">or</span> (<span class="number">1</span> <span class="keyword">shl</span> t);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> k <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        t:=i;</div><div class="line">        p[i]:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> t&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            lowbit:=t <span class="keyword">and</span> (-t);</div><div class="line">            p[i]:=p[i] <span class="keyword">or</span> a[round(ln(lowbit)/ln(<span class="number">2</span>))];</div><div class="line">            t:=t-lowbit;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> k <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        f[i]:=<span class="number">0</span>;j:=i;</div><div class="line">        <span class="keyword">while</span> j&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> p[j]=k <span class="keyword">then</span> f[i]:=max(f[i xor j]+<span class="number">1</span>,f[i]);</div><div class="line">            j:=(j-<span class="number">1</span>) <span class="keyword">and</span> i;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(f[k]);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-拔河比赛&quot;&gt;&lt;a href=&quot;#P1-拔河比赛&quot; class=&quot;headerlink&quot; title=&quot;P1 拔河比赛&quot;&gt;&lt;/a&gt;P1 拔河比赛&lt;/h1&gt;&lt;p&gt;一个学校举行拔河比赛，所有的人被分成了两组，每个人必须（且只能够）在其中的一组，且两个组内的所有人体重加起来尽可能地接近。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;数据的第1行是一个n，表示参加拔河比赛的总人数，接下来的n行表示第1到第n个人的体重，每个人的体重weight都是整数。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;包含两个整数：分别是两个组的所有人的体重和，用一个空格隔开。注意如果这两个数不相等，则请把小的放在前面输出。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="数据结构" scheme="https://cothrax.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="位运算" scheme="https://cothrax.github.io/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    
      <category term="树状数组" scheme="https://cothrax.github.io/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"/>
    
      <category term="状压DP" scheme="https://cothrax.github.io/tags/%E7%8A%B6%E5%8E%8BDP/"/>
    
  </entry>
  
  <entry>
    <title>[JSOI2016] 提高1班-Day1</title>
    <link href="https://cothrax.github.io/2016/08/16/JSOI2016-%E6%8F%90%E9%AB%981%E7%8F%AD-Day1/"/>
    <id>https://cothrax.github.io/2016/08/16/JSOI2016-提高1班-Day1/</id>
    <published>2016-08-16T14:10:35.000Z</published>
    <updated>2016-08-18T03:34:21.275Z</updated>
    
    <content type="html"><![CDATA[<h1 id="P1-选数"><a href="#P1-选数" class="headerlink" title="P1 选数"></a>P1 选数</h1><p>现在有一排共N个数，你需要从中选出恰好K个。选出K个数后，计算它们两两差值的绝对值的最小值S。你需要确定选出哪K个，才能最大化这个S。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入第一行两个正整数N、K，含义如上。<br>输入第二行N个正整数，依次表示这N个数A1~An。0＜Ai≤10^9。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>一行一个正整数，S的最大值。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>11 5<br>19 585 29 1111 5868 3331 272 4441 2251 868 581</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>1092</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>对于30%的数据，N≤18。<br>对于60%的数据，N≤20。<br>对于80%的数据，N≤100。<br>对于100%的数据，N≤100000，K&lt;=N</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>最大化最小值，典型的二分答案。<br>然而不知道怎么在O(N)内判定一个解的正确性。。。<br>我们贪心的想：<br>先qsort升序<br>最小的数一定要选，可以反正：如果选了次小的数没有选最小，那么把次小换成最小的答案一定更优。<br>于是先选a[last=1]，O(N)扫一遍，如果a[i]-a[last]&gt;=mid那么就选i，更新last，统计个数。</p>
<dir style="text-align:right"><a href="/2016/08/16/JSOI2016-提高1班-Day1/choose.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>choose.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    n,k,i,l,r,mid,ans:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tmp:int;</div><div class="line"><span class="keyword">begin</span> tmp:=a;a:=b;b:=tmp <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(b,e:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,j,x:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    i:=b;j:=e;x:=a[random(e-b)+b];</div><div class="line">    <span class="keyword">repeat</span></div><div class="line">        <span class="keyword">while</span> a[i]&lt;x <span class="keyword">do</span> inc(i);</div><div class="line">        <span class="keyword">while</span> a[j]&gt;x <span class="keyword">do</span> dec(j);</div><div class="line">        <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            swap(a[i],a[j]);</div><div class="line">            inc(i);dec(j);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">until</span> i&gt;j;</div><div class="line">    <span class="keyword">if</span> i&lt;e <span class="keyword">then</span> qsort(i,e);</div><div class="line">    <span class="keyword">if</span> b&lt;j <span class="keyword">then</span> qsort(b,j);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,last,cnt:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    cnt:=<span class="number">1</span>;last:=a[<span class="number">1</span>];</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> a[i]-last&gt;=x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            last:=a[i];</div><div class="line">            inc(cnt);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    check:=cnt&gt;=k;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'choose.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'choose.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,k);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(a[i]);</div><div class="line">    qsort(<span class="number">1</span>,n);</div><div class="line">    l:=<span class="number">0</span>;r:=a[n]-a[<span class="number">1</span>];</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;l:=mid+<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> r:=mid-<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P2-划区灌溉"><a href="#P2-划区灌溉" class="headerlink" title="P2 划区灌溉"></a>P2 划区灌溉</h1><p>约翰的奶牛们发现山脊上的草特别美味。为了维持草的生长，约翰打算安装若干喷灌器。<br>为简化问题，山脊可以看成一维的数轴，长为L(1≤L≤1,000,000)，而且L一定是一个偶数。每个喷灌器可以双向喷灌，并有确定的射程，该射程是一个整数，且不短于A，不长于B。A,B(1≤A≤B≤1000)都是给出的正整数。它所在位置的两边射程内，都属它的灌溉区域。现要求山脊的每一个区域都被灌溉到，而且喷灌器的灌溉区域不允许重叠。<br>约翰有N(1≤N≤1000)只奶牛，每一只都有特别喜爱的草区，第i只奶牛的草区是[Si，Ei]，不同奶牛的草区可以重叠。现要求，每只奶牛的草区仅被一个喷灌器灌溉。<br>寻找最少需要的喷灌器数目。</p>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h3><p>第1行：N,L.<br>第2行：A,B.<br>第3到N十2行：每行2个整数Si，Ei,(0≤S\&lt;E≤L).</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>最小的喷灌器数目。如果无法设计出满足条件的喷灌器数目，请输出-1.</p>
<h2 id="样例-1"><a href="#样例-1" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>2 8<br>1 2<br>6 7<br>3 6 </p>
</blockquote>
<h3 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>【样例说明】<br>如下图，只需安装三个喷灌器。c1,c2为奶牛们的草区。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">            |-----c2----|-c1|       </div><div class="line">|---1---|-------2-------|---3---|   </div><div class="line">+---+---+---+---+---+---+---+---+</div><div class="line">0   1   2   3   4   5   6   7   8</div></pre></td></tr></table></figure></p>
<p>【数据范围】<br>对于30%的数据，L≤100。<br>对于60%的数据，L≤10000。<br>对于100%的数据，1≤L≤1,000,000，1≤A≤B≤1000，1≤N≤1000。</p>
<h2 id="水解"><a href="#水解" class="headerlink" title="水解"></a>水解</h2><p>首先，看起来像线段覆盖DP，于是又$O(L^2)$的算法<br>左右都覆盖比较麻烦，可以看成只向左覆盖，范围[2*a,2*b]<br>80分，一个点TLE，还有一个不知道为什么WA。。。</p>
<dir style="text-align:right"><a href="/2016/08/16/JSOI2016-提高1班-Day1/divide.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>divide.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,l,a,b,i,j,k:int;</div><div class="line">    seg:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[-<span class="number">1010</span>..<span class="number">1000010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">com</span><span class="params">(x,y:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> (seg[x,<span class="number">0</span>]&lt;seg[y,<span class="number">0</span>]) <span class="keyword">or</span> </div><div class="line">       ((seg[x,<span class="number">0</span>]=seg[y,<span class="number">0</span>]) <span class="keyword">and</span> (seg[x,<span class="number">1</span>]&lt;seg[y,<span class="number">1</span>])) <span class="keyword">then</span> com:=true</div><div class="line">    <span class="keyword">else</span> com:=false;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tmp:int;</div><div class="line"><span class="keyword">begin</span> tmp:=a;a:=b;b:=tmp <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(b,e:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    i:=b;j:=e;seg[<span class="number">0</span>]:=seg[random(e-b)+b];</div><div class="line">    <span class="keyword">repeat</span></div><div class="line">        <span class="keyword">while</span> com(i,<span class="number">0</span>) <span class="keyword">do</span> inc(i);</div><div class="line">        <span class="keyword">while</span> com(<span class="number">0</span>,j) <span class="keyword">do</span> dec(j);</div><div class="line">        <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            swap(seg[i,<span class="number">0</span>],seg[j,<span class="number">0</span>]);swap(seg[i,<span class="number">1</span>],seg[j,<span class="number">1</span>]);</div><div class="line">            inc(i);dec(j);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">until</span> i&gt;j;</div><div class="line">    <span class="keyword">if</span> i&lt;e <span class="keyword">then</span> qsort(i,e);</div><div class="line">    <span class="keyword">if</span> b&lt;j <span class="keyword">then</span> qsort(b,j);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'divide.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'divide.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    <span class="keyword">read</span>(n,l,a,b);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(seg[i,<span class="number">0</span>],seg[i,<span class="number">1</span>]);</div><div class="line">    qsort(<span class="number">1</span>,n);</div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    seg[<span class="number">0</span>,<span class="number">1</span>]:=<span class="number">0</span>;seg[<span class="number">0</span>,<span class="number">0</span>]:=<span class="number">0</span>;seg[n+<span class="number">1</span>,<span class="number">0</span>]:=l;</div><div class="line"></div><div class="line">    f[<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n+<span class="number">1</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=seg[i-<span class="number">1</span>,<span class="number">1</span>] <span class="keyword">to</span> seg[i,<span class="number">0</span>] <span class="keyword">do</span></div><div class="line">            <span class="keyword">for</span> k:=a <span class="keyword">to</span> b <span class="keyword">do</span></div><div class="line">                f[j]:=min(f[j],f[j-k*<span class="number">2</span>]+<span class="number">1</span>);</div><div class="line">    <span class="keyword">if</span> f[l]=inf <span class="keyword">then</span> <span class="keyword">write</span>(-<span class="number">1</span>) <span class="keyword">else</span> <span class="keyword">write</span>(f[l]);</div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h2><p>然后发现对于第i个位置，决策在[i-2<em>b,i-2</em>a]，于是想到了 定窗长最大值 的模型，而且决策单调，于是用单调队列优化成O(N)。<br>注意：</p>
<ol>
<li>同理看成向左覆盖，只能在偶数点处理</li>
<li>注意端点和队列指针的细节</li>
<li>被奶牛的草区覆盖的点不做处理，这可以用差分序列c预处理O(N)</li>
</ol>
<dir style="text-align:right"><a href="/2016/08/16/JSOI2016-提高1班-Day1/0divide.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>0divide.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,l,a,b,h,t,i,x:int;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    c,f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1000010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'divide.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'divide.out'</span>);rewrite(output);</div><div class="line">    </div><div class="line">    <span class="keyword">read</span>(n,l,a,b);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(h,t);</div><div class="line">        inc(c[h+<span class="number">1</span>]);dec(c[t]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> l <span class="keyword">do</span> inc(c[i],c[i-<span class="number">1</span>]);</div><div class="line"></div><div class="line">    filldword(f,sizeof(f) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    f[<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">    h:=<span class="number">0</span>;t:=<span class="number">0</span>;i:=<span class="number">2</span>;</div><div class="line">    <span class="keyword">while</span> i&lt;=l <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        x:=i-<span class="number">2</span>*a;</div><div class="line">        <span class="keyword">if</span> x&gt;=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">while</span> (h&lt;&gt;t) <span class="keyword">and</span> (q[t-<span class="number">1</span>,<span class="number">0</span>]&gt;=f[x]) <span class="keyword">do</span> dec(t);</div><div class="line">            q[t,<span class="number">0</span>]:=f[x];q[t,<span class="number">1</span>]:=x;</div><div class="line">            inc(t);<span class="keyword">if</span> t&gt;<span class="number">10010</span> <span class="keyword">then</span> t:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">if</span> c[i]=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            x:=i-<span class="number">2</span>*b;</div><div class="line">            <span class="keyword">while</span> (h&lt;&gt;t) <span class="keyword">and</span> (q[h,<span class="number">1</span>]&lt;x) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                inc(h);<span class="keyword">if</span> h&gt;<span class="number">10010</span> <span class="keyword">then</span> h:=<span class="number">0</span>;</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">            <span class="keyword">if</span> (h=t) <span class="keyword">or</span> (q[h,<span class="number">0</span>]=inf) <span class="keyword">then</span> f[i]:=inf <span class="keyword">else</span> f[i]:=q[h,<span class="number">0</span>]+<span class="number">1</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        inc(i,<span class="number">2</span>);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> f[l]=inf <span class="keyword">then</span> <span class="keyword">write</span>(-<span class="number">1</span>) <span class="keyword">else</span> <span class="keyword">write</span>(f[l]);</div><div class="line"></div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P3-树林"><a href="#P3-树林" class="headerlink" title="P3 树林"></a>P3 树林</h1><p>现在有一片树林，小B很想知道，最少需要多少步能围绕树林走一圈，最后回到起点．他能上下左右走，也能走对角线格子。<br>土地被分成R行C列（1≤R≤50,1≤C≤50)，下面是一张样例的地图，其中“.”表示小B可以走的空地，”X”表示树林，”*”表示起点。而小B走的最近的路己经特别地用“+”表示出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">. . . + . . .</div><div class="line">. . + X + . .</div><div class="line">. + X X X + .</div><div class="line">. . + X X X +</div><div class="line">. . + X . . +</div><div class="line">. . . + + + *</div></pre></td></tr></table></figure></p>
<p>题目保证，一定有合法解并且有且只有一片树林，树林一定是上下左右联通的。</p>
<h2 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h3><p> 第1行输入R和C，接下来R行C列表示一张地图。地图中的符号如题干所述。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出最少的步数。</p>
<h2 id="样例-2"><a href="#样例-2" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>6 7<br>…….<br>…X…<br>..XXX..<br>…XXX.<br>…X…<br>……*</p>
</blockquote>
<h3 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>13</p>
</blockquote>
<h2 id="提示-1"><a href="#提示-1" class="headerlink" title="提示"></a>提示</h2><p>对于40%的数据，R,C≤12<br>对于60%的数据，R,C≤30<br>对于100%的数据，R,C≤50</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>神奇的题目，我们取一棵树（如取横坐标最小的），水平向左引一条射线（图中“-”）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">. . . + . . .</div><div class="line">. . a X + . .</div><div class="line">- - X X X + .</div><div class="line">. . b X X X +</div><div class="line">. . + X . . +</div><div class="line">. . . + + + *</div></pre></td></tr></table></figure></p>
<p>然后在<strong>不穿过这条线</strong>的情况下从起点BFS，那么一条合法路径必然是：</p>
<ol>
<li>从起点，不穿过线到达射线下一点b</li>
<li>从b穿过线到达射线上一点a</li>
<li>从a不穿过射线回到起点</li>
</ol>
<p>1和3的最短路在bfs里算过了；2的话，记b(i-1,j) a(i+1,k)，那么路径2的值就是$max(|k-j|,2)$<br>两个循环枚举a,b就好了。</p>
<dir style="text-align:right"><a href="/2016/08/16/JSOI2016-提高1班-Day1/grove.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>grove.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=integer;</div><div class="line"><span class="keyword">const</span> </div><div class="line">    dir:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">7</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int=</div><div class="line">    ((<span class="number">0</span>,<span class="number">1</span>),(<span class="number">0</span>,-<span class="number">1</span>),(<span class="number">1</span>,<span class="number">0</span>),(-<span class="number">1</span>,<span class="number">0</span>),(<span class="number">1</span>,<span class="number">1</span>),(-<span class="number">1</span>,-<span class="number">1</span>),(-<span class="number">1</span>,<span class="number">1</span>),(<span class="number">1</span>,-<span class="number">1</span>));</div><div class="line">    inf=<span class="number">5000</span>;    </div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,sx,sy,x,y,nx,ny,h,t,ans:int;</div><div class="line">    map:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">51</span>,<span class="number">0</span>..<span class="number">51</span>] <span class="keyword">of</span> char;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">51</span>,<span class="number">0</span>..<span class="number">51</span>] <span class="keyword">of</span> int;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">2510</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    </div><div class="line"><span class="keyword">begin</span></div><div class="line">    assign(input,<span class="string">'grove.in'</span>);reset(input);</div><div class="line">    assign(output,<span class="string">'grove.out'</span>);rewrite(output);</div><div class="line"></div><div class="line">    readln(n,m);</div><div class="line">    y:=<span class="number">51</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(map[i,j]);</div><div class="line">            <span class="keyword">if</span> (map[i,j]=<span class="string">'X'</span>) <span class="keyword">and</span> (j&lt;y) <span class="keyword">then</span> <span class="keyword">begin</span> x:=i;y:=j <span class="keyword">end</span>;</div><div class="line">            <span class="keyword">if</span> map[i,j]=<span class="string">'*'</span> <span class="keyword">then</span> <span class="keyword">begin</span> sx:=i;sy:=j <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        readln;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> y-<span class="number">1</span> <span class="keyword">do</span> map[x,j]:=<span class="string">'-'</span>; <span class="comment">//画一条水平线</span></div><div class="line">    <span class="comment">//bfs</span></div><div class="line">    fillword(f,sizeof(f) <span class="keyword">div</span> <span class="number">2</span>,inf);</div><div class="line">    h:=<span class="number">1</span>;t:=<span class="number">2</span>;</div><div class="line">    q[h,<span class="number">0</span>]:=sx;q[h,<span class="number">1</span>]:=sy;</div><div class="line">    f[sx,sy]:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> h&lt;&gt;t <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">7</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            nx:=q[h,<span class="number">0</span>]+dir[i,<span class="number">0</span>];ny:=q[h,<span class="number">1</span>]+dir[i,<span class="number">1</span>];</div><div class="line">            <span class="keyword">if</span> (nx&lt;<span class="number">1</span>) <span class="keyword">or</span> (ny&lt;<span class="number">1</span>) <span class="keyword">or</span> (nx&gt;n) <span class="keyword">or</span> (ny&gt;m) <span class="keyword">then</span> continue;</div><div class="line">            <span class="keyword">if</span> f[nx,ny]&lt;&gt;inf <span class="keyword">then</span> continue;</div><div class="line">            <span class="keyword">if</span> (map[nx,ny]=<span class="string">'X'</span>) <span class="keyword">or</span> (map[nx,ny]=<span class="string">'-'</span>) <span class="keyword">then</span> continue;</div><div class="line"></div><div class="line">            q[t,<span class="number">0</span>]:=nx;q[t,<span class="number">1</span>]:=ny;f[nx,ny]:=f[q[h,<span class="number">0</span>],q[h,<span class="number">1</span>]]+<span class="number">1</span>;</div><div class="line">            inc(t);<span class="keyword">if</span> t&gt;<span class="number">2510</span> <span class="keyword">then</span> t:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        inc(h);<span class="keyword">if</span> h&gt;<span class="number">2510</span> <span class="keyword">then</span> h:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    ans:=maxint;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> y <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> y <span class="keyword">do</span></div><div class="line">            ans:=min(ans,f[x-<span class="number">1</span>,i]+f[x+<span class="number">1</span>,j]+max(abs(j-i),<span class="number">2</span>));</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line">    </div><div class="line">    close(input);close(output);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h1 id="P4-迷宫花坛"><a href="#P4-迷宫花坛" class="headerlink" title="P4 迷宫花坛"></a>P4 迷宫花坛</h1><p>圣玛格丽特学园的一角有一个巨大、如迷宫般的花坛。大约有一个人这么高的大型花坛，做成迷宫的形状，深受中世纪贵族的喜爱。维多利加的小屋就坐落在这迷宫花坛的深处。某一天早晨，久城同学要穿过这巨大的迷宫花坛，去探望感冒的维多利加。<br>整个迷宫可以用N个路口与M条连接两个不同路口的无向通道来描述。路口被标号为1到N，每条通道有各自的长度。整个迷宫一定是连通的，迷宫中可能存在若干个环路，但是，出于美观考虑，每个路口最多只会属于一个简单环路。例如，图1所示的迷宫是非常美观的，但图2则不符合我们的描述，因为3号路口同属于两个简单环。<br><img src="/2016/08/16/JSOI2016-提高1班-Day1/1.png" alt="1.png" title=""><img src="/2016/08/16/JSOI2016-提高1班-Day1/2.png" alt="2.png" title=""><br>你需要回答多个这样的询问：假如久城处在路口x，维多利加的小屋处在路口y，久城最短需要走多少距离才能到达小屋？</p>
<h2 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行2个整数N,M，表示迷宫花坛的路口数和通道数；<br>接下来M行，每行3个整数x,y,z，描述一条连接路口x与路口y，长度为z的通道；<br>再接下来1行包含一个整数Q，表示询问数量；<br>之后Q行，每行2个整数x,y，描述一个询问。</p>
<h2 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每个询问输出一行一个整数，表示最短距离。</p>
<h2 id="样例-3"><a href="#样例-3" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入-3"><a href="#样例输入-3" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>4 4<br>1 2 1<br>2 3 2<br>1 3 2<br>3 4 1<br>2<br>2 4<br>1 3</p>
</blockquote>
<h3 id="样例输出-3"><a href="#样例输出-3" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3<br>2</p>
</blockquote>
<h2 id="提示-2"><a href="#提示-2" class="headerlink" title="提示"></a>提示</h2><p>对于30%的数据，N≤100；<br>另有30%的数据，保证N=M；<br>对于100%的数据，1≤N≤100,000，Q≤200,000，1≤x,y≤N，1≤z≤1000。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>仙人掌上的倍增LCA。。。<br>我还是觉得暴力Floyd骗30分比较适合我。<br>那么来欣赏一下标程吧</p>
<dir style="text-align:right"></dir>

<figure class="highlight cpp"><figcaption><span>garden.cpp</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF  0x3f3f3f3f</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span>  n,m,K;</div><div class="line"><span class="keyword">int</span>  F[maxn][<span class="number">20</span>];</div><div class="line"><span class="keyword">int</span>  H[maxn];       <span class="comment">//深度 </span></div><div class="line"><span class="keyword">int</span>  D[maxn];       <span class="comment">//距离 </span></div><div class="line"></div><div class="line"><span class="keyword">int</span>  List[maxn*<span class="number">3</span>];  <span class="comment">//SCC距离 </span></div><div class="line"><span class="keyword">int</span>  Front[maxn];   <span class="comment">//SCC第一距离 </span></div><div class="line"><span class="keyword">int</span>  Back[maxn];    <span class="comment">//SCC第二距离</span></div><div class="line"><span class="keyword">int</span>  SCC[maxn];     <span class="comment">//联通分量 </span></div><div class="line"><span class="keyword">int</span>  Ls=<span class="number">0</span>,SCCs=<span class="number">0</span>;</div><div class="line"><span class="keyword">struct</span> Edge&#123;<span class="keyword">int</span> v,w;Edge *next;&#125;;</div><div class="line">Edge *E[maxn],Er[maxn*<span class="number">3</span>];<span class="keyword">int</span> Es=<span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> Data1&#123;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">		Edge *P=&amp;Er[++Es];P-&gt;v=v;P-&gt;w=w;P-&gt;next=E[u];E[u]=P;</div><div class="line">		      P=&amp;Er[++Es];P-&gt;v=u;P-&gt;w=w;P-&gt;next=E[v];E[v]=P;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(E,<span class="number">0</span>,<span class="keyword">sizeof</span>(E));</div><div class="line">		<span class="keyword">int</span> u,v,w;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;u,&amp;v,&amp;w),addEdge(u,v,w);</div><div class="line">	&#125;</div><div class="line">&#125;data1;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">calc</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> x1=Front[u],x2=Back[u],y1=Front[v],y2=Back[v],dis=INF;</div><div class="line">	dis=min(dis,<span class="built_in">abs</span>(List[x1]-List[y1]));</div><div class="line">	dis=min(dis,<span class="built_in">abs</span>(List[x1]-List[y2]));</div><div class="line">	dis=min(dis,<span class="built_in">abs</span>(List[x2]-List[y1]));</div><div class="line">	dis=min(dis,<span class="built_in">abs</span>(List[x2]-List[y2]));</div><div class="line">	<span class="keyword">return</span> dis;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> fu=u,fv=v;</div><div class="line">	<span class="keyword">if</span>(D[fu]&gt;D[fv])swap(fu,fv);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">19</span>;j&gt;=<span class="number">0</span>;j--)</div><div class="line">	    <span class="keyword">if</span>(F[fv][j]&amp;&amp;D[F[fv][j]]&gt;=D[fu])fv=F[fv][j];</div><div class="line">	<span class="keyword">if</span>(fv==fu)<span class="keyword">return</span> H[u]+H[v]-H[fu]-H[fu];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">19</span>;j&gt;=<span class="number">0</span>;j--)</div><div class="line">	    <span class="keyword">if</span>(F[fv][j]&amp;&amp;F[fu][j]&amp;&amp;F[fu][j]!=F[fv][j])fu=F[fu][j],fv=F[fv][j];</div><div class="line">	<span class="keyword">if</span>(SCC[fu]!=SCC[fv]||SCC[fu]==<span class="number">0</span>||SCC[fv]==<span class="number">0</span>)<span class="keyword">return</span> H[u]+H[v]-H[F[fu][<span class="number">0</span>]]-H[F[fu][<span class="number">0</span>]];</div><div class="line">	<span class="keyword">return</span> H[u]+H[v]-H[fu]-H[fv]+calc(fu,fv);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span>  Q[maxn],bot;</div><div class="line"><span class="keyword">struct</span> Data2&#123;</div><div class="line">	<span class="keyword">int</span>  Path[maxn],Length[maxn],u;</div><div class="line">	<span class="keyword">bool</span> V[maxn];</div><div class="line">	<span class="keyword">int</span>  P1[maxn*<span class="number">2</span>][<span class="number">2</span>],P2[maxn][<span class="number">2</span>],bot1,bot2;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getPath</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> f,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">		bot1=bot2=<span class="number">0</span>;</div><div class="line">		<span class="comment">//cout&lt;&lt;"getPath "&lt;&lt;u&lt;&lt;" "&lt;&lt;v&lt;&lt;" "&lt;&lt;f&lt;&lt;" "&lt;&lt;w&lt;&lt;endl;</span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> P=u;H[P]&gt;=H[f];P=Path[P])&#123;bot1++;P1[bot1][<span class="number">0</span>]=P;P1[bot1+<span class="number">1</span>][<span class="number">1</span>]=Length[P];&#125;</div><div class="line">		<span class="comment">//cout&lt;&lt;"P1"&lt;&lt;endl;</span></div><div class="line">		<span class="comment">//for(int i=1;i&lt;=bot1;i++)cout&lt;&lt;i&lt;&lt;" "&lt;&lt;P1[i][0]&lt;&lt;" "&lt;&lt;P1[i][1]&lt;&lt;endl;</span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> P=v;H[P]&gt;H[f];P=Path[P])&#123;bot2++;P2[bot2][<span class="number">0</span>]=P;P2[bot2][<span class="number">1</span>]=Length[P];&#125;</div><div class="line">		<span class="comment">//cout&lt;&lt;"P2"&lt;&lt;endl;</span></div><div class="line">		<span class="comment">//for(int i=1;i&lt;=bot2;i++)cout&lt;&lt;i&lt;&lt;" "&lt;&lt;P2[i][0]&lt;&lt;" "&lt;&lt;P2[i][1]&lt;&lt;endl;</span></div><div class="line">		<span class="keyword">while</span>(bot2)&#123;</div><div class="line">			bot1++;P1[bot1][<span class="number">0</span>]=P2[bot2][<span class="number">0</span>];P1[bot1][<span class="number">1</span>]=P2[bot2][<span class="number">1</span>];bot2--;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=bot1+<span class="number">1</span>;i&lt;=bot1*<span class="number">2</span>;i++)P1[i][<span class="number">0</span>]=P1[i-bot1][<span class="number">0</span>],P1[i][<span class="number">1</span>]=P1[i-bot1][<span class="number">1</span>];</div><div class="line">		P1[bot1+<span class="number">1</span>][<span class="number">1</span>]+=w;</div><div class="line">		</div><div class="line">		Ls++;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bot1*<span class="number">2</span>;i++)List[Ls+i]=List[Ls+i<span class="number">-1</span>]+P1[i][<span class="number">1</span>];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bot1;i++)Front[P1[i][<span class="number">0</span>]]=Ls+i,Back[P1[i][<span class="number">0</span>]]=Ls+i+bot1;</div><div class="line">		Ls+=bot1*<span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">findSCC</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> w)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> fu=u,fv=v;</div><div class="line">		<span class="keyword">while</span>(fu!=fv)<span class="keyword">if</span>(H[fu]&gt;H[fv])fu=Path[fu];<span class="keyword">else</span> fv=Path[fv];</div><div class="line">		getPath(u,v,fu,w);</div><div class="line">		</div><div class="line">		SCCs++;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bot1;i++)SCC[P1[i][<span class="number">0</span>]]=SCCs;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bot1;i++)<span class="keyword">if</span>(P1[i][<span class="number">0</span>]!=fu)F[P1[i][<span class="number">0</span>]][<span class="number">0</span>]=fu;</div><div class="line">		<span class="comment">//cout&lt;&lt;"SCC "&lt;&lt;SCCs&lt;&lt;endl;</span></div><div class="line">		<span class="comment">//for(int i=1;i&lt;=2*bot1;i++)cout&lt;&lt;i&lt;&lt;" "&lt;&lt;P1[i][0]&lt;&lt;" "&lt;&lt;P1[i][1]&lt;&lt;endl;</span></div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(H,<span class="number">0</span>,<span class="keyword">sizeof</span>(H));</div><div class="line">		<span class="built_in">memset</span>(V,<span class="literal">true</span>,<span class="keyword">sizeof</span>(V));</div><div class="line">		<span class="built_in">memset</span>(List,<span class="number">0</span>,<span class="keyword">sizeof</span>(List));</div><div class="line">		<span class="built_in">memset</span>(SCC,<span class="number">0</span>,<span class="keyword">sizeof</span>(SCC));</div><div class="line">		<span class="built_in">memset</span>(F,<span class="number">0</span>,<span class="keyword">sizeof</span>(F));</div><div class="line">		Q[bot=<span class="number">1</span>]=<span class="number">1</span>;V[<span class="number">1</span>]=<span class="literal">false</span>;Path[<span class="number">1</span>]=Length[<span class="number">1</span>]=<span class="number">0</span>;H[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> top=<span class="number">1</span>;top&lt;=bot;top++)&#123;</div><div class="line">			u=Q[top];</div><div class="line">			<span class="comment">//cout&lt;&lt;"BFS "&lt;&lt;u&lt;&lt;endl;</span></div><div class="line">			<span class="keyword">for</span>(Edge *P=E[u];P;P=P-&gt;next)&#123;</div><div class="line">			    <span class="keyword">if</span>(P-&gt;v==Path[u])<span class="keyword">continue</span>;</div><div class="line">			    <span class="keyword">if</span>(V[P-&gt;v])&#123;</div><div class="line">					Q[++bot]=P-&gt;v;</div><div class="line">					H[P-&gt;v]=H[u]+<span class="number">1</span>;V[P-&gt;v]=<span class="literal">false</span>;</div><div class="line">					F[P-&gt;v][<span class="number">0</span>]=Path[P-&gt;v]=u;</div><div class="line">					Length[P-&gt;v]=P-&gt;w;</div><div class="line">			    &#125;</div><div class="line">			    <span class="keyword">else</span> <span class="keyword">if</span>(SCC[u]==<span class="number">0</span>)findSCC(P-&gt;v,u,P-&gt;w);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//for(int i=1;i&lt;=bot;i++)cout&lt;&lt;Q[i]&lt;&lt;" "&lt;&lt;F[Q[i]][0]&lt;&lt;" "&lt;&lt;SCC[Q[i]]&lt;&lt;" "&lt;&lt;Length[Q[i]]&lt;&lt;endl;</span></div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="built_in">memset</span>(H,<span class="number">0</span>,<span class="keyword">sizeof</span>(H));</div><div class="line">		<span class="built_in">memset</span>(D,<span class="number">0</span>,<span class="keyword">sizeof</span>(D));</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> top=<span class="number">1</span>;top&lt;=bot;top++)&#123;</div><div class="line">			u=Q[top];</div><div class="line">			D[u]=D[F[u][<span class="number">0</span>]]+<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(SCC[F[u][<span class="number">0</span>]]!=SCC[u]||SCC[u]==<span class="number">0</span>)H[u]=H[F[u][<span class="number">0</span>]]+Length[u];</div><div class="line">			                              <span class="keyword">else</span> H[u]=H[F[u][<span class="number">0</span>]]+calc(F[u][<span class="number">0</span>],u);</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;<span class="number">20</span>&amp;&amp;F[u][j<span class="number">-1</span>];j++)F[u][j]=F[F[u][j<span class="number">-1</span>]][j<span class="number">-1</span>];</div><div class="line">		&#125;</div><div class="line">		<span class="comment">/*</span></div><div class="line">		for(int i=1;i&lt;=bot;i++)&#123;</div><div class="line">			u=Q[i];</div><div class="line">			printf("Qi=%d SCC=%d H=%d D=%d\n",u,SCC[u],H[u],D[u]);</div><div class="line">			for(int j=0;j&lt;20;j++)printf("%5d",F[u][j]);cout&lt;&lt;endl;</div><div class="line">		&#125;</div><div class="line">		*/</div><div class="line">	&#125;</div><div class="line">&#125;data2;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> Data3&#123;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">int</span>  u,v;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;K);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=K;i++)&#123;</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,LCA(u,v));</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;data3;</div><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"garden.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"garden.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	data1.init();</div><div class="line">	data2.BFS();</div><div class="line">	data2.work();</div><div class="line">	data3.query();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;P1-选数&quot;&gt;&lt;a href=&quot;#P1-选数&quot; class=&quot;headerlink&quot; title=&quot;P1 选数&quot;&gt;&lt;/a&gt;P1 选数&lt;/h1&gt;&lt;p&gt;现在有一排共N个数，你需要从中选出恰好K个。选出K个数后，计算它们两两差值的绝对值的最小值S。你需要确定选出哪K个，才能最大化这个S。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;输入第一行两个正整数N、K，含义如上。&lt;br&gt;输入第二行N个正整数，依次表示这N个数A1~An。0＜Ai≤10^9。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;一行一个正整数，S的最大值。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="JSOI" scheme="https://cothrax.github.io/tags/JSOI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="单调队列" scheme="https://cothrax.github.io/tags/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/"/>
    
      <category term="数据结构" scheme="https://cothrax.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="二分答案" scheme="https://cothrax.github.io/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="BFS" scheme="https://cothrax.github.io/tags/BFS/"/>
    
      <category term="仙人掌图" scheme="https://cothrax.github.io/tags/%E4%BB%99%E4%BA%BA%E6%8E%8C%E5%9B%BE/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>[POJ] P2942 Knights of the Round Table</title>
    <link href="https://cothrax.github.io/2016/08/16/POJ-P2942/"/>
    <id>https://cothrax.github.io/2016/08/16/POJ-P2942/</id>
    <published>2016-08-16T05:42:38.000Z</published>
    <updated>2016-08-16T06:04:53.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Being a knight is a very attractive career: searching for the Holy Grail, saving damsels in distress, and drinking with the other knights are fun things to do. Therefore, it is not very surprising that in recent years the kingdom of King Arthur has experienced an unprecedented increase in the number of knights. There are so many knights now, that it is very rare that every Knight of the Round Table can come at the same time to Camelot and sit around the round table; usually only a small group of the knights isthere, while the rest are busy doing heroic deeds around the country.</p>
<p>Knights can easily get over-excited during discussions-especially after a couple of drinks. After some unfortunate accidents, King Arthur asked the famous wizard Merlin to make sure that in the future no fights break out between the knights. After studying the problem carefully, Merlin realized that the fights can only be prevented if the knights are seated according to the following two rules:</p>
<ol>
<li>The knights should be seated such that two knights who hate each other should not be neighbors at the table. (Merlin has a list that says who hates whom.) The knights are sitting around a roundtable, thus every knight has exactly two neighbors.</li>
<li>An odd number of knights should sit around the table. This ensures that if the knights cannot agree on something, then they can settle the issue by voting. (If the number of knights is even, then itcan happen that “yes” and “no” have the same number of votes, and the argument goes on.)<a id="more"></a>
</li>
</ol>
<p>Merlin will let the knights sit down only if these two rules are satisfied, otherwise he cancels the meeting. (If only one knight shows up, then the meeting is canceled as well, as one person cannot sit around a table.) Merlin realized that this means that there can be knights who cannot be part of any seating arrangements that respect these rules, and these knights will never be able to sit at the Round Table (one such case is if a knight hates every other knight, but there are many other possible reasons). If a knight cannot sit at the Round Table, then he cannot be a member of the Knights of the Round Table and must be expelled from the order. These knights have to be transferred to a less-prestigious order, such as the Knights of the Square Table, the Knights of the Octagonal Table, or the Knights of the Banana-Shaped Table. To help Merlin, you have to write a program that will determine the number of knights that must be expelled. </p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>The input contains several blocks of test cases. Each case begins with a line containing two integers 1 ≤ n ≤ 1000 and 1 ≤ m ≤ 1000000 . The number n is the number of knights. The next m lines describe which knight hates which knight. Each of these m lines contains two integers k1 and k2 , which means that knight number k1 and knight number k2 hate each other (the numbers k1 and k2 are between 1 and n ). </p>
<p>The input is terminated by a block with n = m = 0 . </p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>For each test case you have to output a single integer on a separate line: the number of knights that have to be expelled. </p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5 5<br>1 4<br>1 5<br>2 5<br>3 4<br>4 5<br>0 0</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>2</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>Huge input file, ‘scanf’ recommended to avoid TLE. </p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>WA了N次后发现原来一个输入里有多组数据，又WA了N次后发现忘记初始化连通分量的数组了。果然外语不好不能刷POJ的题。<br>题意是：</p>
<blockquote>
<p>有N个骑士围坐在一个圆桌旁开会，给出某些骑士之间的仇恨关系。一次会议能够顺利举行，要满足两个条件：<br>1：任意相互憎恨的两个骑士不能相邻<br>2：开会人数为大于2的奇数<br>若某个骑士<strong>任何会议</strong>都不能参加，那么就必须将他踢出，问最少需要踢出多少个骑士？</p>
</blockquote>
<p>先求仇恨关系的补图，补图中边的含义就是两个骑士能相邻，<br>那么要开圆桌会就是找图中的n&gt;=3的奇圈，<br>奇圈一定形成了双连通分量，于是tarjan找出所有分量，<br>对于每一个分量，如果n&gt;=3且不能二分染色，就标记这个分量内的所有点。<br>最后统计没有被标记的点数。</p>
<p>注意：</p>
<ol>
<li>一个点可能处在多个分量中，找到立即处理。</li>
<li>割点处理后不要退栈。</li>
<li>初始化！</li>
</ol>
<dir style="text-align:right"><a href="/2016/08/16/POJ-P2942/test.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>test.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//uses math;</span></div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,cc,i,f,t,tim,ans:int;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>,<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> boolean;</div><div class="line">    ins,kick:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> boolean;</div><div class="line">    dfn,low,scc,s,col:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> int;</div><div class="line">    </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">min</span><span class="params">(a,b:int)</span>:</span>int;</div><div class="line"><span class="keyword">begin</span> <span class="keyword">if</span> a&lt;b <span class="keyword">then</span> min:=a <span class="keyword">else</span> min:=b <span class="keyword">end</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">paint</span><span class="params">(v,c:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    col[v]:=c;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> g[v,i] <span class="keyword">and</span> (scc[i]=cc) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> (col[i]=c) <span class="keyword">then</span> <span class="keyword">exit</span>(false);</div><div class="line">            <span class="keyword">if</span> (col[i]=<span class="number">0</span>) <span class="keyword">and</span> <span class="keyword">not</span> paint(i,-c) <span class="keyword">then</span> <span class="keyword">exit</span>(false);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    paint:=true;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(v,i:int)</span>;</span></div><div class="line"><span class="keyword">var</span> </div><div class="line">    tmp:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1010</span>] <span class="keyword">of</span> int;</div><div class="line">    cnt,j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(cc);cnt:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> s[t+<span class="number">1</span>]&lt;&gt;i <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        ins[s[t]]:=false;</div><div class="line">        inc(cnt);tmp[cnt]:=s[t];</div><div class="line">        scc[s[t]]:=cc;</div><div class="line">        dec(t);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    inc(cnt);tmp[cnt]:=v;</div><div class="line">    fillchar(col,sizeof(col),<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> (cnt&gt;=<span class="number">3</span>) <span class="keyword">and</span> <span class="keyword">not</span> paint(v,<span class="number">1</span>) <span class="keyword">then</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> cnt <span class="keyword">do</span> kick[tmp[j]]:=false;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">tarjan</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(tim);dfn[v]:=tim;low[v]:=tim;</div><div class="line">    ins[v]:=true;inc(t);s[t]:=v;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> g[v,i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> i=p <span class="keyword">then</span> continue;</div><div class="line">            <span class="keyword">if</span> dfn[i]=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                tarjan(i,v);</div><div class="line">                low[v]:=min(low[v],low[i]);</div><div class="line">                <span class="keyword">if</span> low[i]&gt;=dfn[v] <span class="keyword">then</span> solve(v,i);</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ins[i] <span class="keyword">then</span></div><div class="line">                low[v]:=min(low[v],dfn[i]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">while</span> true <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(n,m);</div><div class="line">        <span class="keyword">if</span> (n=<span class="number">0</span>) <span class="keyword">and</span> (m=<span class="number">0</span>) <span class="keyword">then</span> break;</div><div class="line">        </div><div class="line">        fillchar(g,sizeof(g),true);</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">read</span>(f,t);</div><div class="line">            g[f,t]:=false;g[t,f]:=false;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> g[i,i]:=false;</div><div class="line"></div><div class="line">        fillchar(kick,sizeof(kick),true);</div><div class="line">        fillchar(dfn,sizeof(dfn),<span class="number">0</span>);</div><div class="line">        fillchar(scc,sizeof(scc),<span class="number">0</span>);</div><div class="line">        fillchar(ins,sizeof(ins),false);</div><div class="line">        cc:=<span class="number">0</span>;tim:=<span class="number">0</span>;t:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> dfn[i]=<span class="number">0</span> <span class="keyword">then</span> tarjan(i,<span class="number">0</span>);</div><div class="line"></div><div class="line">        ans:=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> kick[i] <span class="keyword">then</span> inc(ans);</div><div class="line">        writeln(ans);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;Being a knight is a very attractive career: searching for the Holy Grail, saving damsels in distress, and drinking with the other knights are fun things to do. Therefore, it is not very surprising that in recent years the kingdom of King Arthur has experienced an unprecedented increase in the number of knights. There are so many knights now, that it is very rare that every Knight of the Round Table can come at the same time to Camelot and sit around the round table; usually only a small group of the knights isthere, while the rest are busy doing heroic deeds around the country.&lt;/p&gt;
&lt;p&gt;Knights can easily get over-excited during discussions-especially after a couple of drinks. After some unfortunate accidents, King Arthur asked the famous wizard Merlin to make sure that in the future no fights break out between the knights. After studying the problem carefully, Merlin realized that the fights can only be prevented if the knights are seated according to the following two rules:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The knights should be seated such that two knights who hate each other should not be neighbors at the table. (Merlin has a list that says who hates whom.) The knights are sitting around a roundtable, thus every knight has exactly two neighbors.&lt;/li&gt;
&lt;li&gt;An odd number of knights should sit around the table. This ensures that if the knights cannot agree on something, then they can settle the issue by voting. (If the number of knights is even, then itcan happen that “yes” and “no” have the same number of votes, and the argument goes on.)
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="双连通分量" scheme="https://cothrax.github.io/tags/%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"/>
    
      <category term="割点" scheme="https://cothrax.github.io/tags/%E5%89%B2%E7%82%B9/"/>
    
      <category term="二分图" scheme="https://cothrax.github.io/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/"/>
    
      <category term="补图" scheme="https://cothrax.github.io/tags/%E8%A1%A5%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>2048源码自定义</title>
    <link href="https://cothrax.github.io/2016/08/16/2048%E6%BA%90%E7%A0%81%E8%87%AA%E5%AE%9A%E4%B9%89/"/>
    <id>https://cothrax.github.io/2016/08/16/2048源码自定义/</id>
    <published>2016-08-16T00:35:51.000Z</published>
    <updated>2016-08-16T03:00:23.803Z</updated>
    
    <content type="html"><![CDATA[<p>看到好多神犇的Blog里都有2048，于是自己找源码玩一玩。<br>2048 js版的源码被托管在GitHub上：<a href="https://github.com/gabrielecirulli/2048" target="_blank" rel="external">gabrielecirulli/2048</a>。<br>说来话长，JavaScript是我的初恋，四年前在Codeacademy接触了前端编程，自此走上了一条不归路。然而打开源码包，看到一坨JS还是一脸懵。。。早忘干净啦。</p>
<h2 id="大概看一下"><a href="#大概看一下" class="headerlink" title="大概看一下"></a>大概看一下</h2><ol>
<li>keyboard_input_manager.js：input事件</li>
<li>html_actuator.js：处理交互界面，用dom更新html</li>
<li>grid.js：格子</li>
<li>tile.js：滑块对象</li>
<li>local_storage_manager.js：本地缓存</li>
<li>game_manager.js：主程序</li>
<li>application.js：不知道是什么</li>
<li>*_polyfill.js：各种polyfill<a id="more"></a>
</li>
</ol>
<h2 id="自定义图片"><a href="#自定义图片" class="headerlink" title="自定义图片"></a>自定义图片</h2><h3 id="改CSS"><a href="#改CSS" class="headerlink" title="改CSS"></a>改CSS</h3><p>style里的css使用scss生成的，但我没学过，于是直接改main.css<br>找到.tile类<br>直接给对应的class加background<br>如.tile-2是方块2的style，加上：（<code>img/</code>在<code>style/</code>下，在里面放图片）<br><figure class="highlight"><figcaption><span>main.css</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">background-image: url(./img/2.png);</div><div class="line">background-size:contain;</div></pre></td></tr></table></figure></p>
<p>同理加.tile-4, .tile-8等<br>但这样会出现问题</p>
<ol>
<li>一个个改好烦</li>
<li>大于2048时只有一个.tile-super类，没法改</li>
</ol>
<h3 id="改JS"><a href="#改JS" class="headerlink" title="改JS"></a>改JS</h3><p>在html_actuator.js下，可以找到<code>HTMLActuator.prototype.addTile</code>方法，可以看到其中是通过dom来创建div元素的，找到：<br><figure class="highlight js"><figcaption><span>html_actuator.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">inner.textContent = tile.value;</div></pre></td></tr></table></figure></p>
<p>滑块上的文字被设置为tile.value，就是滑块的数值。<br>把它注掉，然后给inner该css<br><figure class="highlight js"><figcaption><span>html_actuator.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//inner.textContent = tile.value;</span></div><div class="line">inner.style.backgroundSize = <span class="string">"contain"</span>;</div><div class="line">inner.style.backgroundImage = <span class="string">"url(./style/img/"</span>+tile.value+<span class="string">".jpg)"</span>;</div></pre></td></tr></table></figure></p>
<p>这样value对应的图片就会被设置成滑块的背景，然后在img/下放好$2^k$.jpg，我借用一下黄学长的图包，就变成了这样：<br><img src="/2016/08/16/2048源码自定义/Screenshot.jpg" alt="Screenshot.jpg" title=""></p>
<p>会发现图片平铺覆盖了一个格子，这是因为图片不是正方形的，ps剪一下就可以了。<br>另外注意图片是jpg还是png。</p>
<h2 id="在Hexo中部署2048"><a href="#在Hexo中部署2048" class="headerlink" title="在Hexo中部署2048"></a>在Hexo中部署2048</h2><p>新建页面<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new page <span class="string">"2048"</span></div></pre></td></tr></table></figure></p>
<p>把源码拷到2048/下，在2048/index.md中插入iframe（我把原来的index.html重命名为frame.html避免冲突）<br><figure class="highlight html"><figcaption><span>index.md</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"./frame.html"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">height</span>=<span class="string">"1300"</span> <span class="attr">seamless</span>=<span class="string">"seamless"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>tag插件也提供了iframe支持<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% iframe ./frame.html %&#125;</div></pre></td></tr></table></figure></p>
<p>我的two048：<a href="https://cothrax.github.io/2048">https://cothrax.github.io/2048</a></p>
<h2 id="修改game-manager-js"><a href="#修改game-manager-js" class="headerlink" title="修改game_manager.js"></a>修改game_manager.js</h2><blockquote>
<p>留个坑</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;看到好多神犇的Blog里都有2048，于是自己找源码玩一玩。&lt;br&gt;2048 js版的源码被托管在GitHub上：&lt;a href=&quot;https://github.com/gabrielecirulli/2048&quot;&gt;gabrielecirulli/2048&lt;/a&gt;。&lt;br&gt;说来话长，JavaScript是我的初恋，四年前在Codeacademy接触了前端编程，自此走上了一条不归路。然而打开源码包，看到一坨JS还是一脸懵。。。早忘干净啦。&lt;/p&gt;
&lt;h2 id=&quot;大概看一下&quot;&gt;&lt;a href=&quot;#大概看一下&quot; class=&quot;headerlink&quot; title=&quot;大概看一下&quot;&gt;&lt;/a&gt;大概看一下&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;keyboard_input_manager.js：input事件&lt;/li&gt;
&lt;li&gt;html_actuator.js：处理交互界面，用dom更新html&lt;/li&gt;
&lt;li&gt;grid.js：格子&lt;/li&gt;
&lt;li&gt;tile.js：滑块对象&lt;/li&gt;
&lt;li&gt;local_storage_manager.js：本地缓存&lt;/li&gt;
&lt;li&gt;game_manager.js：主程序&lt;/li&gt;
&lt;li&gt;application.js：不知道是什么&lt;/li&gt;
&lt;li&gt;*_polyfill.js：各种polyfill
    
    </summary>
    
      <category term="Tinkering Note" scheme="https://cothrax.github.io/categories/Tinkering-Note/"/>
    
    
      <category term="JavaScript" scheme="https://cothrax.github.io/tags/JavaScript/"/>
    
      <category term="CSS" scheme="https://cothrax.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] P1124 字串变换</title>
    <link href="https://cothrax.github.io/2016/08/15/Vijos-P1124/"/>
    <id>https://cothrax.github.io/2016/08/15/Vijos-P1124/</id>
    <published>2016-08-15T10:17:53.000Z</published>
    <updated>2016-08-15T10:32:59.015Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>已知有两个字串 A\$, B\$ 及一组字串变换的规则（至多6个规则）:<br>A1\$ -&gt; B1\$<br>A2\$ -&gt; B2\$<br>规则的含义为：在 A＄中的子串 A1\$ 可以变换为 B1\$、A2\$ 可以变换为 B2\$ …。<br>例如：A\$＝’abcd’　B\$＝’xyz’<br>变换规则为：<br>‘abc’-&gt;‘xu’　‘ud’-&gt;‘y’　‘y’-&gt;‘yz’<br>则此时，A\$ 可以经过一系列的变换变为 B\$，其变换的过程为：<br>‘abcd’-&gt;‘xud’-&gt;‘xy’-&gt;‘xyz’<br>共进行了三次变换，使得 A\$ 变换为B\$。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行为两个字符串，第二行至文件尾为变换规则<br>A\$ B\$<br>A1\$ B1\$ \<br>A2\$ B2\$ |-&gt; 变换规则<br>… … /<br>所有字符串长度的上限为 20。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>若在 10 步（包含 10步）以内能将 A\$ 变换为 B\$ ，则输出最少的变换步数；否则输出”NO ANSWER!”<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>abcd xyz<br>abc xu<br>ud y<br>y yz</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>每个测试点1s<br>noip2002提高组第二题</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>暴力BFS+Hash<br>注意：一个字串中可能存在对一个变化的多个匹配，如”aaa”和规则”a-&gt;p”就有三种情况<br>还有hash表比较大，fill耗时，于是省掉就好。</p>
<h3 id="方法一：单向BFS-Hash"><a href="#方法一：单向BFS-Hash" class="headerlink" title="方法一：单向BFS+Hash"></a>方法一：单向BFS+Hash</h3><dir style="text-align:right"><a href="/2016/08/15/Vijos-P1124/pp1124.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>pp1124.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> seed=<span class="number">131</span>;p=<span class="number">100000007</span>;</div><div class="line"><span class="keyword">type</span> state=<span class="keyword">record</span> s:<span class="keyword">string</span>;i:integer <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span></div><div class="line">    ht:<span class="keyword">array</span>[<span class="number">0</span>..p] <span class="keyword">of</span> boolean;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> state;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">7</span>] <span class="keyword">of</span> <span class="keyword">string</span>;</div><div class="line">    n,p0,h,t:integer;s:<span class="keyword">string</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(s:<span class="keyword">string</span>)</span>:</span>dword;</div><div class="line"><span class="keyword">var</span> i:integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    hash:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> length(s) <span class="keyword">do</span></div><div class="line">        hash:=(hash*seed+ord(s[i])) <span class="keyword">and</span> $FFFFFFF;</div><div class="line">    hash:=hash <span class="keyword">mod</span> p;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="comment">//start开始，t在p中第一次出现的位置</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getpos</span><span class="params">(t,p:<span class="keyword">string</span>;start:integer)</span>:</span>integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    getpos:=pos(t,copy(p,start,length(p)-start+<span class="number">1</span>));</div><div class="line">    <span class="keyword">if</span> getpos&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> inc(getpos,start-<span class="number">1</span>);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">bfs</span><span class="params">()</span>;</span></div><div class="line"><span class="keyword">var</span> i,p0:integer;cstr,nstr:<span class="keyword">string</span>;ha:dword;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> a[<span class="number">0</span>,<span class="number">0</span>]=a[<span class="number">1</span>,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span> <span class="keyword">write</span>(<span class="number">0</span>);halt <span class="keyword">end</span>;</div><div class="line">    h:=<span class="number">1</span>;t:=<span class="number">2</span>;</div><div class="line">    q[h].s:=a[<span class="number">0</span>,<span class="number">0</span>];q[h].i:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> h&lt;&gt;t <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        cstr:=q[h].s;</div><div class="line">        <span class="keyword">if</span> q[h].i=<span class="number">10</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</div><div class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            p0:=getpos(a[<span class="number">0</span>,i],cstr,<span class="number">1</span>);</div><div class="line">            <span class="keyword">while</span> p0&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                nstr:=cstr;</div><div class="line">                delete(nstr,p0,length(a[<span class="number">0</span>,i]));</div><div class="line">                insert(a[<span class="number">1</span>,i],nstr,p0);</div><div class="line">                </div><div class="line">                ha:=hash(nstr);</div><div class="line">                <span class="keyword">if</span> <span class="keyword">not</span> ht[ha] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                    ht[ha]:=true;</div><div class="line">                    <span class="keyword">if</span> nstr=a[<span class="number">1</span>,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                        <span class="keyword">write</span>(q[h].i+<span class="number">1</span>);</div><div class="line">                        halt;</div><div class="line">                    <span class="keyword">end</span>;</div><div class="line">                    q[t].s:=nstr;q[t].i:=q[h].i+<span class="number">1</span>;</div><div class="line">                    inc(t);<span class="keyword">if</span> t&gt;<span class="number">10010</span> <span class="keyword">then</span> t:=<span class="number">0</span>;</div><div class="line">                <span class="keyword">end</span>;</div><div class="line">                p0:=getpos(a[<span class="number">0</span>,i],cstr,p0+<span class="number">1</span>);</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        inc(h);<span class="keyword">if</span> h&gt;<span class="number">10010</span> <span class="keyword">then</span> h:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span> <span class="comment">&#123;Main&#125;</span></div><div class="line">    n:=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> <span class="keyword">not</span> eof <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(n);</div><div class="line">        readln(s);</div><div class="line">        p0:=pos(<span class="string">' '</span>,s);</div><div class="line">        a[<span class="number">0</span>,n]:=copy(s,<span class="number">1</span>,p0-<span class="number">1</span>);</div><div class="line">        a[<span class="number">1</span>,n]:=copy(s,p0+<span class="number">1</span>,length(s)-p0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    <span class="comment">//fillchar(ht,sizeof(ht),false);</span></div><div class="line">    bfs();</div><div class="line">    <span class="keyword">write</span>(<span class="string">'NO ANSWER!'</span>);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h3 id="方法二：双向BFS-Hash"><a href="#方法二：双向BFS-Hash" class="headerlink" title="方法二：双向BFS+Hash"></a>方法二：双向BFS+Hash</h3><p>直接用hash表存得到该字串的最小步骤，然后发现匹配可以直接输出</p>
<dir style="text-align:right"><a href="/2016/08/15/Vijos-P1124/p1124.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1124.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> seed=<span class="number">131</span>;p=<span class="number">10000019</span>;</div><div class="line"><span class="keyword">type</span> state=<span class="keyword">record</span> s:ansistring;i:integer <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span></div><div class="line">    <span class="comment">//0：正向；1：逆向</span></div><div class="line">    ht:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..p] <span class="keyword">of</span> integer;</div><div class="line">    q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">10010</span>] <span class="keyword">of</span> state;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">7</span>] <span class="keyword">of</span> ansistring;</div><div class="line">    n,p0:integer;s:ansistring;</div><div class="line">    h,t:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> integer;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(s:ansistring)</span>:</span>dword;</div><div class="line"><span class="keyword">var</span> i:integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    hash:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> length(s) <span class="keyword">do</span></div><div class="line">        hash:=(hash*seed+ord(s[i])) <span class="keyword">and</span> $FFFFFFF;</div><div class="line">    hash:=hash <span class="keyword">mod</span> p;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getpos</span><span class="params">(t,p:<span class="keyword">string</span>;start:integer)</span>:</span>integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    getpos:=pos(t,copy(p,start,length(p)-start+<span class="number">1</span>));</div><div class="line">    <span class="keyword">if</span> getpos&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> inc(getpos,start-<span class="number">1</span>);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">expand</span><span class="params">(x:integer)</span>;</span></div><div class="line"><span class="keyword">var</span> i,p0:integer;cstr,nstr:ansistring;ha:dword;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    cstr:=q[x,h[x]].s;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        p0:=getpos(a[x,i],cstr,<span class="number">1</span>);</div><div class="line">        <span class="keyword">while</span> p0&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            nstr:=cstr;</div><div class="line">            delete(nstr,p0,length(a[x,i]));</div><div class="line">            insert(a[<span class="number">1</span>-x,i],nstr,p0);</div><div class="line"></div><div class="line">            ha:=hash(nstr);</div><div class="line">            <span class="keyword">if</span> ht[<span class="number">1</span>-x,ha]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                <span class="keyword">write</span>(ht[<span class="number">1</span>-x,ha]+q[x,h[x]].i+<span class="number">1</span>);</div><div class="line">                halt;</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">            <span class="keyword">if</span> ht[x,ha]=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                q[x,t[x]].s:=nstr;q[x,t[x]].i:=q[x,h[x]].i+<span class="number">1</span>;</div><div class="line">                ht[x,ha]:=q[x,t[x]].i;</div><div class="line">                inc(t[x]);<span class="keyword">if</span> t[x]&gt;<span class="number">10010</span> <span class="keyword">then</span> t[x]:=<span class="number">0</span>;</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">            p0:=getpos(a[x,i],cstr,p0+<span class="number">1</span>);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    inc(h[x]);<span class="keyword">if</span> h[x]&gt;<span class="number">10010</span> <span class="keyword">then</span> h[x]:=<span class="number">0</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">bfs</span><span class="params">()</span>;</span></div><div class="line"><span class="keyword">var</span> i:integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        h[i]:=<span class="number">1</span>;t[i]:=<span class="number">2</span>;</div><div class="line">        q[i,<span class="number">1</span>].s:=a[i,<span class="number">0</span>];q[i,<span class="number">1</span>].i:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">repeat</span></div><div class="line">        <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span> <span class="keyword">do</span></div><div class="line">            <span class="keyword">if</span> (h[i]&lt;&gt;t[i]) <span class="keyword">and</span> (q[i,t[i]].i&lt;=<span class="number">10</span>) <span class="keyword">then</span> expand(i);</div><div class="line">    <span class="keyword">until</span> ((h[<span class="number">0</span>]=t[<span class="number">0</span>]) <span class="keyword">and</span> (h[<span class="number">1</span>]=t[<span class="number">1</span>])) <span class="keyword">or</span> </div><div class="line">          (q[<span class="number">0</span>,h[<span class="number">0</span>]].i+q[<span class="number">1</span>,h[<span class="number">1</span>]].i&gt;<span class="number">10</span>);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span> <span class="comment">&#123;Main&#125;</span></div><div class="line">    n:=-<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> <span class="keyword">not</span> eof <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(n);</div><div class="line">        readln(s);</div><div class="line">        p0:=pos(<span class="string">' '</span>,s);</div><div class="line">        a[<span class="number">0</span>,n]:=copy(s,<span class="number">1</span>,p0-<span class="number">1</span>);</div><div class="line">        a[<span class="number">1</span>,n]:=copy(s,p0+<span class="number">1</span>,length(s)-p0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="comment">//fillchar(ht,sizeof(ht),0);</span></div><div class="line">    bfs();</div><div class="line">    <span class="keyword">write</span>(<span class="string">'NO ANSWER!'</span>);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;已知有两个字串 A\$, B\$ 及一组字串变换的规则（至多6个规则）:&lt;br&gt;A1\$ -&amp;gt; B1\$&lt;br&gt;A2\$ -&amp;gt; B2\$&lt;br&gt;规则的含义为：在 A＄中的子串 A1\$ 可以变换为 B1\$、A2\$ 可以变换为 B2\$ …。&lt;br&gt;例如：A\$＝’abcd’　B\$＝’xyz’&lt;br&gt;变换规则为：&lt;br&gt;‘abc’-&amp;gt;‘xu’　‘ud’-&amp;gt;‘y’　‘y’-&amp;gt;‘yz’&lt;br&gt;则此时，A\$ 可以经过一系列的变换变为 B\$，其变换的过程为：&lt;br&gt;‘abcd’-&amp;gt;‘xud’-&amp;gt;‘xy’-&amp;gt;‘xyz’&lt;br&gt;共进行了三次变换，使得 A\$ 变换为B\$。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行为两个字符串，第二行至文件尾为变换规则&lt;br&gt;A\$ B\$&lt;br&gt;A1\$ B1\$ \&lt;br&gt;A2\$ B2\$ |-&amp;gt; 变换规则&lt;br&gt;… … /&lt;br&gt;所有字符串长度的上限为 20。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;若在 10 步（包含 10步）以内能将 A\$ 变换为 B\$ ，则输出最少的变换步数；否则输出”NO ANSWER!”&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="BFS" scheme="https://cothrax.github.io/tags/BFS/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
      <category term="字符串" scheme="https://cothrax.github.io/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="Hash" scheme="https://cothrax.github.io/tags/Hash/"/>
    
      <category term="双向BFS" scheme="https://cothrax.github.io/tags/%E5%8F%8C%E5%90%91BFS/"/>
    
      <category term="搜索" scheme="https://cothrax.github.io/tags/%E6%90%9C%E7%B4%A2/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] p1023 Victoria的舞会3</title>
    <link href="https://cothrax.github.io/2016/08/15/Vijos-p1023/"/>
    <id>https://cothrax.github.io/2016/08/15/Vijos-p1023/</id>
    <published>2016-08-15T01:32:52.000Z</published>
    <updated>2016-08-15T03:43:49.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>Victoria是一位颇有成就的艺术家，他因油画作品《我爱北京天安门》闻名于世界。现在，他为了报答帮助他的同行们，准备开一个舞会。<br>Victoria准备邀请n个已经确定的人，可是问题来了：<br>这n个人每一个人都有一个小花名册，名册里面写着他能够通知到的人的名字。比如说在A的人名单里写了B，那么表示A能够通知到B；但是B的名单里不见的有A，也就是说B不见得通知到A。<br>Victoria觉得需要确定自己需要通知多少个人m，能够实际将所有人n都通知到。并求出一种方案以确定m的最小值是多少。<br>注意：自己的名单里面不会有自己的名字。Victoria可以自身通知到所有n个人。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行一个数n。接下来n行，每i+1行表示编号为i的人的小花名册名单，名单以0结束。\<br>1&lt;=n&lt;=200。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>一个数，m。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>18<br>0<br>11 0<br>0<br>0<br>0<br>16 0<br>14 0<br>0<br>0<br>0<br>2 13 0<br>0<br>11 0<br>7 0<br>0<br>6 0<br>0<br>0</p>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><p>14</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>各个测试点1s</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>又见强连通分量，tarjan缩点，答案是入度为0的分量数</p>
<dir style="text-align:right"><a href="/2016/08/15/Vijos-p1023/p1023.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1023.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">var</span></div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">201</span>,<span class="number">0</span>..<span class="number">201</span>] <span class="keyword">of</span> boolean;</div><div class="line">    dfn,low,scc,ind,s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">201</span>] <span class="keyword">of</span> integer;</div><div class="line">    ins,used:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">201</span>] <span class="keyword">of</span> boolean;</div><div class="line">    n,i,j,t,cc,tim,ans:integer;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">tarjan</span><span class="params">(v:integer)</span>;</span></div><div class="line"><span class="keyword">var</span> i:integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(tim);dfn[v]:=tim;low[v]:=tim;</div><div class="line">    used[v]:=true;ins[v]:=true;</div><div class="line">    inc(t);s[t]:=v;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> g[v,i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> used[i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                tarjan(i);</div><div class="line">                low[v]:=min(low[v],low[i]);</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ins[i] <span class="keyword">then</span></div><div class="line">                low[v]:=min(low[v],dfn[i]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> dfn[v]=low[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        inc(cc);</div><div class="line">        <span class="keyword">while</span> s[t+<span class="number">1</span>]&lt;&gt;v <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            scc[s[t]]:=cc;</div><div class="line">            ins[s[t]]:=false;</div><div class="line">            dec(t);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    fillchar(g,sizeof(g),false);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j);</div><div class="line">        <span class="keyword">while</span> j&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            g[i,j]:=true;</div><div class="line">            <span class="keyword">read</span>(j);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    fillchar(ins,sizeof(ins),false);</div><div class="line">    fillchar(used,sizeof(used),false);</div><div class="line">    fillchar(ind,sizeof(ind),<span class="number">0</span>);</div><div class="line">    tim:=<span class="number">0</span>;cc:=<span class="number">0</span>;t:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> used[i] <span class="keyword">then</span> tarjan(i);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">            <span class="keyword">if</span> g[i,j] <span class="keyword">and</span> (scc[i]&lt;&gt;scc[j]) <span class="keyword">then</span> </div><div class="line">                inc(ind[scc[j]]);</div><div class="line">    ans:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> cc <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> ind[i]=<span class="number">0</span> <span class="keyword">then</span> inc(ans);</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;Victoria是一位颇有成就的艺术家，他因油画作品《我爱北京天安门》闻名于世界。现在，他为了报答帮助他的同行们，准备开一个舞会。&lt;br&gt;Victoria准备邀请n个已经确定的人，可是问题来了：&lt;br&gt;这n个人每一个人都有一个小花名册，名册里面写着他能够通知到的人的名字。比如说在A的人名单里写了B，那么表示A能够通知到B；但是B的名单里不见的有A，也就是说B不见得通知到A。&lt;br&gt;Victoria觉得需要确定自己需要通知多少个人m，能够实际将所有人n都通知到。并求出一种方案以确定m的最小值是多少。&lt;br&gt;注意：自己的名单里面不会有自己的名字。Victoria可以自身通知到所有n个人。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行一个数n。接下来n行，每i+1行表示编号为i的人的小花名册名单，名单以0结束。\&lt;br&gt;1&amp;lt;=n&amp;lt;=200。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;一个数，m。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="强连通分量" scheme="https://cothrax.github.io/tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] p1595 学校网络</title>
    <link href="https://cothrax.github.io/2016/08/15/Vijos-p1595/"/>
    <id>https://cothrax.github.io/2016/08/15/Vijos-p1595/</id>
    <published>2016-08-15T01:27:03.000Z</published>
    <updated>2016-08-15T03:44:02.727Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>一些学校的校园网连接在一个计算机网络上。学校之间存在软件支援协议。每个学校都有它应支援的学校名单（学校a支援学校b，并不表示学校b一定支援学校a）。当某校获得一个新软件时，无论是直接得到的还是从网络得到的，该校都应立即将这个软件通过网络传送给它应支援的学校。因此，若需要让所有连接在网络上的学校都能使用一个新软件，只需要将其提供给其中一些学校即可。<br>子任务a：根据学校间软件支援协议（各个学校的支援名单），计算最少需要将一个软件直接提供给多少个学校，才能使该软件通过网络传送到所有学校。<br>子任务b：如果允许在原有支援协议上添加新的支援关系，则总可以形成一个新的协议，使得此时只需要将一个新软件提供给任何一个学校，其他所有学校就都可以通过网络获得该软件。请计算出最少需要添加几条新的支援关系。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行是一个整数 n(2≤n≤100)，表示与网络连接的学校总数。接下来 n行描述了每个学校要支援的学校。第i+1行表示第i 号学校要支援的所有学校的编号，编号之间用空格隔开，每行以数字0 结束。如果某个学校不支援任何学校，则相应的行会有一个0。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>包含两行，第一行是一个正整数，表示子任务a的解。第二行也是一个正整数，表示子任务b的解。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>2 4 3 0<br>4 5 0<br>0<br>0<br>1 0</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>1<br>2</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>图结构</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>裸的强连通分量。<br>tarjan缩点<br>统计每个强连通分量的入度和出度<br>第一问答案是入度为0的分量数<br>第二问的答案是max(入度为0的分量数，出度为0的分量数)<br>可以通过从入度0的点向出度为0的点连有向边来构造<br><strong>注意只有一个分量时，答案为1 0，不特判的话输出的是1 1</strong></p>
<dir style="text-align:right"><a href="/2016/08/15/Vijos-p1595/p1595.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1595.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">var</span></div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">101</span>,<span class="number">0</span>..<span class="number">101</span>] <span class="keyword">of</span> boolean; </div><div class="line">    dfn,low,scc,s,ind,outd:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">101</span>] <span class="keyword">of</span> integer;</div><div class="line">    used,ins:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">101</span>] <span class="keyword">of</span> boolean;</div><div class="line">    n,i,j,t,cc,tim:integer;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">tarjan</span><span class="params">(v:integer)</span>;</span></div><div class="line"><span class="keyword">var</span> i:integer;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(tim);dfn[v]:=tim;low[v]:=tim;</div><div class="line">    ins[v]:=true;used[v]:=true;</div><div class="line">    inc(t);s[t]:=v;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> </div><div class="line">        <span class="keyword">if</span> g[v,i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> used[i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                tarjan(i);</div><div class="line">                low[v]:=min(low[v],low[i]);</div><div class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ins[i] <span class="keyword">then</span> </div><div class="line">                low[v]:=min(low[v],dfn[i]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> low[v]=dfn[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        inc(cc);</div><div class="line">        <span class="keyword">while</span> s[t+<span class="number">1</span>]&lt;&gt;v <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            ins[s[t]]:=false;</div><div class="line">            scc[s[t]]:=cc;</div><div class="line">            dec(t);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    fillchar(g,sizeof(g),false);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(j);</div><div class="line">        <span class="keyword">while</span> j&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            g[i,j]:=true;</div><div class="line">            <span class="keyword">read</span>(j);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"></div><div class="line">    fillchar(used,sizeof(used),false);</div><div class="line">    fillchar(ins,sizeof(ins),false);</div><div class="line">    cc:=<span class="number">0</span>;tim:=<span class="number">0</span>;t:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> <span class="keyword">not</span> used[i] <span class="keyword">then</span> tarjan(i);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> cc=<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">begin</span> writeln(<span class="number">1</span>);<span class="keyword">write</span>(<span class="number">0</span>);halt <span class="keyword">end</span>;</div><div class="line">    fillchar(ind,sizeof(ind),<span class="number">0</span>);</div><div class="line">    fillchar(outd,sizeof(outd),<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> </div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">            <span class="keyword">if</span> (g[i,j]) <span class="keyword">and</span> (scc[i]&lt;&gt;scc[j]) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">                inc(outd[scc[i]]);</div><div class="line">                inc(ind[scc[j]]);</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> cc <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> ind[i]=<span class="number">0</span> <span class="keyword">then</span> inc(ind[<span class="number">0</span>]);</div><div class="line">        <span class="keyword">if</span> outd[i]=<span class="number">0</span> <span class="keyword">then</span> inc(outd[<span class="number">0</span>]);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    writeln(ind[<span class="number">0</span>]);</div><div class="line">    <span class="keyword">write</span>(max(ind[<span class="number">0</span>],outd[<span class="number">0</span>]));</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;一些学校的校园网连接在一个计算机网络上。学校之间存在软件支援协议。每个学校都有它应支援的学校名单（学校a支援学校b，并不表示学校b一定支援学校a）。当某校获得一个新软件时，无论是直接得到的还是从网络得到的，该校都应立即将这个软件通过网络传送给它应支援的学校。因此，若需要让所有连接在网络上的学校都能使用一个新软件，只需要将其提供给其中一些学校即可。&lt;br&gt;子任务a：根据学校间软件支援协议（各个学校的支援名单），计算最少需要将一个软件直接提供给多少个学校，才能使该软件通过网络传送到所有学校。&lt;br&gt;子任务b：如果允许在原有支援协议上添加新的支援关系，则总可以形成一个新的协议，使得此时只需要将一个新软件提供给任何一个学校，其他所有学校就都可以通过网络获得该软件。请计算出最少需要添加几条新的支援关系。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行是一个整数 n(2≤n≤100)，表示与网络连接的学校总数。接下来 n行描述了每个学校要支援的学校。第i+1行表示第i 号学校要支援的所有学校的编号，编号之间用空格隔开，每行以数字0 结束。如果某个学校不支援任何学校，则相应的行会有一个0。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;包含两行，第一行是一个正整数，表示子任务a的解。第二行也是一个正整数，表示子任务b的解。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="强连通分量" scheme="https://cothrax.github.io/tags/%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/"/>
    
      <category term="IOI" scheme="https://cothrax.github.io/tags/IOI/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] P1845 花匠</title>
    <link href="https://cothrax.github.io/2016/08/14/Vijos-P1845/"/>
    <id>https://cothrax.github.io/2016/08/14/Vijos-P1845/</id>
    <published>2016-08-14T13:55:22.000Z</published>
    <updated>2016-08-15T04:58:27.108Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>花匠栋栋种了一排花，每株花都有自己的高度。花儿越长越大，也越来越挤。栋栋决定把这排中的一部分花移走，将剩下的留在原地，使得剩下的花能有空间长大，同时，栋栋希望剩下的花排列得比较别致。<br>具体而言，栋栋的花的高度可以看成一列整数h1, h2, … , hn。设当一部分花被移走后，剩下的花的高度依次为g1, g2, … , gm，则栋栋希望下面两个条件中至少有一个满足：</p>
<p>条件 A：对于所有的<span>$1&lt;i&lt;m/2$</span><!-- Has MathJax -->，<span>$g_{2i}&gt;g_{2i-1}$</span><!-- Has MathJax -->，且<span>$g_{2i}&gt;g_{2i+1}$</span><!-- Has MathJax -->；<br>条件 B：对于所有的<span>$1&lt;i&lt;m/2$</span><!-- Has MathJax -->，<span>$g_{2i}&lt;g_{2i-1}$</span><!-- Has MathJax -->，且<span>$g_{2i}&lt;g_{2i+1}$</span><!-- Has MathJax -->。</p>
<p>注意上面两个条件在m=1时同时满足，当m&gt;1时最多有一个能满足。<br>请问，栋栋最多能将多少株花留在原地。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入的第一行包含一个整数 n，表示开始时花的株数。<br>第二行包含 n 个整数，依次为h1, h2,… , hn，表示每株花的高度。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一行，包含一个整数 m，表示最多能留在原地的花的株数。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>5 3 2 1 2</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>3</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>对于 20%的数据，n ≤ 10；<br>对于 30%的数据，n ≤ 25；<br>对于 70%的数据，n ≤ 1000，0 ≤ hi ≤ 1000；<br>对于 100%的数据，1 ≤ n ≤ 100,000，0 ≤ hi ≤ 1,000,000，所有的h_i随机生成，所有随机数服从某区间内的均匀分布。</p>
<p>NOIP 2013 提高组 day 2</p>
<h2 id="水解"><a href="#水解" class="headerlink" title="水解"></a>水解</h2><p>首先想到LIS，然后5分钟DP就写好啦，80分然后TLE</p>
<blockquote>
<p>f[i,j] 以h[i]结尾的合法序列的最长长度<br>j=0时h[i]小于前一个数，j=1时h[i]大于前一个数<br>于是<br><span>$f[i,0]=max\{f[k,1]+1\ |\ h[k]&gt;h[i]\ and\ 1\leq k\leq i\}$</span><!-- Has MathJax --><br><span>$f[i,1]=max\{f[k,0]+1\ |\ h[k]&lt;h[i]\ and\ 1\leq k\leq i\}$</span><!-- Has MathJax --></p>
</blockquote>
<dir style="text-align:right"><a href="/2016/08/14/Vijos-P1845/p1845.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1845.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    h:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>,<span class="number">0</span>..<span class="number">1</span>] <span class="keyword">of</span> int;</div><div class="line">    i,j,n,len:int;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(h[i]);</div><div class="line">    fillchar(f,sizeof(f),<span class="number">0</span>);</div><div class="line">    f[<span class="number">1</span>,<span class="number">0</span>]:=<span class="number">1</span>;f[<span class="number">1</span>,<span class="number">1</span>]:=<span class="number">1</span>;len:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> i-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            <span class="keyword">if</span> h[i]&gt;h[j] <span class="keyword">then</span> f[i,<span class="number">1</span>]:=max(f[i,<span class="number">1</span>],f[j,<span class="number">0</span>]+<span class="number">1</span>);</div><div class="line">            <span class="keyword">if</span> h[i]&lt;h[j] <span class="keyword">then</span> f[i,<span class="number">0</span>]:=max(f[i,<span class="number">0</span>],f[j,<span class="number">1</span>]+<span class="number">1</span>);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        len:=max(len,max(f[i,<span class="number">0</span>],f[i,<span class="number">1</span>]));</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(len);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h2><p>其实LIS是可以用单调栈做的，于是这一题有了一个类似单调栈的做法，然后乱搞就A了。</p>
<dir style="text-align:right"><a href="/2016/08/14/Vijos-P1845/pp1845.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>pp1845.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    h,s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100010</span>] <span class="keyword">of</span> int;</div><div class="line">    i,n,t:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span><span class="params">(sym:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="comment">//sym=1 下一个数大</span></div><div class="line">    <span class="comment">//sym=-1 下一个数小</span></div><div class="line">    t:=<span class="number">1</span>;s[t]:=h[<span class="number">1</span>];</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> ((sym&gt;<span class="number">0</span>) <span class="keyword">and</span> (h[i]&gt;s[t])) <span class="keyword">or</span></div><div class="line">           ((sym&lt;<span class="number">0</span>) <span class="keyword">and</span> (h[i]&lt;s[t])) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(t);</div><div class="line">            sym:=-sym;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        s[t]:=h[i];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    cal:=t;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(h[i]);</div><div class="line">    <span class="keyword">write</span>(max(cal(<span class="number">1</span>),cal(-<span class="number">1</span>)));</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;花匠栋栋种了一排花，每株花都有自己的高度。花儿越长越大，也越来越挤。栋栋决定把这排中的一部分花移走，将剩下的留在原地，使得剩下的花能有空间长大，同时，栋栋希望剩下的花排列得比较别致。&lt;br&gt;具体而言，栋栋的花的高度可以看成一列整数h1, h2, … , hn。设当一部分花被移走后，剩下的花的高度依次为g1, g2, … , gm，则栋栋希望下面两个条件中至少有一个满足：&lt;/p&gt;
&lt;p&gt;条件 A：对于所有的&lt;span&gt;$1&amp;lt;i&amp;lt;m/2$&lt;/span&gt;&lt;!-- Has MathJax --&gt;，&lt;span&gt;$g_{2i}&amp;gt;g_{2i-1}$&lt;/span&gt;&lt;!-- Has MathJax --&gt;，且&lt;span&gt;$g_{2i}&amp;gt;g_{2i+1}$&lt;/span&gt;&lt;!-- Has MathJax --&gt;；&lt;br&gt;条件 B：对于所有的&lt;span&gt;$1&amp;lt;i&amp;lt;m/2$&lt;/span&gt;&lt;!-- Has MathJax --&gt;，&lt;span&gt;$g_{2i}&amp;lt;g_{2i-1}$&lt;/span&gt;&lt;!-- Has MathJax --&gt;，且&lt;span&gt;$g_{2i}&amp;lt;g_{2i+1}$&lt;/span&gt;&lt;!-- Has MathJax --&gt;。&lt;/p&gt;
&lt;p&gt;注意上面两个条件在m=1时同时满足，当m&amp;gt;1时最多有一个能满足。&lt;br&gt;请问，栋栋最多能将多少株花留在原地。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;输入的第一行包含一个整数 n，表示开始时花的株数。&lt;br&gt;第二行包含 n 个整数，依次为h1, h2,… , hn，表示每株花的高度。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出一行，包含一个整数 m，表示最多能留在原地的花的株数。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="贪心" scheme="https://cothrax.github.io/tags/%E8%B4%AA%E5%BF%83/"/>
    
      <category term="线性DP" scheme="https://cothrax.github.io/tags/%E7%BA%BF%E6%80%A7DP/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] p1906 联合权值</title>
    <link href="https://cothrax.github.io/2016/08/14/Vijos-p1906/"/>
    <id>https://cothrax.github.io/2016/08/14/Vijos-p1906/</id>
    <published>2016-08-14T09:37:51.000Z</published>
    <updated>2016-08-14T10:02:16.512Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>无向连通图 G 有 n 个点，n-1 条边。点从 1 到 n 依次编号，编号为 i 的点的权值为 Wi， 每条边的长度均为 1。图上两点(u, v)的距离定义为 u 点到 v 点的最短距离。对于图 G 上的点对(u, v)，若它们的距离为 2，则它们之间会产生Wu×Wv的联合权值。<br>请问图 G 上所有可产生联合权值的有序点对中，联合权值最大的是多少？所有联合权值之和是多少？</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含 1 个整数 n。<br>接下来 n-1 行，每行包含 2 个用空格隔开的正整数 u、v，表示编号为 u 和编号为 v 的点 之间有边相连。<br>最后 1 行，包含 n 个正整数，每两个正整数之间用一个空格隔开，其中第 i 个整数表示 图 G 上编号为 i 的点的权值为Wi。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出共 1 行，包含 2 个整数，之间用一个空格隔开，依次为图 G 上联合权值的最大值 和所有联合权值之和。由于所有联合权值之和可能很大，输出它时要对10007取余。</p>
<a id="more"></a>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>5<br>1 2<br>2 3<br>3 4<br>4 5<br>1 5 2 3 10</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>20 74</p>
</blockquote>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>对于 30%的数据，1 &lt; n ≤ 100；<br>对于 60%的数据，1 &lt; n ≤ 2000；<br>对于 100%的数据，1 &lt; n ≤ 200,000，0 &lt; WiWi ≤ 10,000。</p>
<p>NOIP2014 提高组 Day1<br>​</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>14年的题目怎么都很水。。。</p>
<p>对于点v，记与有v连边的所有点为$u_i$，两两配对所能得到的联合权值之和=$(\sum W_{u_i})^2-\sum W_{u_{i}}^2$<br>比如有与v连的有三个点，权值分别为a,b,c，那么这三个点能够成的联合权值之和=$2ab+2bc+2ca=(a+b+c)^2-a^2-b^2-c^2$<br>至于最大的权值，取$W_{u_i}$中的最大值和次大值，乘起来就是最大的联合权值。<br>于是扫一遍节点得到答案。<br>注意当v的度为1时不能构成联合权值</p>
<dir style="text-align:right"><a href="/2016/08/14/Vijos-p1906/p1906.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1906.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> z=<span class="number">10007</span>;</div><div class="line"><span class="keyword">type</span> </div><div class="line">    int=longint;</div><div class="line">    edge=<span class="keyword">record</span> t,next:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,i,f,t,ans,maxw:int;</div><div class="line">    w,head:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200010</span>] <span class="keyword">of</span> int;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">400010</span>] <span class="keyword">of</span> edge;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].t:=t;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u,fir,sec,sqrsum,sum:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fir:=<span class="number">0</span>;sec:=<span class="number">0</span>;sqrsum:=<span class="number">0</span>;sum:=<span class="number">0</span>;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> w[u]&gt;fir <span class="keyword">then</span> <span class="keyword">begin</span> sec:=fir;fir:=w[u] <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> w[u]&gt;sec <span class="keyword">then</span> sec:=w[u];</div><div class="line">        sum:=(sum+w[u]) <span class="keyword">mod</span> z;</div><div class="line">        sqrsum:=(sqrsum+sqr(w[u])) <span class="keyword">mod</span> z;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> sec&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">        maxw:=max(maxw,fir*sec);</div><div class="line">        ans:=(ans+sqr(sum)-sqrsum) <span class="keyword">mod</span> z;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f,t);</div><div class="line">        add(f,t);add(t,f);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(w[i]);</div><div class="line">    ans:=<span class="number">0</span>;maxw:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> solve(i);</div><div class="line">    <span class="keyword">write</span>(maxw,<span class="string">' '</span>,ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;无向连通图 G 有 n 个点，n-1 条边。点从 1 到 n 依次编号，编号为 i 的点的权值为 Wi， 每条边的长度均为 1。图上两点(u, v)的距离定义为 u 点到 v 点的最短距离。对于图 G 上的点对(u, v)，若它们的距离为 2，则它们之间会产生Wu×Wv的联合权值。&lt;br&gt;请问图 G 上所有可产生联合权值的有序点对中，联合权值最大的是多少？所有联合权值之和是多少？&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行包含 1 个整数 n。&lt;br&gt;接下来 n-1 行，每行包含 2 个用空格隔开的正整数 u、v，表示编号为 u 和编号为 v 的点 之间有边相连。&lt;br&gt;最后 1 行，包含 n 个正整数，每两个正整数之间用一个空格隔开，其中第 i 个整数表示 图 G 上编号为 i 的点的权值为Wi。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出共 1 行，包含 2 个整数，之间用一个空格隔开，依次为图 G 上联合权值的最大值 和所有联合权值之和。由于所有联合权值之和可能很大，输出它时要对10007取余。&lt;/p&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="Maths" scheme="https://cothrax.github.io/tags/Maths/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] p1908 无线网路发射器选址</title>
    <link href="https://cothrax.github.io/2016/08/14/Vijos-p1908/"/>
    <id>https://cothrax.github.io/2016/08/14/Vijos-p1908/</id>
    <published>2016-08-14T09:33:55.000Z</published>
    <updated>2016-08-14T09:51:07.479Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>随着智能手机的日益普及，人们对无线网的需求日益增大。某城市决定对城市内的公共场所覆盖无线网。<br>假设该城市的布局为由严格平行的 129 条东西向街道和 129 条南北向街道所形成的网格状，并且相邻的平行街道之间的距离都是恒定值 1 。东西向街道从北到南依次编号为0,1,2…128,南北向街道从西到东依次编号为 0,1,2…128。<br>东西向街道和南北向街道相交形成路口，规定编号为 x 的南北向街道和编号为 y 的东西向街道形成的路口的坐标是（x, y）。在某些路口存在一定数量的公共场所。<br>由于政府财政问题，只能安装一个大型无线网络发射器。该无线网络发射器的传播范围是一个以该点为中心，边长为 2*d 的正方形。传播范围包括正方形边界。<br>例如下图是一个 d = 1 的无线网络发射器的覆盖范围示意图。<br><img src="/2016/08/14/Vijos-p1908/noip2014tgday2p1.jpg" alt="noip2014tgday2p1.jpg" title=""><br>现在政府有关部门准备安装一个传播参数为 d 的无线网络发射器，希望你帮助他们在城 市内找出合适的安装地点，使得覆盖的公共场所最多。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包含一个整数 d，表示无线网络发射器的传播距离。<br>第二行包含一个整数 n，表示有公共场所的路口数目。<br>接下来 n 行，每行给出三个整数 x, y, k, 中间用一个空格隔开，分别代表路口的坐标(x, y)以及该路口公共场所的数量。同一坐标只会给出一次。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一行，包含两个整数，用一个空格隔开，分别表示能覆盖最多公共场所的安装地点方案数，以及能覆盖的最多公共场所的数量。</p>
<a id="more"></a>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>1<br>2<br>4 4 10<br>6 6 20</p>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><p>1 30</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>对于 100%的数据，1 ≤ d ≤ 20，1 ≤ n ≤ 20， 0 ≤ x ≤ 128, 0 ≤ y ≤ 128, 0 &lt; k ≤ 1,000,000。</p>
<p>NOIP2014 提高组 Day2</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>水一发，直接枚举就好啦。</p>
<dir style="text-align:right"><a href="/2016/08/14/Vijos-p1908/p1908.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1908.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,d,x,y,mx,my,i,j,tmp,ans,cnt:int;</div><div class="line">    a:<span class="keyword">array</span>[-<span class="number">21</span>..<span class="number">200</span>,-<span class="number">21</span>..<span class="number">200</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">solve</span><span class="params">(x,y:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> i,j:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    solve:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=x-d <span class="keyword">to</span> x+d <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=y-d <span class="keyword">to</span> y+d <span class="keyword">do</span> </div><div class="line">            inc(solve,a[i,j]);</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(d,n);</div><div class="line">    mx:=<span class="number">0</span>;my:=<span class="number">0</span>;</div><div class="line">    fillchar(a,sizeof(a),<span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(x,y);<span class="keyword">read</span>(a[x,y]);</div><div class="line">        mx:=max(x,mx);my:=max(y,my);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    inc(mx,d);inc(my,d);</div><div class="line">    ans:=<span class="number">0</span>;cnt:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> min(mx,<span class="number">128</span>) <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">0</span> <span class="keyword">to</span> min(my,<span class="number">128</span>) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            tmp:=solve(i,j);</div><div class="line">            <span class="keyword">if</span> tmp&gt;ans <span class="keyword">then</span> <span class="keyword">begin</span> ans:=tmp;cnt:=<span class="number">1</span> <span class="keyword">end</span></div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ans=tmp <span class="keyword">then</span> inc(cnt);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(cnt,<span class="string">' '</span>,ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;随着智能手机的日益普及，人们对无线网的需求日益增大。某城市决定对城市内的公共场所覆盖无线网。&lt;br&gt;假设该城市的布局为由严格平行的 129 条东西向街道和 129 条南北向街道所形成的网格状，并且相邻的平行街道之间的距离都是恒定值 1 。东西向街道从北到南依次编号为0,1,2…128,南北向街道从西到东依次编号为 0,1,2…128。&lt;br&gt;东西向街道和南北向街道相交形成路口，规定编号为 x 的南北向街道和编号为 y 的东西向街道形成的路口的坐标是（x, y）。在某些路口存在一定数量的公共场所。&lt;br&gt;由于政府财政问题，只能安装一个大型无线网络发射器。该无线网络发射器的传播范围是一个以该点为中心，边长为 2*d 的正方形。传播范围包括正方形边界。&lt;br&gt;例如下图是一个 d = 1 的无线网络发射器的覆盖范围示意图。&lt;br&gt;&lt;img src=&quot;/2016/08/14/Vijos-p1908/noip2014tgday2p1.jpg&quot; alt=&quot;noip2014tgday2p1.jpg&quot; title=&quot;&quot;&gt;&lt;br&gt;现在政府有关部门准备安装一个传播参数为 d 的无线网络发射器，希望你帮助他们在城 市内找出合适的安装地点，使得覆盖的公共场所最多。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行包含一个整数 d，表示无线网络发射器的传播距离。&lt;br&gt;第二行包含一个整数 n，表示有公共场所的路口数目。&lt;br&gt;接下来 n 行，每行给出三个整数 x, y, k, 中间用一个空格隔开，分别代表路口的坐标(x, y)以及该路口公共场所的数量。同一坐标只会给出一次。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出一行，包含两个整数，用一个空格隔开，分别表示能覆盖最多公共场所的安装地点方案数，以及能覆盖的最多公共场所的数量。&lt;/p&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
      <category term="枚举" scheme="https://cothrax.github.io/tags/%E6%9E%9A%E4%B8%BE/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] P1983 运输计划</title>
    <link href="https://cothrax.github.io/2016/08/13/Vijos-P1983/"/>
    <id>https://cothrax.github.io/2016/08/13/Vijos-P1983/</id>
    <published>2016-08-13T10:39:24.000Z</published>
    <updated>2016-08-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>公元 2044 年，人类进入了宇宙纪元。L 国有 n 个星球，还有 n−1 条双向航道，每条航道建立在两个星球之间，这 n−1 条 航道连通了 L 国的所有星球。<br>小 P 掌管一家物流公司，该公司有很多个运输计划，每个运输计划形如：有一艘物 流飞船需要从 ui 号星球沿最快的宇航路径飞行到 vi 号星球去。显然，飞船驶过一条航道是需要时间的，对于航道 j，任意飞船驶过它所花费的时间为 tj，并且任意两艘飞船之间不会产生任何干扰。<br>为了鼓励科技创新，L 国国王同意小 P 的物流公司参与 L 国的航道建设，即允许小 P 把某一条航道改造成虫洞，飞船驶过虫洞不消耗时间。<br>在虫洞的建设完成前小 P 的物流公司就预接了 m 个运输计划。在虫洞建设完成后， 这 m 个运输计划会同时开始，所有飞船一起出发。当这 m 个运输计划都完成时，小 P 的 物流公司的阶段性工作就完成了。<br>如果小 P 可以自由选择将哪一条航道改造成虫洞，试求出小 P 的物流公司完成阶段性工作所需要的最短时间是多少？</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行包括两个正整数 n、m,表示 L 国中星球的数量及小 P 公司预接的运输计划的数量,星球从 1 到 n 编号。接下来 n-1 行描述航道的建设情况,其中第 i 行包含三个整数 ai, bi 和 ti,表示第 i 条双向航道修建在 ai 与 bi 两个星球之间,任意飞船驶过它所花费的时间为 ti。 接下来 m 行描述运输计划的情况,其中第 j 行包含两个正整数 uj 和 vj,表示第 j 个运输计划是从 uj 号星球飞往 vj 号星球。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>共 1 行,包含 1 个整数,表示小 P 的物流公司完成阶段性工作所需要的最短时间。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入1"><a href="#样例输入1" class="headerlink" title="样例输入1"></a>样例输入1</h3><blockquote>
<p>6 3<br>1 2 3<br>1 6 4<br>3 1 7<br>4 3 6<br>3 5 5<br>3 6<br>2 5<br>4 5</p>
</blockquote>
<h3 id="样例输出1"><a href="#样例输出1" class="headerlink" title="样例输出1"></a>样例输出1</h3><blockquote>
<p>11</p>
</blockquote>
<h2 id="限制​"><a href="#限制​" class="headerlink" title="限制​"></a>限制​</h2><p>一共有20组数据。<br>其中n的取值依次为：100，100，100，2000，1000，2000，3000，1000，2000，3000，80000，100000，70000，80000，90000，100000，80000，90000，100000，300000。<br>其中m的取值依次为：1，100，100，1，1000，2000，3000，1000，2000，3000，1，1，70000，80000，90000，100000，80000，90000，100000，300000。<br>其中第2，5，6，7，13，14，15，16组数据满足：第 i 条航道连接 i 号星球与 i+1 号星球。</p>
<h2 id="提示"><a href="#提示" class="headerlink" title="提示"></a>提示</h2><p>输入输出样例 1<br>将第 1 条航道改造成虫洞：则三个计划耗时分别为：11、12、11，故需要花费的时 间为 12。<br>将第 2 条航道改造成虫洞：则三个计划耗时分别为：7、15、11，故需要花费的时 间为 15。<br>将第 3 条航道改造成虫洞：则三个计划耗时分别为：4、8、11，故需要花费的时间 为 11。<br>将第 4 条航道改造成虫洞：则三个计划耗时分别为：11、15、5，故需要花费的时 间为 15。<br>将第 5 条航道改造成虫洞：则三个计划耗时分别为：11、10、6，故需要花费的时 间为 11。<br>故将第 3 条或第 5 条航道改造成虫洞均可使得完成阶段性工作的耗时最短，需要花 费的时间为 11。</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p>NOIP 2015 提高组 Day 2 第三题<br>数据由AHdoc生成</p>
<h2 id="水解"><a href="#水解" class="headerlink" title="水解"></a>水解</h2><p>正解貌似是<strong>树链剖分</strong>，可是我不会==<br>于是写了LCA，然后$O(MlogN+logW(M+N))$，然后卡常，<del>还是只有95分</del>，然后A掉啦</p>
<p>大概是先倍增+LCA，然后二分时间，求大于给定时间x的所有路径的交，然后扫一遍交上的边j，如果有 最长路径-j的权&lt;=x 那么返回true<br><strong>路径求交</strong>：类似维护<strong>差分序列</strong>的方法，dfs维护一个。。。叫什么好呢。。。差分树吧<br>用count[i]记录记录经过边i（该边是节点i和其父节点的连边）的路径条数<br>对于一条边</p>
<ol>
<li>count[起点]+=1</li>
<li>count[终点]+=1</li>
<li>count[lca]-=2</li>
</ol>
<p>然后从根开始dfs，对一节点v，$count[v]+=\sum count[u]\ |\ u=child(v)$<br>count[1]不考虑，若count[i]=路径总数tot，那么i在路径的交上。</p>
<dir style="text-align:right"><a href="/2016/08/13/Vijos-P1983/P1983.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>P1983.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span></div><div class="line">    int=longint; </div><div class="line">    edge=<span class="keyword">record</span> f,t,w,next:int <span class="keyword">end</span>;</div><div class="line">    ask=<span class="keyword">record</span> f,t,w,lca:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">600010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head,dep,count:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>] <span class="keyword">of</span> int;</div><div class="line">    par,dist:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>,<span class="number">0</span>..<span class="number">20</span>] <span class="keyword">of</span> int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>] <span class="keyword">of</span> ask;</div><div class="line">    n,m,logn,i,j,f0,t0,w0,l,r,mid,ans:int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].f:=f;g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(v,p,d,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    dep[v]:=d;par[v,<span class="number">0</span>]:=p;dist[v,<span class="number">0</span>]:=w;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> dep[u]=<span class="number">0</span> <span class="keyword">then</span> dfs(u,v,d+<span class="number">1</span>,g[i].w);</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">lca</span><span class="params">(u,v,id:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">if</span> dep[u]&lt;dep[v] <span class="keyword">then</span> <span class="keyword">begin</span> i:=u;u:=v;v:=i <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=logn <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> dep[par[u,i]]&gt;=dep[v] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(a[id].w,dist[u,i]);</div><div class="line">            u:=par[u,i];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> u=v <span class="keyword">then</span> <span class="keyword">begin</span> a[id].lca:=u;<span class="keyword">exit</span> <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=logn <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> par[u,i]&lt;&gt;par[v,i] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(a[id].w,dist[u,i]+dist[v,i]);</div><div class="line">            u:=par[u,i];v:=par[v,i];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    a[id].w:=a[id].w+dist[u,<span class="number">0</span>]+dist[v,<span class="number">0</span>];</div><div class="line">    a[id].lca:=par[u,<span class="number">0</span>];</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs2</span><span class="params">(v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> u&lt;&gt;par[v,<span class="number">0</span>] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dfs2(u);</div><div class="line">            inc(count[v],count[u]);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,j,w,tot:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fillchar(count,sizeof(count),<span class="number">0</span>);</div><div class="line">    w:=<span class="number">0</span>;tot:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> a[i].w&gt;x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(count[a[i].f]);</div><div class="line">            inc(count[a[i].t]);</div><div class="line">            dec(count[a[i].lca],<span class="number">2</span>);</div><div class="line">            w:=max(w,a[i].w-x);inc(tot);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> tot=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(true);</div><div class="line">    </div><div class="line">    dfs2(<span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> (count[i]=tot) <span class="keyword">and</span> (dist[i,<span class="number">0</span>]&gt;=w) <span class="keyword">then</span> <span class="keyword">exit</span>(true);</div><div class="line">    check:=false;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    logn:=floor(ln(n)/ln(<span class="number">2</span>));</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f0,t0,w0);</div><div class="line">        add(f0,t0,w0);add(t0,f0,w0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">read</span>(a[i].f,a[i].t);</div><div class="line"></div><div class="line">    <span class="comment">//倍增数组和LCA</span></div><div class="line">    filldword(dist,sizeof(dist) <span class="keyword">div</span> <span class="number">4</span>,inf);</div><div class="line">    fillchar(par,sizeof(par),<span class="number">0</span>);</div><div class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,inf);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> logn <span class="keyword">do</span></div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">            par[j,i]:=par[par[j,i-<span class="number">1</span>],i-<span class="number">1</span>];</div><div class="line">            <span class="keyword">if</span> par[j,i]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></div><div class="line">                dist[j,i]:=dist[j,i-<span class="number">1</span>]+dist[par[j,i-<span class="number">1</span>],i-<span class="number">1</span>];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> lca(a[i].f,a[i].t,i);</div><div class="line"></div><div class="line">    <span class="comment">//二分</span></div><div class="line">    l:=<span class="number">0</span>;r:=inf;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<h2 id="正解"><a href="#正解" class="headerlink" title="正解"></a>正解</h2><p><strong>二分+树链剖分+差分序列</strong>，不就是用树链剖分代替了倍增吗，因为直接维护序列就不用dfs了，于是速度会快很多。<br><strong>差分序列</strong>就是把<strong>区间修改</strong>变成对应的<strong>单点修改</strong>，然后可以通过求<strong>前缀和</strong>来计算需要的信息。<br>典型的例子是黄学长做的 noip2012-借教室 那一题：<a href="http://hzwer.com/2959.html" target="_blank" rel="external">去围观</a><br>关于树链剖分可以看神犇的讲解：<a href="http://blog.sina.com.cn/s/blog_7a1746820100wp67.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_7a1746820100wp67.html</a></p>
<p>关于本题：<br>先树链剖分，顺便求LCA，算出所有运输计划的路径长<br>然后二分时间<br>和水解类似的，把所有大于给定时间的路径求交，然后扫一遍，找可行的边建虫洞。<br>只不过求交直接在剖分得到的树链上做差分序列。</p>
<p>说明一下我用的<strong>变量</strong></p>
<ul>
<li><p>以节点编号为下标</p>
<blockquote>
<p>par 直接父节点<br>chd 同一重链上的儿子<br>dep 深度<br>siz 子树上的节点数<br>w 与父节点的连边在树链序列中的编号<br>top 所在重链的顶端节点<br><strong>dist 到根1的距离</strong></p>
</blockquote>
</li>
<li><p>以树链序列中编号为下标的</p>
<blockquote>
<p>ev 树链序列，大小为k（最终等于n-1）<br>count 统计次数的差分序列</p>
</blockquote>
</li>
</ul>
<p>注意编号不要弄混，以及差分时注意<strong>端点</strong>的问题</p>
<dir style="text-align:right"><a href="/2016/08/13/Vijos-P1983/pp1983.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>pp1983.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">const</span> inf=<span class="number">1000000000</span>;</div><div class="line"><span class="keyword">type</span></div><div class="line">    int=longint; </div><div class="line">    edge=<span class="keyword">record</span> f,t,w,next:int <span class="keyword">end</span>;</div><div class="line">    ask=<span class="keyword">record</span> f,t,w:int <span class="keyword">end</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,i,j,f0,t0,w0,l,r,mid,ans:int;</div><div class="line">    g:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">600010</span>] <span class="keyword">of</span> edge;</div><div class="line">    head:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>] <span class="keyword">of</span> int;</div><div class="line">    a:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>] <span class="keyword">of</span> ask;</div><div class="line">    <span class="comment">//剖分变量</span></div><div class="line">    k:int;</div><div class="line">    par,chd,dep,w,siz,top,dist,</div><div class="line">    ev,cnt:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300010</span>] <span class="keyword">of</span> int;</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(f,t,w:int)</span>;</span></div><div class="line"><span class="keyword">var</span> m:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(head[<span class="number">0</span>]);m:=head[<span class="number">0</span>];</div><div class="line">    g[m].f:=f;g[m].t:=t;g[m].w:=w;</div><div class="line">    g[m].next:=head[f];head[f]:=m;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"><span class="comment">//算出dep,siz,chd,par,dist</span></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs1</span><span class="params">(v,p:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    dep[v]:=dep[p]+<span class="number">1</span>;par[v]:=p;siz[v]:=<span class="number">1</span>;chd[v]:=<span class="number">0</span>;</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> u&lt;&gt;p <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dist[u]:=dist[v]+g[i].w;</div><div class="line">            dfs1(u,v);</div><div class="line">            inc(siz[v],siz[u]);</div><div class="line">            <span class="keyword">if</span> siz[u]&gt;siz[chd[v]] <span class="keyword">then</span> chd[v]:=u;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="comment">//算出w,top,ev</span></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs2</span><span class="params">(v,tp:int)</span>;</span></div><div class="line"><span class="keyword">var</span> i,u:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    inc(k);ev[k]:=dist[v]-dist[par[v]];w[v]:=k;top[v]:=tp;</div><div class="line">    <span class="keyword">if</span> chd[v]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> dfs2(chd[v],tp);</div><div class="line">    i:=head[v];</div><div class="line">    <span class="keyword">while</span> i&lt;&gt;<span class="number">0</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        u:=g[i].t;</div><div class="line">        <span class="keyword">if</span> (u&lt;&gt;par[v]) <span class="keyword">and</span> (u&lt;&gt;chd[v]) <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            dfs2(u,u);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        i:=g[i].next;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tmp:int;</div><div class="line"><span class="keyword">begin</span> tmp:=a;a:=b;b:=tmp <span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">lca</span><span class="params">(u,v:int)</span>:</span>int;</div><div class="line"><span class="keyword">var</span> tu,tv:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">while</span> true <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> dep[u]&gt;dep[v] <span class="keyword">then</span> swap(u,v);</div><div class="line">        tu:=top[u];tv:=top[v];</div><div class="line">        <span class="keyword">if</span> tu=tv <span class="keyword">then</span> break;</div><div class="line">        <span class="keyword">if</span> dep[tu]&lt;dep[tv] <span class="keyword">then</span> v:=par[tv] <span class="keyword">else</span> u:=par[tu];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    lca:=u;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="comment">//修改路径的cnt</span></div><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(u,v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> tu,tv:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">while</span> true <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> dep[u]&gt;dep[v] <span class="keyword">then</span> swap(u,v);</div><div class="line">        tu:=top[u];tv:=top[v];</div><div class="line">        <span class="keyword">if</span> tu=tv <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt[w[u]+<span class="number">1</span>]);</div><div class="line">            dec(cnt[w[v]+<span class="number">1</span>]);</div><div class="line">            break;</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">        <span class="keyword">if</span> dep[tu]&lt;dep[tv] <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt[w[tv]+<span class="number">1</span>]);</div><div class="line">            dec(cnt[w[v]+<span class="number">1</span>]);</div><div class="line">            v:=par[tv];</div><div class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></div><div class="line">            inc(cnt[w[tu]+<span class="number">1</span>]);</div><div class="line">            dec(cnt[w[u]+<span class="number">1</span>]);</div><div class="line">            u:=par[tu];</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,tot,maxw,cur:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    fillchar(cnt,sizeof(cnt),<span class="number">0</span>);</div><div class="line">    tot:=<span class="number">0</span>;maxw:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></div><div class="line">        <span class="keyword">if</span> a[i].w&gt;x <span class="keyword">then</span> <span class="keyword">begin</span></div><div class="line">            modify(a[i].f,a[i].t);</div><div class="line">            inc(tot);</div><div class="line">            maxw:=max(maxw,a[i].w-x);</div><div class="line">        <span class="keyword">end</span>;</div><div class="line">    cur:=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> k <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        inc(cur,cnt[i]);</div><div class="line">        <span class="keyword">if</span> (cur=tot) <span class="keyword">and</span> (ev[i]&gt;=maxw) <span class="keyword">then</span> <span class="keyword">exit</span>(true);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    check:=false;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">read</span>(n,m);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">read</span>(f0,t0,w0);</div><div class="line">        add(f0,t0,w0);add(t0,f0,w0);</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">read</span>(a[i].f,a[i].t);</div><div class="line">    <span class="comment">//树链剖分</span></div><div class="line">    k:=<span class="number">0</span>;dfs1(<span class="number">1</span>,<span class="number">1</span>);dfs2(<span class="number">1</span>,<span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="comment">//LCA</span></div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        j:=lca(a[i].f,a[i].t);</div><div class="line">        a[i].w:=dist[a[i].f]+dist[a[i].t]-<span class="number">2</span>*dist[j]; <span class="comment">//路径长</span></div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//二分</span></div><div class="line">    l:=<span class="number">0</span>;r:=inf;</div><div class="line">    <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> check(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;r:=mid-<span class="number">1</span> <span class="keyword">end</span></div><div class="line">        <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>
<p>树链修改还可以用<strong>指针</strong>写，好像短一些<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(u,v:int)</span>;</span></div><div class="line"><span class="keyword">var</span> p:^int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">while</span> top[u]&lt;&gt;top[v] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        <span class="keyword">if</span> dep[top[u]]&lt;dep[top[v]] <span class="keyword">then</span> p:=@v <span class="keyword">else</span> p:=@u;</div><div class="line">        inc(cnt[w[par[p^]]]);</div><div class="line">        dec(cnt[w[p^]]);</div><div class="line">        p^:=par[top[p^]];</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">if</span> dep[u]&gt;dep[v] <span class="keyword">then</span> swap(u,v);</div><div class="line">    inc(cnt[w[u]+<span class="number">1</span>]);</div><div class="line">    dec(cnt[w[v]+<span class="number">1</span>]);</div><div class="line"><span class="keyword">end</span>;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;公元 2044 年，人类进入了宇宙纪元。L 国有 n 个星球，还有 n−1 条双向航道，每条航道建立在两个星球之间，这 n−1 条 航道连通了 L 国的所有星球。&lt;br&gt;小 P 掌管一家物流公司，该公司有很多个运输计划，每个运输计划形如：有一艘物 流飞船需要从 ui 号星球沿最快的宇航路径飞行到 vi 号星球去。显然，飞船驶过一条航道是需要时间的，对于航道 j，任意飞船驶过它所花费的时间为 tj，并且任意两艘飞船之间不会产生任何干扰。&lt;br&gt;为了鼓励科技创新，L 国国王同意小 P 的物流公司参与 L 国的航道建设，即允许小 P 把某一条航道改造成虫洞，飞船驶过虫洞不消耗时间。&lt;br&gt;在虫洞的建设完成前小 P 的物流公司就预接了 m 个运输计划。在虫洞建设完成后， 这 m 个运输计划会同时开始，所有飞船一起出发。当这 m 个运输计划都完成时，小 P 的 物流公司的阶段性工作就完成了。&lt;br&gt;如果小 P 可以自由选择将哪一条航道改造成虫洞，试求出小 P 的物流公司完成阶段性工作所需要的最短时间是多少？&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行包括两个正整数 n、m,表示 L 国中星球的数量及小 P 公司预接的运输计划的数量,星球从 1 到 n 编号。接下来 n-1 行描述航道的建设情况,其中第 i 行包含三个整数 ai, bi 和 ti,表示第 i 条双向航道修建在 ai 与 bi 两个星球之间,任意飞船驶过它所花费的时间为 ti。 接下来 m 行描述运输计划的情况,其中第 j 行包含两个正整数 uj 和 vj,表示第 j 个运输计划是从 uj 号星球飞往 vj 号星球。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;共 1 行,包含 1 个整数,表示小 P 的物流公司完成阶段性工作所需要的最短时间。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="数据结构" scheme="https://cothrax.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="二分答案" scheme="https://cothrax.github.io/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="图论" scheme="https://cothrax.github.io/tags/%E5%9B%BE%E8%AE%BA/"/>
    
      <category term="DFS" scheme="https://cothrax.github.io/tags/DFS/"/>
    
      <category term="树结构" scheme="https://cothrax.github.io/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
      <category term="LCA" scheme="https://cothrax.github.io/tags/LCA/"/>
    
      <category term="倍增" scheme="https://cothrax.github.io/tags/%E5%80%8D%E5%A2%9E/"/>
    
      <category term="树链剖分" scheme="https://cothrax.github.io/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] P1982 子串</title>
    <link href="https://cothrax.github.io/2016/08/13/Vijos-P1982/"/>
    <id>https://cothrax.github.io/2016/08/13/Vijos-P1982/</id>
    <published>2016-08-13T07:58:53.000Z</published>
    <updated>2016-08-14T01:08:06.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>有两个仅包含小写英文字母的字符串 A 和 B。现在要从字符串 A 中取出 k 个<strong>互不重叠</strong>的非空子串，然后把这 k 个子串按照其在字符串 A 中出现的顺序依次连接起来得到一 个新的字符串，请问有多少种方案可以使得这个新串与字符串 B 相等？注意：子串取出的位置不同也认为是不同的方案。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>第一行是三个正整数 n，m，k，分别表示字符串 A 的长度，字符串 B 的长度，以及问 题描述中所提到的 k，每两个整数之间用一个空格隔开。第二行包含一个长度为 n 的字符串，表示字符串 A。 第三行包含一个长度为 m 的字符串，表示字符串 B。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出共一行，包含一个整数，表示所求方案数。由于答案可能很大，<strong>所以这里要求输出答案对 1,000,000,007 取模的结果。</strong><br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入1"><a href="#样例输入1" class="headerlink" title="样例输入1"></a>样例输入1</h3><blockquote>
<p>6 3 1<br>aabaab<br>aab</p>
</blockquote>
<h3 id="样例输出1"><a href="#样例输出1" class="headerlink" title="样例输出1"></a>样例输出1</h3><blockquote>
<p>2</p>
</blockquote>
<h3 id="样例输入2"><a href="#样例输入2" class="headerlink" title="样例输入2"></a>样例输入2</h3><blockquote>
<p>6 3 2<br>aabaab<br>aab</p>
</blockquote>
<h3 id="样例输出2"><a href="#样例输出2" class="headerlink" title="样例输出2"></a>样例输出2</h3><blockquote>
<p>7</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>对于第 1 组数据：1≤n≤500，1≤m≤50，k=1；<br>对于第 2 组至第 3 组数据：1≤n≤500，1≤m≤50，k=2；<br>对于第 4 组至第 5 组数据：1≤n≤500，1≤m≤50，k=m；<br>对于第 1 组至第 7 组数据：1≤n≤500，1≤m≤50，1≤k≤m；<br>对于第 1 组至第 9 组数据：1≤n≤1000，1≤m≤100，1≤k≤m；<br>对于所有 10 组数据：1≤n≤1000，1≤m≤200，1≤k≤m。</p>
<p>NOIP 2015 提高组 Day 2 第二题</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p><strong>划分DP+滚动数组</strong><br>f[t,i,j] 在a[1..i]中取t份，与b[1..j]匹配的方法数。<br>注意初始化f[0,i,0]=1</p>
<dir style="text-align:right"><a href="/2016/08/13/Vijos-P1982/p1982.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1982.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uses</span> math;</div><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">const</span> z=<span class="number">1000000007</span>;</div><div class="line"><span class="keyword">var</span> </div><div class="line">    n,m,k,i,i0,i1,j,t,l:int;</div><div class="line">    f:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>,<span class="number">0</span>..<span class="number">1010</span>,<span class="number">0</span>..<span class="number">210</span>] <span class="keyword">of</span> int;</div><div class="line">    a,b:ansistring;</div><div class="line"><span class="keyword">begin</span> <span class="comment">&#123;Main&#125;</span></div><div class="line">    readln(n,m,k);</div><div class="line">    readln(a);readln(b);</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> n <span class="keyword">do</span> f[<span class="number">0</span>,i,<span class="number">0</span>]:=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> k <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">        i0:=i <span class="keyword">mod</span> <span class="number">2</span>;i1:=(i+<span class="number">1</span>) <span class="keyword">mod</span> <span class="number">2</span>;</div><div class="line">        fillchar(f[i0],sizeof(f[i0]),<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></div><div class="line">            <span class="keyword">for</span> t:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                f[i0,j,t]:=f[i0,j-<span class="number">1</span>,t];</div><div class="line">                l:=<span class="number">0</span>;</div><div class="line">                <span class="keyword">while</span> a[j-l]=b[t-l] <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">                    <span class="keyword">if</span> l&gt;=min(j,t) <span class="keyword">then</span> break;</div><div class="line">                    f[i0,j,t]:=(f[i0,j,t]+f[i1,j-l-<span class="number">1</span>,t-l-<span class="number">1</span>]) <span class="keyword">mod</span> z;</div><div class="line">                    inc(l);</div><div class="line">                <span class="keyword">end</span>;</div><div class="line">            <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">end</span>;</div><div class="line">    <span class="keyword">write</span>(f[k <span class="keyword">mod</span> <span class="number">2</span>,n,m]);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;有两个仅包含小写英文字母的字符串 A 和 B。现在要从字符串 A 中取出 k 个&lt;strong&gt;互不重叠&lt;/strong&gt;的非空子串，然后把这 k 个子串按照其在字符串 A 中出现的顺序依次连接起来得到一 个新的字符串，请问有多少种方案可以使得这个新串与字符串 B 相等？注意：子串取出的位置不同也认为是不同的方案。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;第一行是三个正整数 n，m，k，分别表示字符串 A 的长度，字符串 B 的长度，以及问 题描述中所提到的 k，每两个整数之间用一个空格隔开。第二行包含一个长度为 n 的字符串，表示字符串 A。 第三行包含一个长度为 m 的字符串，表示字符串 B。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出共一行，包含一个整数，表示所求方案数。由于答案可能很大，&lt;strong&gt;所以这里要求输出答案对 1,000,000,007 取模的结果。&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="DP" scheme="https://cothrax.github.io/tags/DP/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
      <category term="字符串" scheme="https://cothrax.github.io/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    
      <category term="划分DP" scheme="https://cothrax.github.io/tags/%E5%88%92%E5%88%86DP/"/>
    
  </entry>
  
  <entry>
    <title>[Vijos] P1981 跳石头</title>
    <link href="https://cothrax.github.io/2016/08/13/Vijos-P1981/"/>
    <id>https://cothrax.github.io/2016/08/13/Vijos-P1981/</id>
    <published>2016-08-13T06:13:49.000Z</published>
    <updated>2016-08-14T01:08:18.199Z</updated>
    
    <content type="html"><![CDATA[<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>一年一度的“跳石头”比赛又要开始了！<br>这项比赛将在一条笔直的河道中进行，河道中分布着一些巨大岩石。组委会已经选择好了两块岩石作为比赛起点和终点。在起点和终点之间，有 N 块岩石（不含起点和终 点的岩石）。在比赛过程中，选手们将从起点出发，每一步跳向相邻的岩石，直至到达终点。<br>为了提高比赛难度，组委会计划移走一些岩石，使得选手们在比赛过程中的最短跳 跃距离尽可能长。由于预算限制，组委会至多从起点和终点之间移走 M 块岩石（不能 移走起点和终点的岩石）。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入第一行包含三个整数 L，N，M，分别表示起点到终点的距离，起点和终 点之间的岩石数，以及组委会至多移走的岩石数。<br>接下来 N 行，每行一个整数，第 i 行的整数 Di（0&lt;Di&lt;L0&lt;Di&lt;L）表示第 i 块岩石与起点的距离。这些岩石按与起点距离从小到大的顺序给出，且不会有两个岩石出现在同 一个位置。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出只包含一个整数，即最短跳跃距离的最大值。<br><a id="more"></a></p>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><blockquote>
<p>25 5 2<br>2<br>11<br>14<br>17<br>21</p>
</blockquote>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><blockquote>
<p>4</p>
</blockquote>
<h2 id="提示​"><a href="#提示​" class="headerlink" title="提示​"></a>提示​</h2><p>对于20%的数据，0≤M≤N≤10。<br>对于50%的数据，0≤M≤N≤100。<br>对于100%的数据，0≤M≤N≤50000，1≤L≤1000000000。</p>
<p>对于样例。将与起点距离为 2 和 14 的两个岩石移走后，最短的跳跃距离为 4（从与起点距离17 的岩石跳到距离 21 的岩石，或者从距离 21 的岩石跳到终点）。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p><strong>二分</strong>最大距离，不要忘记起终点的石头。</p>
<dir style="text-align:right"><a href="/2016/08/13/Vijos-P1981/p1981.pas" title="复制代码">复制代码</a></dir>

<figure class="highlight delphi"><figcaption><span>p1981.pas</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> int=longint;</div><div class="line"><span class="keyword">var</span> </div><div class="line"></div><div class="line">	l0,m,n,i,l,r,mid,ans:int;</div><div class="line">	d:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">50010</span>] <span class="keyword">of</span> int;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(x:int)</span>:</span>boolean;</div><div class="line"><span class="keyword">var</span> i,last,count:int;</div><div class="line"><span class="keyword">begin</span></div><div class="line">	count:=<span class="number">0</span>;last:=<span class="number">0</span>;i:=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> i&lt;=n <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">		<span class="keyword">while</span> (d[i]-d[last]&lt;x) <span class="keyword">and</span> (i&lt;=n) <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">			inc(i);inc(count);</div><div class="line">		<span class="keyword">end</span>;</div><div class="line">		<span class="keyword">if</span> count&gt;m <span class="keyword">then</span> <span class="keyword">exit</span>(false);</div><div class="line">		last:=i;inc(i);</div><div class="line">	<span class="keyword">end</span>;</div><div class="line">	c:=true;</div><div class="line"><span class="keyword">end</span>;</div><div class="line"></div><div class="line"><span class="keyword">begin</span></div><div class="line">	<span class="keyword">read</span>(l0,n,m);</div><div class="line">	<span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(d[i]);</div><div class="line">	d[<span class="number">0</span>]:=<span class="number">0</span>;</div><div class="line">	inc(n);d[n]:=l0;</div><div class="line"></div><div class="line">	l:=<span class="number">0</span>;r:=l0;ans:=-<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span> l&lt;=r <span class="keyword">do</span> <span class="keyword">begin</span></div><div class="line">		mid:=(l+r) <span class="keyword">shr</span> <span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span> c(mid) <span class="keyword">then</span> <span class="keyword">begin</span> ans:=mid;l:=mid+<span class="number">1</span> <span class="keyword">end</span></div><div class="line">		<span class="keyword">else</span> r:=mid-<span class="number">1</span>;</div><div class="line">	<span class="keyword">end</span>;</div><div class="line">	<span class="keyword">write</span>(ans);</div><div class="line"><span class="keyword">end</span>.</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;一年一度的“跳石头”比赛又要开始了！&lt;br&gt;这项比赛将在一条笔直的河道中进行，河道中分布着一些巨大岩石。组委会已经选择好了两块岩石作为比赛起点和终点。在起点和终点之间，有 N 块岩石（不含起点和终 点的岩石）。在比赛过程中，选手们将从起点出发，每一步跳向相邻的岩石，直至到达终点。&lt;br&gt;为了提高比赛难度，组委会计划移走一些岩石，使得选手们在比赛过程中的最短跳 跃距离尽可能长。由于预算限制，组委会至多从起点和终点之间移走 M 块岩石（不能 移走起点和终点的岩石）。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;h3 id=&quot;输入格式&quot;&gt;&lt;a href=&quot;#输入格式&quot; class=&quot;headerlink&quot; title=&quot;输入格式&quot;&gt;&lt;/a&gt;输入格式&lt;/h3&gt;&lt;p&gt;输入第一行包含三个整数 L，N，M，分别表示起点到终点的距离，起点和终 点之间的岩石数，以及组委会至多移走的岩石数。&lt;br&gt;接下来 N 行，每行一个整数，第 i 行的整数 Di（0&amp;lt;Di&amp;lt;L0&amp;lt;Di&amp;lt;L）表示第 i 块岩石与起点的距离。这些岩石按与起点距离从小到大的顺序给出，且不会有两个岩石出现在同 一个位置。&lt;/p&gt;
&lt;h2 id=&quot;输出格式&quot;&gt;&lt;a href=&quot;#输出格式&quot; class=&quot;headerlink&quot; title=&quot;输出格式&quot;&gt;&lt;/a&gt;输出格式&lt;/h2&gt;&lt;p&gt;输出只包含一个整数，即最短跳跃距离的最大值。&lt;br&gt;
    
    </summary>
    
      <category term="Problem Set" scheme="https://cothrax.github.io/categories/Problem-Set/"/>
    
    
      <category term="OI" scheme="https://cothrax.github.io/tags/OI/"/>
    
      <category term="二分答案" scheme="https://cothrax.github.io/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/"/>
    
      <category term="NOIP" scheme="https://cothrax.github.io/tags/NOIP/"/>
    
  </entry>
  
</feed>
